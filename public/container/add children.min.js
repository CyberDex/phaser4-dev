(()=>{function V(r){let t=[r],e=[];for(;t.length>0;){let o=t.shift();e.push(o);let i=o.numChildren;if(i>0)for(let s=i-1;s>=0;s--)t.unshift(o.children[s])}return e.shift(),e}function A(r,t){return r.children.indexOf(t)}function wt(r,t){let e=r.children,o;if(t>=0&&t<e.length){let i=e.splice(t,1);i[0]&&(o=i[0],o.parent=null)}return o}function J(r,t){let e=A(r,t);return e>-1&&wt(r,e),t}var Et="addedtoworld";var tt="destroy";var te="postupdate";var bt="removedfromworld";var ee="update";function R(r,t,...e){if(r.events.size===0||!r.events.has(t))return!1;let o=r.events.get(t);for(let i of o)i.callback.apply(i.context,e),i.once&&o.delete(i);return o.size===0&&r.events.delete(t),!0}function re(r,...t){return t.forEach(e=>{e.world&&(R(e.world,bt,e,e.world),R(e,bt,e,e.world)),e.world=r,R(r,Et,e,r),R(e,Et,e,r)}),t}function B(r,...t){t.forEach(o=>{o.parent&&J(o.parent,o),o.parent=r});let e=r.world;return e&&re(e,...V(r)),t}function et(r,t){return r.children.push(t),B(r,t),t.transform.updateWorld(),t}function rt(r,...t){return t.forEach(e=>{et(r,e)}),t}var d={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Ft(r,t=[]){for(let e=0;e<r.numChildren;e++){let o=r.children[e],i=[];t.push({node:o,children:i}),o.numChildren>0&&Ft(o,i)}return t}function At(r){return`${r.numChildren>0?"Parent":"Child"} [ type=${r.type}, name=${r.name} ]`}function pr(r){console.group(At(r.node)),r.children.forEach(t=>{t.children.length>0?pr(t):console.log(At(t.node))}),console.groupEnd()}function oe(r){let t=Ft(r);r.world===r?console.group("World"):console.group(At(r)),t.forEach(e=>{e.children.length?pr(e):console.log(At(e.node))}),console.groupEnd()}function ot(r,t=0,e){let o=r.children;e===void 0&&(e=o.length);let i=e-t;if(i>0&&i<=e){let s=o.splice(t,i);return s.forEach(a=>{a.parent=null}),s}else return[]}function ne(r,t=0,e){ot(r,t,e).forEach(i=>{i.destroy()})}function se(r,...t){return t.forEach(e=>{J(r,e)}),t}function ae(r,t,e=0,o){let i=ot(r,e,o);return B(t,...i),i.forEach(s=>{s.transform.updateWorld()}),i}var l={BACKGROUND_COLOR:"BackgroundColor",BATCH_SIZE:"BatchSize",DEFAULT_ORIGIN:"DefaultOrigin",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",SIZE:"Size",SCENES:"Scenes",RENDERER:"Renderer",AUTO:"Auto",WEBGL:"WebGL",CANVAS:"Canvas",WEBGL_CONTEXT:"WebGLContext",CANVAS_CONTEXT:"CanvasContext",BANNER:"Banner"};var p=new Map;function Gt(r){p.set(l.BACKGROUND_COLOR,r)}function me(r){return()=>{Gt(r)}}function Dt(r="",t="",e="",o="#fff",i="linear-gradient(#3e0081 40%, #00bcc3)"){p.set(l.BANNER,{title:r,version:t,url:e,color:o,background:i})}function fe(r){p.set(l.BATCH_SIZE,r)}function v(){return p.get(l.SIZE).height}function L(){return p.get(l.SIZE).resolution}function I(){return p.get(l.SIZE).width}function nt(r=800,t=600,e=1){e===0&&(e=window.devicePixelRatio),p.set(l.SIZE,{width:r,height:t,resolution:e})}function Vt(r=800,t=600,e=1){return()=>{nt(r,t,e)}}var ce=[],H={add:(r,t)=>{ce.push({texture:r,glConfig:t})},get:()=>ce,clear:()=>{ce.length=0}};function he(){return p.get(l.BACKGROUND_COLOR)}function Bt(r){p.set(l.RENDERER,r)}function vt(r=.5,t=r){p.set(l.DEFAULT_ORIGIN,{x:r,y:t})}function Q(r){p.set(l.MAX_TEXTURES,r)}function it(r){let t;return r&&(typeof r=="string"?t=document.getElementById(r):typeof r=="object"&&r.nodeType===1&&(t=r)),t||(t=document.body),t}function ue(r){r&&p.set(l.PARENT,it(r))}function Lt(r){return()=>{ue(r)}}function le(r){p.set(l.SCENES,[].concat(r))}function It(r){return()=>{le(r)}}function _t(r,t,e){return r.width<=0||r.height<=0?!1:r.x<=t&&r.x+r.width>=t&&r.y<=e&&r.y+r.height>=e}var y=class{constructor(t=0,e=0,o=0,i=0){this.set(t,e,o,i)}set(t=0,e=0,o=0,i=0){return this.x=t,this.y=e,this.width=o,this.height=i,this}contains(t,e){return _t(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}};function pe(r,t=0,e=0,o=0,i=0){let s=new y(t,e,o,i);return r.viewportStack.push(s),s}var n,xr={get:()=>n,set:r=>{n=r}};function _(r,t){if(!t&&(t=r.currentViewport,!t))return;let e=n.getParameter(n.VIEWPORT);(e[0]!==t.x||e[1]!==t.y||e[2]!==t.width||e[3]!==t.height)&&n.viewport(t.x,t.y,t.width,t.height)}function de(r,t=0,e=0,o=0,i=0){let s=pe(r,t,e,o,i);_(r,s),r.currentViewport=s}function O(r,t=!0,e){e||(e=r.currentFramebuffer);let{framebuffer:o,viewport:i}=e;n.bindFramebuffer(n.FRAMEBUFFER,o),t&&(n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)),i&&de(r,i.x,i.y,i.width,i.height)}function xe(r){let t=r.viewportStack;t.length>1&&t.pop(),r.currentViewport=t[t.length-1],_(r)}function st(r){let t=r.framebufferStack;t.length>1&&(r.currentFramebuffer.viewport&&xe(r),t.pop()),r.currentFramebuffer=t[t.length-1],O(r,!1)}function ge(r,t,e){let o={framebuffer:t,viewport:e};return r.framebufferStack.push(o),o}function Ot(r,t,e=!0,o){let i=ge(r,t,o);O(r,e,i),r.currentFramebuffer=i}function Se(r){let t=r.count;if(t===0)return;let e=r.currentVertexBuffer,o=r.currentShader,i=o.shader.renderToFramebuffer;if(i&&Ot(r,o.shader.framebuffer,!0),t===e.batchSize){let s=e.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW;n.bufferData(n.ARRAY_BUFFER,e.data,s)}else{let s=e.indexed?t*e.entryElementSize:t*e.vertexElementSize,a=e.vertexViewF32.subarray(0,s);n.bufferSubData(n.ARRAY_BUFFER,0,a)}e.indexed?n.drawElements(n.TRIANGLES,t*e.entryIndexSize,n.UNSIGNED_SHORT,0):n.drawArrays(n.TRIANGLES,0,t),i&&st(r)}function F(r,t){t&&(r.count=t);let e=r.count;return e===0?!1:(Se(r),r.prevCount=e,r.count=0,r.flushTotal++,!0)}function Re(r){F(r)}function gr(r,t=[]){let e=r>>16&255,o=r>>8&255,i=r&255,s=r>16777215?r>>>24:255;return t[0]=e/255,t[1]=o/255,t[2]=i/255,t[3]=s/255,t}function Sr(){return p.get(l.WEBGL_CONTEXT)}function Nt(r){let{parent:t,flipY:e,unpackPremultiplyAlpha:o,minFilter:i,magFilter:s,wrapS:a,wrapT:m,generateMipmap:f,isPOT:c}=r,h=t.image,S=t.width,g=t.height,M=n.createTexture();return n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,M),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),h?(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,h),S=h.width,g=h.height):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,S,g,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,m),f&&c&&n.generateMipmap(n.TEXTURE_2D),r.texture=M,M}function at(r){n&&n.isFramebuffer(r)&&n.deleteFramebuffer(r)}function mt(r){n.isTexture(r)&&n.deleteTexture(r)}function Rr(r,t){return r<1||t<1?!1:(r&r-1)==0&&(t&t-1)==0}function Cr(r,t=!0){n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r);let e=t?n.LINEAR:n.NEAREST;n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e)}function Tr(r){let t=r.parent.image,e=t.width,o=t.height;return e>0&&o>0&&(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r.texture),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r.flipY),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),r.texture}var j=class{constructor(t,e={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1,this.parent=t,this.isPOT=Rr(t.width,t.height);let{texture:o=null,framebuffer:i=null,depthbuffer:s=null,unpackPremultiplyAlpha:a=!0,minFilter:m=this.isPOT?n.LINEAR_MIPMAP_LINEAR:n.LINEAR,magFilter:f=n.LINEAR,wrapS:c=n.CLAMP_TO_EDGE,wrapT:h=n.CLAMP_TO_EDGE,generateMipmap:S=this.isPOT,flipY:g=!1}=e;this.minFilter=m,this.magFilter=f,this.wrapS=c,this.wrapT=h,this.generateMipmap=S,this.flipY=g,this.unpackPremultiplyAlpha=a,i&&(this.framebuffer=i),s&&(this.depthbuffer=s),o?this.texture=o:Nt(this)}setFilter(t){this.texture&&Cr(this.texture,t)}create(){let t=this.texture;return t&&mt(t),Nt(this)}update(){return this.texture?Tr(this):Nt(this)}setIndex(t){this.dirtyIndex=t!==this.index,this.index=t}destroy(){mt(this.texture),at(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}};function Ce(){H.get().forEach(t=>{let{texture:e,glConfig:o}=t;e.binding||(e.binding=new j(e,o))}),H.clear()}function ft(){return p.get(l.MAX_TEXTURES)}var ho=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function uo(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function Te(r){let t=n.createShader(n.FRAGMENT_SHADER);for(;;){let e=ho.replace(/%forloop%/gi,uo(r));if(n.shaderSource(t,e),n.compileShader(t),!n.getShaderParameter(t,n.COMPILE_STATUS))r=r/2|0;else break}return r}function ye(r){let t=Te(n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),e=ft();e===0||e>0&&e>t?Q(t):e>0&&e<t&&(t=Math.max(8,e));let o=r.tempTextures;o.length&&o.forEach(s=>{n.deleteTexture(s)});let i=[];for(let s=0;s<t;s++){let a=n.createTexture();n.activeTexture(n.TEXTURE0+s),n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),o[s]=a,i.push(s)}r.maxTextures=t,r.textureIndex=i,r.currentActiveTexture=1}function yr(){return p.get(l.BATCH_SIZE)}function ct(r){n.isBuffer(r)&&n.deleteBuffer(r)}var Me=class{constructor(t={}){this.indexed=!1,this.isDynamic=!1,this.count=0,this.offset=0;let{batchSize:e=1,dataSize:o=4,isDynamic:i=!0,elementsPerEntry:s=4,vertexElementSize:a=6}=t;this.batchSize=e,this.dataSize=o,this.vertexElementSize=a,this.isDynamic=i,this.elementsPerEntry=s,this.vertexByteSize=a*o,this.entryByteSize=this.vertexByteSize*s,this.bufferByteSize=e*this.entryByteSize,this.create()}resize(t){this.batchSize=t,this.bufferByteSize=t*this.entryByteSize,this.vertexBuffer&&ct(this.vertexBuffer),this.create()}create(){let t=new ArrayBuffer(this.bufferByteSize);this.data=t,this.vertexViewF32=new Float32Array(t),this.vertexViewU32=new Uint32Array(t),this.vertexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);let e=this.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW;n.bufferData(n.ARRAY_BUFFER,t,e),n.bindBuffer(n.ARRAY_BUFFER,null)}add(t){this.count+=t,this.offset+=this.vertexElementSize*t}reset(){this.count=0,this.offset=0}canContain(t){return this.count+t<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer)}destroy(){ct(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}};var zt=class extends Me{constructor(t={}){super(t);let{indexSize:e=4,entryIndexSize:o=6,indexLayout:i=null}=t;this.indexed=!0,this.indexSize=e,this.entryIndexSize=o,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;let s=[];if(i){this.indexLayout=i;for(let a=0;a<this.batchSize*e;a+=e)for(let m=0;m<i.length;m++)s.push(a+i[m])}this.create(),this.createIndexBuffer(s)}createIndexBuffer(t){this.index=new Uint16Array(t),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.index,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t=[]}bind(){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),ct(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}};var wr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",go=new Uint8Array(256);for(let r=0;r<wr.length;r++)go[wr.charCodeAt(r)]=r;function N(){}var x=class{constructor(t){let e=new Float32Array(16);this.data=e,this.onChange=N,t?Array.isArray(t)?this.fromArray(t):this.fromArray(t.data):(e[0]=1,e[5]=1,e[10]=1,e[15]=1)}set(t,e,o,i,s,a,m,f,c,h,S,g,M,b,Y,X){let C=this.data;return C[0]=t,C[1]=e,C[2]=o,C[3]=i,C[4]=s,C[5]=a,C[6]=m,C[7]=f,C[8]=c,C[9]=h,C[10]=S,C[11]=g,C[12]=M,C[13]=b,C[14]=Y,C[15]=X,this.onChange(this),this}toArray(t=[],e=0){let o=this.data;for(let i=0;i<16;i++)t[e+i]=o[i];return t}fromArray(t,e=0){let o=this.data;for(let i=0;i<16;i++)o[i]=t[e+i];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=N,this.data=null}};function Ee(r,t,e,o,i,s,a=new x){let m=1/(r-t),f=1/(e-o),c=1/(i-s);return a.set(-2*m,0,0,0,0,-2*f,0,0,0,0,2*c,0,(r+t)*m,(o+e)*f,(s+i)*c,1)}function be(r,t){let e=new Map,o={size:1,type:n.FLOAT,normalized:!1,stride:0,offset:0},i=n.getProgramParameter(r,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){let a=n.getActiveAttrib(r,s);if(!a)break;let m=a.name,f=n.getAttribLocation(r,m);n.enableVertexAttribArray(f);let c=t.hasOwnProperty(m)?t[m]:{},{size:h=o.size,type:S=o.type,normalized:g=o.normalized,stride:M=o.stride,offset:b=o.offset}=c;e.set(m,{index:f,size:h,type:S,normalized:g,stride:M,offset:b})}return e}function ht(...r){r.forEach(t=>{n.deleteShader(t)})}function Fe(...r){let t=n.createProgram();if(r.forEach(o=>{n.attachShader(t,o)}),n.linkProgram(t),!n.getProgramParameter(t,n.LINK_STATUS)){let o=n.getProgramInfoLog(t);return console.error(`Error linking program: ${o}`),n.deleteProgram(t),ht(...r),null}return t}function Ut(r,t){let e=n.createShader(t);if(n.shaderSource(e,r),n.compileShader(e),!n.getShaderParameter(e,n.COMPILE_STATUS)){let i=n.getShaderInfoLog(e),s=r.split(`
`).map((a,m)=>`${m}: ${a}`);return console.error(`Error compiling shader: ${i}`,s.join(`
`)),n.deleteShader(e),null}return e}function Ae(r,t,e=!1){switch(r.type){case n.INT:case n.BOOL:return e?o=>{n.uniform1iv(t,o)}:o=>{n.uniform1i(t,o)};case n.INT_VEC2:case n.BOOL_VEC2:return o=>{n.uniform2iv(t,o)};case n.INT_VEC3:case n.BOOL_VEC3:return o=>{n.uniform3iv(t,o)};case n.INT_VEC4:case n.BOOL_VEC4:return o=>{n.uniform4iv(t,o)};case n.FLOAT:return e?o=>{n.uniform1fv(t,o)}:o=>{n.uniform1f(t,o)};case n.FLOAT_VEC2:return o=>{n.uniform2fv(t,o)};case n.FLOAT_VEC3:return o=>{n.uniform3fv(t,o)};case n.FLOAT_VEC4:return o=>{n.uniform4fv(t,o)};case n.FLOAT_MAT2:return o=>{n.uniformMatrix2fv(t,!1,o)};case n.FLOAT_MAT3:return o=>{n.uniformMatrix3fv(t,!1,o)};case n.FLOAT_MAT4:return o=>{n.uniformMatrix4fv(t,!1,o)};case n.SAMPLER_2D:case n.SAMPLER_CUBE:return r.size>1?o=>{n.uniform1iv(t,o)}:o=>{n.uniform1i(t,o)}}}function Ge(r){let t=new Map,e=n.getProgramParameter(r,n.ACTIVE_UNIFORMS);for(let o=0;o<e;o++){let i=n.getActiveUniform(r,o),s=i.name;if(s.startsWith("gl_")||s.startsWith("webgl_"))continue;let a=n.getUniformLocation(r,i.name);if(a){let m=!1;s.substr(-3)==="[0]"&&(s=s.substr(0,s.length-3),m=i.size>1),t.set(s,Ae(i,a,m))}}return t}var Er=5121;var Pt=5126;var q={aVertexPosition:{size:2,type:Pt,normalized:!1,offset:0},aTextureCoord:{size:2,type:Pt,normalized:!1,offset:8},aTextureId:{size:1,type:Pt,normalized:!1,offset:16},aTintColor:{size:4,type:Er,normalized:!0,offset:20}};var De={uProjectionMatrix:new Float32Array,uCameraMatrix:new Float32Array,uTexture:0};function br(r,t,e){n.bindFramebuffer(n.FRAMEBUFFER,r);let o=n.createRenderbuffer();return n.bindRenderbuffer(n.RENDERBUFFER,o),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t,e),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,o),n.bindFramebuffer(n.FRAMEBUFFER,null),o}function Ve(r,t){t||(t=n.COLOR_ATTACHMENT0);let e=n.createFramebuffer();return n.bindFramebuffer(n.FRAMEBUFFER,e),n.framebufferTexture2D(n.FRAMEBUFFER,t,n.TEXTURE_2D,r,0),n.bindFramebuffer(n.FRAMEBUFFER,null),e}var Fr=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var Ar=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;var kt=class{constructor(t,e,o,i,s,a){this.trimmed=!1,this.texture=t,this.key=e,this.x=o,this.y=i,this.width=s,this.height=a,this.sourceSizeWidth=s,this.sourceSizeHeight=a,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,o,i,s,a){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=o,this.spriteSourceSizeY=i,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=a}getExtent(t,e){let o=this.sourceSizeWidth,i=this.sourceSizeHeight,s,a,m,f;return this.trimmed?(s=this.spriteSourceSizeX-t*o,a=s+this.spriteSourceSizeWidth,m=this.spriteSourceSizeY-e*i,f=m+this.spriteSourceSizeHeight):(s=-t*o,a=s+o,m=-e*i,f=m+i),{left:s,right:a,top:m,bottom:f}}setExtent(t){let e=t.transform,o=e.origin.x,i=e.origin.y,s=this.sourceSizeWidth,a=this.sourceSizeHeight,m,f,c,h;this.trimmed?(m=this.spriteSourceSizeX-o*s,f=this.spriteSourceSizeY-i*a,c=this.spriteSourceSizeWidth,h=this.spriteSourceSizeHeight):(m=-o*s,f=-i*a,c=s,h=a),e.setExtent(m,f,c,h)}updateUVs(){let{x:t,y:e,width:o,height:i}=this,s=this.texture.width,a=this.texture.height;this.u0=t/s,this.v0=e/a,this.u1=(t+o)/s,this.v1=(e+i)/a}};var w=class{constructor(t,e,o,i){this.key="",t&&(e=t.width,o=t.height),this.image=t,this.width=e,this.height=o,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,e,o),H.add(this,i)}addFrame(t,e,o,i,s){if(this.frames.has(t))return null;let a=new kt(this,t,e,o,i,s);return this.frames.set(t,a),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=a),a}getFrame(t){if(!t)return this.firstFrame;t instanceof kt&&(t=t.key);let e=this.frames.get(t);return e||(console.warn(`Frame missing: ${t}`),e=this.firstFrame),e}setSize(t,e){this.width=t,this.height=e,this.frames.get("__BASE").setSize(t,e)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}};var Wt=class{constructor(t){this.renderToFramebuffer=!1,this.renderToDepthbuffer=!1,t&&this.fromConfig(t)}fromConfig(t){let{attributes:e=q,fragmentShader:o=Fr,height:i=v(),renderToFramebuffer:s=!1,renderToDepthbuffer:a=!1,resolution:m=L(),vertexShader:f=Ar,width:c=I(),uniforms:h=De}=t;if(this.create(o,f,h,e),s){this.renderToFramebuffer=!0;let S=new w(null,c*m,i*m),g=new j(S);S.binding=g,g.framebuffer=Ve(g.texture),a&&(this.renderToDepthbuffer=!0,g.depthbuffer=br(g.framebuffer,S.width,S.height)),this.texture=S,this.framebuffer=g.framebuffer}}create(t,e,o,i){let s=Ut(t,n.FRAGMENT_SHADER),a=Ut(e,n.VERTEX_SHADER);if(!s||!a)return;let m=Fe(s,a);if(!m)return;let f=n.getParameter(n.CURRENT_PROGRAM);n.useProgram(m),this.program=m,this.uniformSetters=Ge(m),this.uniforms=new Map;for(let[c,h]of Object.entries(o))this.uniforms.set(c,h);this.attributes=be(m,i),n.useProgram(f)}updateUniforms(t){}bind(t){return this.updateUniforms(t),this.setUniforms(t)}setUniform(t,e){let o=this.uniforms;o.has(t)&&(o.set(t,e),this.uniformSetters.get(t)(e))}setUniforms(t){if(!this.program)return!1;n.useProgram(this.program);let e=this.uniforms;for(let[o,i]of this.uniformSetters.entries())i(e.get(o));return!0}setAttributes(t){if(this.program){let e=t.currentVertexBuffer.vertexByteSize;this.attributes.forEach(o=>{n.vertexAttribPointer(o.index,o.size,o.type,o.normalized,e,o.offset)})}}destroy(){ht(this.program),mt(this.texture),at(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}};var z=class extends Wt{constructor(t={}){let e=t;e.attributes=e.attributes?e.attributes:q,super(e)}bind(t){let e=this.uniforms;return e.set("uProjectionMatrix",t.projectionMatrix.data),e.set("uCameraMatrix",t.cameraMatrix.data),super.bind(t)}};var Gr=`#define SHADER_NAME MULTI_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];

void main (void)
{
    vec4 color;

    %forloop%

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var Yt=class extends z{constructor(t={}){t.fragmentShader||(t.fragmentShader=Gr),super(t)}create(t,e,o,i){let s=ft(),a="";for(let m=1;m<s;m++)m>1&&(a+=`
	else `),m<s-1&&(a+=`if (vTextureId < ${m}.5)`),a+=`
	{`,a+=`
		color = texture2D(uTexture[${m}], vTextureCoord);`,a+=`
	}`;t=t.replace(/%count%/gi,`${s}`),t=t.replace(/%forloop%/gi,a),super.create(t,e,o,i)}bind(t){return this.uniforms.set("uTexture",t.textureIndex),super.bind(t)}};function Be(r,t,e,o){let i={enable:t,sfactor:e,dfactor:o};r.blendModeStack[0]=i,r.currentBlendMode=i,r.defaultBlendMode=i}function ve(r,t=null,e){let o={framebuffer:t,viewport:e};r.framebufferStack[0]=o,r.currentFramebuffer=o,r.defaultFramebuffer=o}function Le(r,t,e){let o={shader:t,textureID:e};r.shaderStack[0]=o,r.currentShader=o,r.defaultShader=o}function Ie(r,t){r.vertexBufferStack[0]=t,r.currentVertexBuffer=t,r.defaultVertexBuffer=t}function _e(r,t=0,e=0,o=0,i=0){let s=new y(t,e,o,i);r.viewportStack[0]=s,r.currentViewport=s,r.defaultViewport=s}var Dr,Vr=0,Br=0,E={get:()=>Dr,set:r=>{Dr=r},getFrame:()=>Vr,setFrame:r=>{Vr=r},getElapsed:()=>Br,setElapsed:r=>{Br=r}};function ut(r=new x){return r.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}var U=class{constructor(t=1,e=0,o=0,i=1,s=0,a=0){this.set(t,e,o,i,s,a)}set(t=1,e=0,o=0,i=1,s=0,a=0){return this.a=t,this.b=e,this.c=o,this.d=i,this.tx=s,this.ty=a,this}identity(){return this.set()}toArray(){let{a:t,b:e,c:o,d:i,tx:s,ty:a}=this;return[t,e,o,i,s,a]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}};var D=class{constructor(t,e=0,o=0){this._x=e,this._y=o,this.onChange=t}destroy(){this.onChange=N}set(t=0,e=0){return this._x=t,this._y=e,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(t){let e=this._x;this._x=t,e!==t&&this.onChange(this)}get y(){return this._y}set y(t){let e=this._y;this._y=t,e!==t&&this.onChange(this)}toArray(t=[],e=0){let{x:o,y:i}=this;return t[e]=o,t[e+1]=i,t}fromArray(t,e=0){return this.set(t[e],t[e+1])}toString(){let{x:t,y:e}=this;return`{ x=${t}, y=${e} }`}};var lt={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};var $=class{constructor(){this.type="StaticCamera",this.dirtyRender=!0;let t=E.get();this.renderer=t.renderer,this.matrix=ut(),this.bounds=new y,this.worldTransform=new U,this.reset()}reset(){let t=this.renderer;if(t){let e=t.width,o=t.height;this.width=e,this.height=o}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}};var Xt=class{constructor(t){this.count=0,this.prevCount=0,this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.textureIndex=[],this.framebufferStack=[],this.currentFramebuffer=null,this.defaultFramebuffer=null,this.vertexBufferStack=[],this.currentVertexBuffer=null,this.defaultVertexBuffer=null,this.shaderStack=[],this.currentShader=null,this.defaultShader=null,this.viewportStack=[],this.currentViewport=null,this.defaultViewport=null,this.blendModeStack=[],this.currentBlendMode=null,this.defaultBlendMode=null,this.renderer=t,this.projectionMatrix=new x,this.reset()}reset(){let t=this.renderer.gl,e=[0,1,2,2,3,0];this.quadShader=new z,this.quadBuffer=new zt({isDynamic:!1,indexLayout:e}),this.quadCamera=new $,ye(this),ve(this),Be(this,!0,t.ONE,t.ONE_MINUS_SRC_ALPHA),Ie(this,new zt({batchSize:yr(),indexLayout:e})),Le(this,new Yt)}resize(t,e){Ee(0,t,e,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),_e(this,0,0,t,e)}};function pt(r,t){t||(t=r.currentShader),t.shader.bind(r,t.textureID)&&t.shader.setAttributes(r)}function Oe(r,t){r.current2DCamera=t,r.cameraMatrix=t.matrix,pt(r)}function dt(r,t){t||(t=r.currentBlendMode),t.enable?(n.enable(n.BLEND),n.blendFunc(t.sfactor,t.dfactor)):n.disable(n.BLEND)}function xt(r,t){t||(t=r.currentVertexBuffer);let e=t.indexed?t.indexBuffer:null;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),n.bindBuffer(n.ARRAY_BUFFER,t.vertexBuffer)}function Ht(r,t=0){let e=r.currentVertexBuffer;r.count+t>=e.batchSize&&F(r);let o=e.indexed?r.count*e.entryElementSize:r.count*e.vertexElementSize;return r.count+=t,{buffer:e,F32:e.vertexViewF32,U32:e.vertexViewU32,offset:o}}function Ne(r,t){let e=t.binding,o=r.currentActiveTexture;return e.indexCounter<r.startActiveTexture&&(e.indexCounter=r.startActiveTexture,o<r.maxTextures?(e.setIndex(o),n.activeTexture(n.TEXTURE0+o),n.bindTexture(n.TEXTURE_2D,e.texture),r.currentActiveTexture++):(F(r),r.startActiveTexture++,e.indexCounter=r.startActiveTexture,e.setIndex(1),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,e.texture),r.currentActiveTexture=2)),e.index}function ze(r){r.current2DCamera=r.quadCamera,r.cameraMatrix=r.quadCamera.matrix,r.count=0,r.flushTotal=0,O(r,!1,r.defaultFramebuffer),dt(r,r.defaultBlendMode),_(r,r.defaultViewport),xt(r,r.defaultVertexBuffer)}var Ir,Ue={get:()=>Ir,set:r=>{Ir=r}};var Pe=class{constructor(){this.clearColor=[0,0,0,1],this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.width=I(),this.height=v(),this.resolution=L(),this.setBackgroundColor(he());let t=document.createElement("canvas");t.addEventListener("webglcontextlost",e=>this.onContextLost(e),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.initContext(),Ue.set(this),this.renderPass=new Xt(this),this.resize(this.width,this.height,this.resolution)}initContext(){let t=this.canvas.getContext("webgl",Sr());xr.set(t),this.gl=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE)}resize(t,e,o=1){let i=t*o,s=e*o;this.width=i,this.height=s,this.resolution=o;let a=this.canvas;a.width=i,a.height=s,this.autoResize&&(a.style.width=t.toString()+"px",a.style.height=e.toString()+"px"),this.renderPass.resize(i,s)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){return gr(t,this.clearColor),this}reset(){}render(t){if(this.contextLost)return;let e=this.gl,o=this.renderPass;if(Ce(),this.optimizeRedraw&&t.numDirtyFrames===0&&t.numDirtyCameras===0)return;if(this.clearBeforeRender){let s=this.clearColor;e.clearColor(s[0],s[1],s[2],s[3]),e.clear(e.COLOR_BUFFER_BIT)}let i=t.worldData;ze(o);for(let s=0;s<i.length;s++){let{world:a}=i[s];a.renderGL(o),a.postRenderGL(o)}Re(o)}destroy(){Ue.set(void 0)}};function ke(){return()=>{Bt(Pe)}}function We(r,t){return it(t).appendChild(r),r}function Ye(r){let t=document.readyState;if(t==="complete"||t==="interactive"){r();return}let e=()=>{document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),r()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",e,!0):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)}var Z=class{constructor(){this.events=new Map}};var K=class{constructor(t,e,o=!1){this.callback=t,this.context=e,this.once=o}};function gt(r,t,e,o,i){let s=r.events,a=s.get(t);if(!e)s.delete(t);else if(e instanceof K)a.delete(e);else{let m=!o,f=i!==void 0;for(let c of a)c.callback===e&&m&&c.context===o&&f&&c.once===i&&a.delete(c)}return a.size===0&&s.delete(t),r}function G(r,t,e,o=r,i=!1){if(typeof e!="function")throw new TypeError("Listener not a function");let s=new K(e,o,i),a=r.events.get(t);return a?a.add(s):r.events.set(t,new Set([s])),s}function St(r,t,e,o=r){return G(r,t,e,o,!0)}function Xe(){let{title:r,version:t,url:e,color:o,background:i}=p.get(l.BANNER);if(r!==""){let s=t!==""?r+" "+t:r;console.log(`%c${s}%c ${e}`,`padding: 4px 16px; color: ${o}; background: ${i}`,"")}}function He(){return p.get(l.PARENT)}function Qe(){return p.get(l.RENDERER)}function _r(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function je(){return p.get(l.SCENES)}function Or(r,t=0){r.gameFrame=t,r.numTotalFrames=0,r.numDirtyFrames=0,r.numDirtyCameras=0,r.worldData.length=0}var Nr,Qt={get:()=>Nr,set:r=>{Nr=r}};var qe=class{constructor(){this.scenes=new Map,this.sceneIndex=0,this.flush=!1,this.renderResult=_r(),this.game=E.get(),Qt.set(this),St(this.game,"boot",()=>this.boot())}boot(){je().forEach(t=>new t)}update(t,e){for(let o of this.scenes.values())R(o,"update",t,e)}render(t){let e=this.renderResult;Or(e,t);for(let o of this.scenes.values())R(o,"render",e);return this.flush&&(e.numDirtyFrames++,this.flush=!1),e}};function zr(){Gt(0),fe(4096),Dt("Phaser","4.0.0","https://phaser4.io"),Q(0),vt(.5,.5),nt(800,600,1)}function Rt(r,t){let e=document.createElement("canvas");return e.width=r,e.height=t,e.getContext("2d")}var Ur,P={get:()=>Ur,set:r=>{Ur=r}};var $e=class{constructor(){this.textures=new Map,this.createDefaultTextures(),P.set(this)}createDefaultTextures(){this.add("__BLANK",new w(Rt(32,32).canvas));let t=Rt(32,32);t.strokeStyle="#0f0",t.moveTo(0,0),t.lineTo(32,32),t.stroke(),t.strokeRect(.5,.5,31,31),this.add("__MISSING",new w(t.canvas));let e=Rt(32,32);e.fillStyle="#fff",e.fillRect(0,0,32,32),this.add("__WHITE",new w(e.canvas))}get(t){let e=this.textures;return e.has(t)?e.get(t):e.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e,o){let i,s=this.textures;return s.has(t)||(e instanceof w?i=e:i=new w(e,0,0,o),i.key=t,s.set(t,i)),i}};var Ze=class extends Z{constructor(...t){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,E.set(this),zr(),Ye(()=>this.boot(t))}boot(t){t.forEach(i=>i());let e=Qe();this.renderer=new e,this.textureManager=new $e,this.sceneManager=new qe;let o=He();o&&We(this.renderer.canvas,o),this.isBooted=!0,Xe(),R(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(t){let e=t-this.lastTick;this.lastTick=t,this.elapsed+=e,this.isPaused||(this.willUpdate&&(this.sceneManager.update(e,t),R(this,"update",e,t)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,E.setFrame(this.frame),E.setElapsed(this.elapsed),requestAnimationFrame(o=>this.step(o))}destroy(){}};var Ke=class{constructor(t,e,o){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=t,this.url=e,this.config=o}};function Pr(r,t,e,o){return t||(t=r+e),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(t)?t:o?o.baseURL+o.path+t:t}function kr(r){return r.data=new Image,r.crossOrigin&&(r.data.crossOrigin=r.crossOrigin),new Promise((t,e)=>{r.data.onload=()=>{r.data.onload&&(r.data.onload=null,r.data.onerror=null,t(r))},r.data.onerror=o=>{r.data.onload&&(r.data.onload=null,r.data.onerror=null,r.error=o,e(r))},r.data.src=r.url,r.data.complete&&r.data.width&&r.data.height&&(r.data.onload=null,r.data.onerror=null,t(r))})}function Ct(r,t,e){let o=new Ke(r,t);return o.load=()=>(o.url=Pr(o.key,o.url,".png",o.loader),o.loader&&(o.crossOrigin=o.loader.crossOrigin),new Promise((i,s)=>{let a=P.get();a.has(o.key)?i(o):kr(o).then(m=>{a.add(m.key,m.data,e),i(m)}).catch(m=>{s(m)})})),o}var Je=class extends Z{constructor(){super();this.baseURL="",this.path="",this.crossOrigin="anonymous",this.maxParallelDownloads=-1,this.isLoading=!1,this.reset()}reset(){this.isLoading=!1,this.queue=new Set,this.inflight=new Set,this.completed=new Set,this.progress=0}add(...t){return t.forEach(e=>{e.loader=this,this.queue.add(e)}),this}start(){return this.isLoading?null:new Promise((t,e)=>{this.completed.clear(),this.progress=0,this.queue.size>0?(this.isLoading=!0,this.onComplete=t,this.onError=e,R(this,"start"),this.nextFile()):(this.progress=1,R(this,"complete"),t(this))})}nextFile(){let t=this.queue.size;if(this.maxParallelDownloads!==-1&&(t=Math.min(t,this.maxParallelDownloads)-this.inflight.size),t){let e=this.queue.values();for(;t>0;){let o=e.next().value;this.inflight.add(o),this.queue.delete(o),o.load().then(i=>this.fileComplete(i)).catch(i=>this.fileError(i)),t--}}else this.inflight.size===0&&this.stop()}stop(){!this.isLoading||(this.isLoading=!1,R(this,"complete",this.completed),this.onComplete(),this.completed.clear())}updateProgress(t){this.inflight.delete(t),this.completed.add(t);let e=this.completed.size,o=this.queue.size+this.inflight.size;e>0&&(this.progress=e/(e+o)),R(this,"progress",this.progress,e,o),this.nextFile()}fileComplete(t){R(this,"filecomplete",t),this.updateProgress(t)}fileError(t){R(this,"fileerror",t),this.updateProgress(t)}totalFilesToLoad(){return this.queue.size+this.inflight.size}setBaseURL(t=""){return t!==""&&t.substr(-1)!=="/"&&(t=t.concat("/")),this.baseURL=t,this}setPath(t=""){return t!==""&&t.substr(-1)!=="/"&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}setMaxParallelDownloads(t){return this.maxParallelDownloads=t,this}};function Wr(r,t,e){return Object.prototype.hasOwnProperty.call(r,t)?r[t]:e}function Yr(r,t={}){let e=Qt.get(),o=e.scenes.size,i=e.sceneIndex,s=o===0;typeof t=="string"?r.key=t:(t||!t&&s)&&(r.key=Wr(t,"key","scene"+i.toString())),e.scenes.has(r.key)?console.warn("Scene key already in use: "+r.key):(e.scenes.set(r.key,r),e.flush=!0,e.sceneIndex++)}var tr=class{constructor(t){this.game=E.get(),this.events=new Map,Yr(this,t)}};function Tt(r){let{a:t,b:e,c:o,d:i,tx:s,ty:a}=r.world,{x:m,y:f,right:c,bottom:h}=r.extent,S=m*t+f*o+s,g=m*e+f*i+a,M=m*t+h*o+s,b=m*e+h*i+a,Y=c*t+h*o+s,X=c*e+h*i+a,C=c*t+f*o+s,mo=c*e+f*i+a;return{x0:S,y0:g,x1:M,y1:b,x2:Y,y2:X,x3:C,y3:mo}}var jt=class{constructor(t){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=t,this.area=new y}set(t,e,o,i){this.area.set(t,e,o,i)}get(){return this.entity.isDirty(d.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){let{x0:t,y0:e,x1:o,y1:i,x2:s,y2:a,x3:m,y3:f}=Tt(this.entity.transform),c=Math.min(t,o,s,m),h=Math.min(e,i,a,f),S=Math.max(t,o,s,m),g=Math.max(e,i,a,f);return this.area.set(c,h,S-c,g-h)}update(){let t=this.updateLocal();if(this.entity.clearDirty(d.BOUNDS),!this.includeChildren||!this.entity.numChildren)return t;let e=this.visibleOnly,o=this.entity.children,i=t.x,s=t.y,a=t.right,m=t.bottom;for(let f=0;f<o.length;f++){let c=o[f];if(!c||e&&!c.visible)continue;let h=c.bounds.get();h.x<i&&(i=h.x),h.y<s&&(s=h.y),h.right>a&&(a=h.right),h.bottom>m&&(m=h.bottom)}return t.set(i,s,a-i,m-s)}destroy(){this.entity=null,this.area=null}};var qt=class{constructor(t){this.enabled=!1,this.enabledChildren=!0,this.entity=t}destroy(){this.entity=null,this.hitArea=null}};function er(){return p.get(l.DEFAULT_ORIGIN).x}function rr(){return p.get(l.DEFAULT_ORIGIN).y}var u=class{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}toArray(t=[],e=0){let{x:o,y:i}=this;return t[e]=o,t[e+1]=i,t}fromArray(t,e=0){return this.set(t[e],t[e+1])}toString(){let{x:t,y:e}=this;return`{ x=${t}, y=${e} }`}};function nr(r){let t=r.local,e=r.position.x,o=r.position.y,i=r.rotation,s=r.scale.x,a=r.scale.y,m=r.skew.x,f=r.skew.y;t.set(Math.cos(i+f)*s,Math.sin(i+f)*s,-Math.sin(i-m)*a,Math.cos(i-m)*a,e,o)}function ir(r,t){let{a:e,b:o,c:i,d:s,tx:a,ty:m}=r;return t.set(e,o,i,s,a,m)}function sr(r){let t=r.parent,e=r.transform,o=e.local,i=e.world;if(!t)ir(o,i);else if(e.passthru)ir(t.transform.world,i);else{let{a:s,b:a,c:m,d:f,tx:c,ty:h}=o,{a:S,b:g,c:M,d:b,tx:Y,ty:X}=t.transform.world;i.set(s*S+a*M,s*g+a*b,m*S+f*M,m*g+f*b,c*S+h*M+Y,c*g+h*b+X)}}var $t=class{constructor(t,e=0,o=0){this.passthru=!1,this._rotation=0,this.entity=t,this.local=new U,this.world=new U;let i=()=>this.update(),s=()=>this.updateExtent();this.position=new D(i,e,o),this.scale=new D(i,1,1),this.skew=new D(i),this.origin=new D(s,er(),rr()),this.extent=new y}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(d.TRANSFORM,d.BOUNDS),nr(this)}updateWorld(){let t=this.entity;t.setDirty(d.TRANSFORM,d.BOUNDS),sr(t),t.numChildren&&this.updateChildren()}updateChildren(){let t=this.entity.children;for(let e=0;e<t.length;e++)t[e].transform.updateWorld()}globalToLocal(t,e,o=new u){let{a:i,b:s,c:a,d:m,tx:f,ty:c}=this.world,h=1/(i*m+a*-s);return o.x=m*h*t+-a*h*e+(c*a-f*m)*h,o.y=i*h*e+-s*h*t+(-c*i+f*s)*h,o}localToGlobal(t,e,o=new u){let{a:i,b:s,c:a,d:m,tx:f,ty:c}=this.world;return o.x=i*t+a*e+f,o.y=s*t+m*e+c,o}setExtent(t,e,o,i){this.extent.set(t,e,o,i),this.entity.setDirty(d.TRANSFORM,d.BOUNDS)}updateExtent(t,e){let o=this.extent,i=this.entity;t!==void 0&&(o.width=t),e!==void 0&&(o.height=e),o.x=-this.origin.x*o.width,o.y=-this.origin.y*o.height,i.setDirty(d.TRANSFORM,d.BOUNDS)}set rotation(t){t!==this._rotation&&(this._rotation=t,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}};function ar(r,t){return(((t*255|0)&255)<<24|r)>>>0}var k=class{constructor(t=0,e=0,o=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.texture=0,this.tint=16777215,this.alpha=1,this.color=4294967295,this.x=t,this.y=e,this.z=o}setPosition(t,e,o=0){return this.x=t,this.y=e,this.z=o,this}setUV(t,e){return this.u=t,this.v=e,this}setColor(t,e=1){return this.tint=t,this.alpha=e,this.packColor(),this}setAlpha(t){return this.alpha=t,this}setTint(t){return this.tint=t,this}packColor(){this.color=ar(this.tint,this.alpha)}};function qr(r,t){let{F32:e,U32:o,offset:i}=Ht(t,1),s=Ne(t,r.texture),a=i;r.vertices.forEach(m=>{e[a+0]=m.x,e[a+1]=m.y,e[a+2]=m.u,e[a+3]=m.v,e[a+4]=s,o[a+5]=m.color,a+=6})}var W=class{constructor(t=0,e=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map,this.transform=new $t(this,t,e),this.bounds=new jt(this),this.input=new qt(this),this.dirty=d.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(t){return(this.dirty&t)!=0}clearDirty(t){return this.isDirty(t)&&(this.dirty^=t),this}setDirty(t,e){return this.isDirty(t)||(this.dirty^=t,this.dirtyFrame=E.getFrame()),this.isDirty(e)||(this.dirty^=e),this}update(t,e){if(this.willUpdateChildren){let o=this.children;for(let i=0;i<o.length;i++){let s=o[i];s&&s.willUpdate&&s.update(t,e)}}this.postUpdate(t,e)}postUpdate(t,e){}renderGL(t){}renderCanvas(t){}postRenderGL(t){}postRenderCanvas(t){}get numChildren(){return this.children.length}destroy(t){t?ae(this,t):ne(this),R(this,tt,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}};var Zt=class extends W{constructor(t=0,e=0){super(t,e);this._alpha=1,this.type="Container"}setSize(t,e=t){return this.transform.updateExtent(t,e),this}setPosition(t,e){return this.transform.position.set(t,e),this}setOrigin(t,e=t){return this.transform.origin.set(t,e),this}setSkew(t,e=t){return this.transform.skew.set(t,e),this}setScale(t,e=t){return this.transform.scale.set(t,e),this}setRotation(t){return this.transform.rotation=t,this}set width(t){this.transform.updateExtent(t)}get width(){return this.transform.extent.width}set height(t){this.transform.updateExtent(void 0,t)}get height(){return this.transform.extent.height}set x(t){this.transform.position.x=t}get x(){return this.transform.position.x}set y(t){this.transform.position.y=t}get y(){return this.transform.position.y}set originX(t){this.transform.origin.x=t}get originX(){return this.transform.origin.x}set originY(t){this.transform.origin.y=t}get originY(){return this.transform.origin.y}set skewX(t){this.transform.skew.x=t}get skewX(){return this.transform.skew.x}set skewY(t){this.transform.skew.y=t}get skewY(){return this.transform.skew.y}set scaleX(t){this.transform.scale.x=t}get scaleX(){return this.transform.scale.x}set scaleY(t){this.transform.scale.y=t}get scaleY(){return this.transform.scale.y}set rotation(t){this.transform.rotation=t}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty(d.TRANSFORM))}};function $r(r,t){let e=r.frame;if(!e)return;let o=t.ctx,i=r.transform,{a:s,b:a,c:m,d:f,tx:c,ty:h}=i.world,{x:S,y:g}=i.extent;o.save(),o.setTransform(s,a,m,f,c,h),o.globalAlpha=r.alpha,o.drawImage(e.texture.image,e.x,e.y,e.width,e.height,S,g,e.width,e.height),o.restore()}function Zr(r){return r.vertices.forEach(t=>{t.packColor()}),r}function Kt(r,t,...e){let o=r.getFrame(t),{u0:i,u1:s,v0:a,v1:m,pivot:f}=o;return e.forEach(c=>{if(!c||o===c.frame)return;c.frame=o,f&&c.setOrigin(f.x,f.y),c.frame.setExtent(c),c.hasTexture=!0;let h=c.vertices;h[0].setUV(i,a),h[1].setUV(i,m),h[2].setUV(s,m),h[3].setUV(s,a)}),e}function Kr(r,t,...e){if(!r)e.forEach(o=>{o.texture=null,o.frame=null,o.hasTexture=!1});else{let o;r instanceof w?o=r:o=P.get().get(r),o?(e.forEach(i=>{i.texture=o}),Kt(o,t,...e)):console.warn(`Invalid Texture key: ${r}`)}return e}function Jr(r){let t=r.vertices,{x0:e,y0:o,x1:i,y1:s,x2:a,y2:m,x3:f,y3:c}=Tt(r.transform);return t[0].setPosition(e,o),t[1].setPosition(i,s),t[2].setPosition(a,m),t[3].setPosition(f,c),r}var T=class extends Zt{constructor(t,e,o,i){super(t,e);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertices=[new k,new k,new k,new k],this.setTexture(o,i)}setTexture(t,e){return Kr(t,e,this),this}setFrame(t){return Kt(this.texture,t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(d.COLORS)&&(Zr(this),this.clearDirty(d.COLORS)),this.isDirty(d.TRANSFORM)&&(Jr(this),this.clearDirty(d.TRANSFORM))}renderGL(t){this.preRender(),qr(this,t)}renderCanvas(t){this.preRender(),$r(this,t)}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.vertices.forEach(e=>{e.setAlpha(t)}),this.setDirty(d.COLORS))}get tint(){return this._tint}set tint(t){t!==this._tint&&(this._tint=t,this.vertices.forEach(e=>{e.setTint(t)}),this.setDirty(d.COLORS))}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertices=[]}};var mr="worldrender";var fr="worldshutdown";function cr(r,t){t.numRendered++,t.numRenderable++,r.node.dirtyFrame>=t.gameFrame&&t.dirtyFrame++,r.children.forEach(e=>{e.children.length>0&&cr(e,t)})}function eo(r){if(r.node.isDirty(d.CHILD_CACHE))return!0;let t=[r];for(;t.length>0;){let e=t.pop();if(e.node.isDirty(d.TRANSFORM))return!0;let o=e.children.length;if(o>0)for(let i=0;i<o;i++)t.push(e.children[i])}return t.length=0,!1}function ro(r,t){r.forEach(e=>{t||eo(e)?e.node.setDirty(d.CHILD_CACHE):e.children.length=0})}function hr(r,t,e=[]){for(let o=0;o<t.numChildren;o++){let i=t.children[o];if(i.isRenderable()){let s=[],a={node:i,children:s};e.push(a),i.willRenderChildren&&i.numChildren>0&&(i.willCacheChildren&&r.push(a),hr(r,i,s))}}return e}function oo(r){let t=[],o=hr(t,r,[]),i=r.renderData;t.length>0&&ro(t,r.camera.dirtyRender),o.forEach(s=>{s.children.length>0?cr(s,i):(i.numRendered++,i.numRenderable++,s.node.dirtyFrame>=i.gameFrame&&i.dirtyFrame++)}),r.renderList=o,r.forceRefresh&&(i.dirtyFrame++,r.forceRefresh=!1)}function no(r,t){return r.a===t.a&&r.b===t.b&&r.c===t.c&&r.d===t.d&&r.tx===t.tx&&r.ty===t.ty}function io(r,t){r.numDirtyFrames+=t.dirtyFrame,r.numTotalFrames+=t.numRendered,t.camera.dirtyRender&&r.numDirtyCameras++,r.worldData.push(t)}function Jt(r,t){r.gameFrame=t,r.dirtyFrame=0,r.numRendered=0,r.numRenderable=0}var ur=class extends W{constructor(t){super();this.forceRefresh=!1,this.is3D=!1,this.type="BaseWorld",this.scene=t,this.world=this,this.events=new Map,this.renderList=[],this._updateListener=G(t,"update",(e,o)=>this.update(e,o)),this._renderListener=G(t,"render",e=>this.render(e)),this._shutdownListener=G(t,"shutdown",()=>this.shutdown()),St(t,"destroy",()=>this.destroy())}update(t,e){!this.willUpdate||(R(this,ee,t,e,this),super.update(t,e))}postUpdate(t,e){R(this,te,t,e,this)}render(t){let e=this.renderData;Jt(e,t.gameFrame),!(!this.willRender||!this.visible)&&(oo(this),R(this,mr,e,this),io(t,e),this.camera.dirtyRender=!1)}renderGL(t){let e=t.current2DCamera,o=this.camera;(!e||!no(o.worldTransform,e.worldTransform))&&F(t),Oe(t,o),this.renderList.forEach(i=>{i.children.length>0?this.renderNode(i,t):i.node.renderGL(t)})}renderNode(t,e){t.node.renderGL(e),t.children.forEach(o=>{o.children.length>0?this.renderNode(o,e):o.node.renderGL(e)}),t.node.postRenderGL(e)}postRenderGL(t){}shutdown(){let t=this.scene;gt(t,"update",this._updateListener),gt(t,"render",this._renderListener),gt(t,"shutdown",this._shutdownListener),se(this),R(this,fr,this),Jt(this.renderData,0),this.camera&&this.camera.reset()}destroy(t){super.destroy(t),R(this,tt,this),Jt(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}};function so(r,t){return{world:r,camera:t,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}var lr=class extends ur{constructor(t){super(t);this.type="StaticWorld",this.camera=new $,this.renderData=so(this,this.camera)}};var ao=class extends tr{constructor(){super();this.world=new lr(this);let t=new Je;t.setPath("assets/"),t.add(Ct("256","f-texture.png")),t.add(Ct("64","box-item-boxed.png")),t.add(Ct("32","shinyball.png")),t.add(Ct("16","skull.png")),t.start().then(this.create)}create(){let t=new T(400,300,"256");t.name="P";let e=new T(-128,-128,"64"),o=new T(128,-128,"64"),i=new T(-128,128,"64"),s=new T(128,128,"64");e.name="64A",o.name="64B",i.name="64C",s.name="64D";let a=new T(0,-32,"32"),m=new T(0,32,"32"),f=new T(-32,0,"32"),c=new T(32,0,"32");a.name="32A",m.name="32B",f.name="32C",c.name="32D";let h=new T(0,-16,"16"),S=new T(0,16,"16"),g=new T(-16,0,"16"),M=new T(16,0,"16");h.name="16A",S.name="16B",g.name="16C",M.name="16D",rt(t,e,o,i,s),rt(e,a,m,f,c),rt(a,h,S,g,M),et(this.world,t);let b=0;oe(this.world),G(this,"update",(Y,X)=>{t.rotation+=.005,e.rotation+=.01,a.rotation-=.03,t.scaleX=Math.cos(b),t.scaleY=Math.cos(b),b+=.01})}};new Ze(ke(),Vt(800,600),Lt("gameParent"),me(2960685),It(ao));})();
/**
 * @author       Niklas von Hertzen (https://github.com/niklasvh/base64-arraybuffer)
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
