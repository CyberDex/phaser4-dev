(()=>{var R={BACKGROUND_COLOR:"BackgroundColor",BATCH_SIZE:"BatchSize",DEFAULT_ORIGIN:"DefaultOrigin",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",SIZE:"Size",SCENES:"Scenes",RENDERER:"Renderer",AUTO:"Auto",WEBGL:"WebGL",CANVAS:"Canvas",WEBGL_CONTEXT:"WebGLContext",CANVAS_CONTEXT:"CanvasContext",BANNER:"Banner"};var S=new Map;function tt(t){S.set(R.BACKGROUND_COLOR,t)}function Gt(t){return()=>{tt(t)}}function rt(t="",e="",r="",o="#fff",n="linear-gradient(#3e0081 40%, #00bcc3)"){S.set(R.BANNER,{title:t,version:e,url:r,color:o,background:n})}function Ft(t){S.set(R.BATCH_SIZE,t)}function Ve(){return S.get(R.SIZE).height}function Ie(){return S.get(R.SIZE).resolution}function Me(){return S.get(R.SIZE).width}function ve(t=800,e=600,r=1){r===0&&(r=window.devicePixelRatio),S.set(R.SIZE,{width:t,height:e,resolution:r})}function ot(t=800,e=600,r=1){return()=>{ve(t,e,r)}}var zt=[],ge={add:(t,e)=>{zt.push({texture:t,glConfig:e})},get:()=>zt,clear:()=>{zt.length=0}};function At(){return S.get(R.BACKGROUND_COLOR)}function nt(t){S.set(R.RENDERER,t)}function Bt(t=.5,e=t){S.set(R.DEFAULT_ORIGIN,{x:t,y:e})}function ye(t){S.set(R.MAX_TEXTURES,t)}function Ge(t){let e;return t&&(typeof t=="string"?e=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(e=t)),e||(e=document.body),e}function kt(t){t&&S.set(R.PARENT,Ge(t))}function it(t){return()=>{kt(t)}}function Pt(t){S.set(R.SCENES,[].concat(t))}function at(t){return()=>{Pt(t)}}function mt(t,e,r){return t.width<=0||t.height<=0?!1:t.x<=e&&t.x+t.width>=e&&t.y<=r&&t.y+t.height>=r}var Q=class{constructor(e=0,r=0,o=0,n=0){this.set(e,r,o,n)}set(e=0,r=0,o=0,n=0){return this.x=e,this.y=r,this.width=o,this.height=n,this}contains(e,r){return mt(this,e,r)}set right(e){e<=this.x?this.width=0:this.width=e-this.x}get right(){return this.x+this.width}set bottom(e){e<=this.y?this.height=0:this.height=e-this.y}get bottom(){return this.y+this.height}};function Ot(t,e=0,r=0,o=0,n=0){let i=new Q(e,r,o,n);return t.viewportStack.push(i),i}var a,qo={get:()=>a,set:t=>{a=t}};function ie(t,e){if(!e&&(e=t.currentViewport,!e))return;let r=a.getParameter(a.VIEWPORT);(r[0]!==e.x||r[1]!==e.y||r[2]!==e.width||r[3]!==e.height)&&a.viewport(e.x,e.y,e.width,e.height)}function Qt(t,e=0,r=0,o=0,n=0){let i=Ot(t,e,r,o,n);ie(t,i),t.currentViewport=i}function ae(t,e=!0,r){r||(r=t.currentFramebuffer);let{framebuffer:o,viewport:n}=r;a.bindFramebuffer(a.FRAMEBUFFER,o),e&&(a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)),n&&Qt(t,n.x,n.y,n.width,n.height)}function _t(t){let e=t.viewportStack;e.length>1&&e.pop(),t.currentViewport=e[e.length-1],ie(t)}function Nt(t){let e=t.framebufferStack;e.length>1&&(t.currentFramebuffer.viewport&&_t(t),e.pop()),t.currentFramebuffer=e[e.length-1],ae(t,!1)}function Ut(t,e,r){let o={framebuffer:e,viewport:r};return t.framebufferStack.push(o),o}function Wt(t,e,r=!0,o){let n=Ut(t,e,o);ae(t,r,n),t.currentFramebuffer=n}function jt(t){let e=t.count;if(e===0)return;let r=t.currentVertexBuffer,o=t.currentShader,n=o.shader.renderToFramebuffer;if(n&&Wt(t,o.shader.framebuffer,!0),e===r.batchSize){let i=r.isDynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW;a.bufferData(a.ARRAY_BUFFER,r.data,i)}else{let i=r.indexed?e*r.entryElementSize:e*r.vertexElementSize,m=r.vertexViewF32.subarray(0,i);a.bufferSubData(a.ARRAY_BUFFER,0,m)}r.indexed?a.drawElements(a.TRIANGLES,e*r.entryIndexSize,a.UNSIGNED_SHORT,0):a.drawArrays(a.TRIANGLES,0,e),n&&Nt(t)}function $(t,e){e&&(t.count=e);let r=t.count;return r===0?!1:(jt(t),t.prevCount=r,t.count=0,t.flushTotal++,!0)}function Ht(t){$(t)}function Xo(t,e=[]){let r=t>>16&255,o=t>>8&255,n=t&255,i=t>16777215?t>>>24:255;return e[0]=r/255,e[1]=o/255,e[2]=n/255,e[3]=i/255,e}function Yo(){return S.get(R.WEBGL_CONTEXT)}function st(t){let{parent:e,flipY:r,unpackPremultiplyAlpha:o,minFilter:n,magFilter:i,wrapS:m,wrapT:s,generateMipmap:c,isPOT:u}=t,f=e.image,l=e.width,d=e.height,I=a.createTexture();return a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,I),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,r),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),f?(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f),l=f.width,d=f.height):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,l,d,0,a.RGBA,a.UNSIGNED_BYTE,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,m),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,s),c&&u&&a.generateMipmap(a.TEXTURE_2D),t.texture=I,I}function ct(t){a&&a.isFramebuffer(t)&&a.deleteFramebuffer(t)}function Fe(t){a.isTexture(t)&&a.deleteTexture(t)}function qt(t,e){return t<1||e<1?!1:(t&t-1)==0&&(e&e-1)==0}function Zo(t,e=!0){a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,t);let r=e?a.LINEAR:a.NEAREST;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,r)}function $o(t){let e=t.parent.image,r=e.width,o=e.height;return r>0&&o>0&&(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,t.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e)),t.texture}var ze=class{constructor(e,r={}){this.index=0;this.indexCounter=-1;this.dirtyIndex=!0;this.unpackPremultiplyAlpha=!0;this.flipY=!1;this.isPOT=!1;this.generateMipmap=!1;this.parent=e,this.isPOT=qt(e.width,e.height);let{texture:o=null,framebuffer:n=null,depthbuffer:i=null,unpackPremultiplyAlpha:m=!0,minFilter:s=this.isPOT?a.LINEAR_MIPMAP_LINEAR:a.LINEAR,magFilter:c=a.LINEAR,wrapS:u=a.CLAMP_TO_EDGE,wrapT:f=a.CLAMP_TO_EDGE,generateMipmap:l=this.isPOT,flipY:d=!1}=r;this.minFilter=s,this.magFilter=c,this.wrapS=u,this.wrapT=f,this.generateMipmap=l,this.flipY=d,this.unpackPremultiplyAlpha=m,n&&(this.framebuffer=n),i&&(this.depthbuffer=i),o?this.texture=o:st(this)}setFilter(e){this.texture&&Zo(this.texture,e)}create(){let e=this.texture;return e&&Fe(e),st(this)}update(){return this.texture?$o(this):st(this)}setIndex(e){this.dirtyIndex=e!==this.index,this.index=e}destroy(){Fe(this.texture),ct(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}};function Xt(){ge.get().forEach(e=>{let{texture:r,glConfig:o}=e;r.binding||(r.binding=new ze(r,o))}),ge.clear()}function Ae(){return S.get(R.MAX_TEXTURES)}var li=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function di(t){let e="";for(let r=0;r<t;++r)r>0&&(e+=`
else `),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function Yt(t){let e=a.createShader(a.FRAGMENT_SHADER);for(;;){let r=li.replace(/%forloop%/gi,di(t));if(a.shaderSource(e,r),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))t=t/2|0;else break}return t}function Zt(t){let e=Yt(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS)),r=Ae();r===0||r>0&&r>e?ye(e):r>0&&r<e&&(e=Math.max(8,r));let o=t.tempTextures;o.length&&o.forEach(i=>{a.deleteTexture(i)});let n=[];for(let i=0;i<e;i++){let m=a.createTexture();a.activeTexture(a.TEXTURE0+i),a.bindTexture(a.TEXTURE_2D,m),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),o[i]=m,n.push(i)}t.maxTextures=e,t.textureIndex=n,t.currentActiveTexture=1}function Ko(){return S.get(R.BATCH_SIZE)}function Re(t){a.isBuffer(t)&&a.deleteBuffer(t)}var me=class{constructor(e={}){this.indexed=!1;this.isDynamic=!1;this.count=0;this.offset=0;let{batchSize:r=1,dataSize:o=4,isDynamic:n=!0,elementsPerEntry:i=4,vertexElementSize:m=6}=e;this.batchSize=r,this.dataSize=o,this.vertexElementSize=m,this.isDynamic=n,this.elementsPerEntry=i,this.vertexByteSize=m*o,this.entryByteSize=this.vertexByteSize*i,this.bufferByteSize=r*this.entryByteSize,this.create()}resize(e){this.batchSize=e,this.bufferByteSize=e*this.entryByteSize,this.vertexBuffer&&Re(this.vertexBuffer),this.create()}create(){let e=new ArrayBuffer(this.bufferByteSize);this.data=e,this.vertexViewF32=new Float32Array(e),this.vertexViewU32=new Uint32Array(e),this.vertexBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);let r=this.isDynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW;a.bufferData(a.ARRAY_BUFFER,e,r),a.bindBuffer(a.ARRAY_BUFFER,null)}add(e){this.count+=e,this.offset+=this.vertexElementSize*e}reset(){this.count=0,this.offset=0}canContain(e){return this.count+e<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer)}destroy(){Re(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}};var Be=class extends me{constructor(e={}){super(e);let{indexSize:r=4,entryIndexSize:o=6,indexLayout:n=null}=e;this.indexed=!0,this.indexSize=r,this.entryIndexSize=o,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;let i=[];if(n){this.indexLayout=n;for(let m=0;m<this.batchSize*r;m+=r)for(let s=0;s<n.length;s++)i.push(m+n[s])}this.create(),this.createIndexBuffer(i)}createIndexBuffer(e){this.index=new Uint16Array(e),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.index,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),e=[]}bind(){a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),Re(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}};var en="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ii=new Uint8Array(256);for(let t=0;t<en.length;t++)Ii[en.charCodeAt(t)]=t;function X(){}var x=class{constructor(e){let r=new Float32Array(16);this.data=r,this.onChange=X,e?Array.isArray(e)?this.fromArray(e):this.fromArray(e.data):(r[0]=1,r[5]=1,r[10]=1,r[15]=1)}set(e,r,o,n,i,m,s,c,u,f,l,d,I,V,g,M){let h=this.data;return h[0]=e,h[1]=r,h[2]=o,h[3]=n,h[4]=i,h[5]=m,h[6]=s,h[7]=c,h[8]=u,h[9]=f,h[10]=l,h[11]=d,h[12]=I,h[13]=V,h[14]=g,h[15]=M,this.onChange(this),this}toArray(e=[],r=0){let o=this.data;for(let n=0;n<16;n++)e[r+n]=o[n];return e}fromArray(e,r=0){let o=this.data;for(let n=0;n<16;n++)o[n]=e[r+n];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=X,this.data=null}};function Kt(t,e,r,o,n,i,m=new x){let s=1/(t-e),c=1/(r-o),u=1/(n-i);return m.set(-2*s,0,0,0,0,-2*c,0,0,0,0,2*u,0,(t+e)*s,(o+r)*c,(i+n)*u,1)}function Jt(t,e){let r=new Map,o={size:1,type:a.FLOAT,normalized:!1,stride:0,offset:0},n=a.getProgramParameter(t,a.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){let m=a.getActiveAttrib(t,i);if(!m)break;let s=m.name,c=a.getAttribLocation(t,s);a.enableVertexAttribArray(c);let u=e.hasOwnProperty(s)?e[s]:{},{size:f=o.size,type:l=o.type,normalized:d=o.normalized,stride:I=o.stride,offset:V=o.offset}=u;r.set(s,{index:c,size:f,type:l,normalized:d,stride:I,offset:V})}return r}function ke(...t){t.forEach(e=>{a.deleteShader(e)})}function er(...t){let e=a.createProgram();if(t.forEach(o=>{a.attachShader(e,o)}),a.linkProgram(e),!a.getProgramParameter(e,a.LINK_STATUS)){let o=a.getProgramInfoLog(e);return console.error(`Error linking program: ${o}`),a.deleteProgram(e),ke(...t),null}return e}function ut(t,e){let r=a.createShader(e);if(a.shaderSource(r,t),a.compileShader(r),!a.getShaderParameter(r,a.COMPILE_STATUS)){let n=a.getShaderInfoLog(r),i=t.split(`
`).map((m,s)=>`${s}: ${m}`);return console.error(`Error compiling shader: ${n}`,i.join(`
`)),a.deleteShader(r),null}return r}function tr(t,e,r=!1){switch(t.type){case a.INT:case a.BOOL:return r?o=>{a.uniform1iv(e,o)}:o=>{a.uniform1i(e,o)};case a.INT_VEC2:case a.BOOL_VEC2:return o=>{a.uniform2iv(e,o)};case a.INT_VEC3:case a.BOOL_VEC3:return o=>{a.uniform3iv(e,o)};case a.INT_VEC4:case a.BOOL_VEC4:return o=>{a.uniform4iv(e,o)};case a.FLOAT:return r?o=>{a.uniform1fv(e,o)}:o=>{a.uniform1f(e,o)};case a.FLOAT_VEC2:return o=>{a.uniform2fv(e,o)};case a.FLOAT_VEC3:return o=>{a.uniform3fv(e,o)};case a.FLOAT_VEC4:return o=>{a.uniform4fv(e,o)};case a.FLOAT_MAT2:return o=>{a.uniformMatrix2fv(e,!1,o)};case a.FLOAT_MAT3:return o=>{a.uniformMatrix3fv(e,!1,o)};case a.FLOAT_MAT4:return o=>{a.uniformMatrix4fv(e,!1,o)};case a.SAMPLER_2D:case a.SAMPLER_CUBE:return t.size>1?o=>{a.uniform1iv(e,o)}:o=>{a.uniform1i(e,o)}}}function rr(t){let e=new Map,r=a.getProgramParameter(t,a.ACTIVE_UNIFORMS);for(let o=0;o<r;o++){let n=a.getActiveUniform(t,o),i=n.name;if(i.startsWith("gl_")||i.startsWith("webgl_"))continue;let m=a.getUniformLocation(t,n.name);if(m){let s=!1;i.substr(-3)==="[0]"&&(i=i.substr(0,i.length-3),s=n.size>1),e.set(i,tr(n,m,s))}}return e}var tn=5121;var ee=5126;var Se={aVertexPosition:{size:2,type:ee,normalized:!1,offset:0},aTextureCoord:{size:2,type:ee,normalized:!1,offset:8},aTextureId:{size:1,type:ee,normalized:!1,offset:16},aTintColor:{size:4,type:tn,normalized:!0,offset:20}};var or={uProjectionMatrix:new Float32Array,uCameraMatrix:new Float32Array,uTexture:0};function rn(t,e,r){a.bindFramebuffer(a.FRAMEBUFFER,t);let o=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,o),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,e,r),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,o),a.bindFramebuffer(a.FRAMEBUFFER,null),o}function on(t,e){e||(e=a.COLOR_ATTACHMENT0);let r=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,r),a.framebufferTexture2D(a.FRAMEBUFFER,e,a.TEXTURE_2D,t,0),a.bindFramebuffer(a.FRAMEBUFFER,null),r}var nn=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var an=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;var ft=class{constructor(e,r,o,n,i,m){this.trimmed=!1;this.texture=e,this.key=r,this.x=o,this.y=n,this.width=i,this.height=m,this.sourceSizeWidth=i,this.sourceSizeHeight=m,this.updateUVs()}setPivot(e,r){this.pivot={x:e,y:r}}setSize(e,r){this.width=e,this.height=r,this.sourceSizeWidth=e,this.sourceSizeHeight=r,this.updateUVs()}setSourceSize(e,r){this.sourceSizeWidth=e,this.sourceSizeHeight=r}setTrim(e,r,o,n,i,m){this.trimmed=!0,this.sourceSizeWidth=e,this.sourceSizeHeight=r,this.spriteSourceSizeX=o,this.spriteSourceSizeY=n,this.spriteSourceSizeWidth=i,this.spriteSourceSizeHeight=m}getExtent(e,r){let o=this.sourceSizeWidth,n=this.sourceSizeHeight,i,m,s,c;return this.trimmed?(i=this.spriteSourceSizeX-e*o,m=i+this.spriteSourceSizeWidth,s=this.spriteSourceSizeY-r*n,c=s+this.spriteSourceSizeHeight):(i=-e*o,m=i+o,s=-r*n,c=s+n),{left:i,right:m,top:s,bottom:c}}setExtent(e){let r=e.transform,o=r.origin.x,n=r.origin.y,i=this.sourceSizeWidth,m=this.sourceSizeHeight,s,c,u,f;this.trimmed?(s=this.spriteSourceSizeX-o*i,c=this.spriteSourceSizeY-n*m,u=this.spriteSourceSizeWidth,f=this.spriteSourceSizeHeight):(s=-o*i,c=-n*m,u=i,f=m),r.setExtent(s,c,u,f)}updateUVs(){let{x:e,y:r,width:o,height:n}=this,i=this.texture.width,m=this.texture.height;this.u0=e/i,this.v0=r/m,this.u1=(e+o)/i,this.v1=(r+n)/m}};var Y=class{constructor(e,r,o,n){this.key="";e&&(r=e.width,o=e.height),this.image=e,this.width=r,this.height=o,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,r,o),ge.add(this,n)}addFrame(e,r,o,n,i){if(this.frames.has(e))return null;let m=new ft(this,e,r,o,n,i);return this.frames.set(e,m),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=m),m}getFrame(e){if(!e)return this.firstFrame;e instanceof ft&&(e=e.key);let r=this.frames.get(e);return r||(console.warn(`Frame missing: ${e}`),r=this.firstFrame),r}setSize(e,r){this.width=e,this.height=r,this.frames.get("__BASE").setSize(e,r)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}};var we=class{constructor(e){this.renderToFramebuffer=!1;this.renderToDepthbuffer=!1;e&&this.fromConfig(e)}fromConfig(e){let{attributes:r=Se,fragmentShader:o=nn,height:n=Ve(),renderToFramebuffer:i=!1,renderToDepthbuffer:m=!1,resolution:s=Ie(),vertexShader:c=an,width:u=Me(),uniforms:f=or}=e;if(this.create(o,c,f,r),i){this.renderToFramebuffer=!0;let l=new Y(null,u*s,n*s),d=new ze(l);l.binding=d,d.framebuffer=on(d.texture),m&&(this.renderToDepthbuffer=!0,d.depthbuffer=rn(d.framebuffer,l.width,l.height)),this.texture=l,this.framebuffer=d.framebuffer}}create(e,r,o,n){let i=ut(e,a.FRAGMENT_SHADER),m=ut(r,a.VERTEX_SHADER);if(!i||!m)return;let s=er(i,m);if(!s)return;let c=a.getParameter(a.CURRENT_PROGRAM);a.useProgram(s),this.program=s,this.uniformSetters=rr(s),this.uniforms=new Map;for(let[u,f]of Object.entries(o))this.uniforms.set(u,f);this.attributes=Jt(s,n),a.useProgram(c)}updateUniforms(e){}bind(e){return this.updateUniforms(e),this.setUniforms(e)}setUniform(e,r){let o=this.uniforms;o.has(e)&&(o.set(e,r),this.uniformSetters.get(e)(r))}setUniforms(e){if(!this.program)return!1;a.useProgram(this.program);let r=this.uniforms;for(let[o,n]of this.uniformSetters.entries())n(r.get(o));return!0}setAttributes(e){if(this.program){let r=e.currentVertexBuffer.vertexByteSize;this.attributes.forEach(o=>{a.vertexAttribPointer(o.index,o.size,o.type,o.normalized,r,o.offset)})}}destroy(){ke(this.program),Fe(this.texture),ct(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}};var se=class extends we{constructor(e={}){let r=e;r.attributes=r.attributes?r.attributes:Se,super(r)}bind(e){let r=this.uniforms;return r.set("uProjectionMatrix",e.projectionMatrix.data),r.set("uCameraMatrix",e.cameraMatrix.data),super.bind(e)}};var mn=`#define SHADER_NAME MULTI_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];

void main (void)
{
    vec4 color;

    %forloop%

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var pt=class extends se{constructor(e={}){e.fragmentShader||(e.fragmentShader=mn),super(e)}create(e,r,o,n){let i=Ae(),m="";for(let s=1;s<i;s++)s>1&&(m+=`
	else `),s<i-1&&(m+=`if (vTextureId < ${s}.5)`),m+=`
	{`,m+=`
		color = texture2D(uTexture[${s}], vTextureCoord);`,m+=`
	}`;e=e.replace(/%count%/gi,`${i}`),e=e.replace(/%forloop%/gi,m),super.create(e,r,o,n)}bind(e){return this.uniforms.set("uTexture",e.textureIndex),super.bind(e)}};function nr(t,e,r,o){let n={enable:e,sfactor:r,dfactor:o};t.blendModeStack[0]=n,t.currentBlendMode=n,t.defaultBlendMode=n}function ir(t,e=null,r){let o={framebuffer:e,viewport:r};t.framebufferStack[0]=o,t.currentFramebuffer=o,t.defaultFramebuffer=o}function ar(t,e,r){let o={shader:e,textureID:r};t.shaderStack[0]=o,t.currentShader=o,t.defaultShader=o}function mr(t,e){t.vertexBufferStack[0]=e,t.currentVertexBuffer=e,t.defaultVertexBuffer=e}function sr(t,e=0,r=0,o=0,n=0){let i=new Q(e,r,o,n);t.viewportStack[0]=i,t.currentViewport=i,t.defaultViewport=i}var sn,cn=0,un=0,P={get:()=>sn,set:t=>{sn=t},getFrame:()=>cn,setFrame:t=>{cn=t},getElapsed:()=>un,setElapsed:t=>{un=t}};function cr(t,e,r,o=new x){let{x:n,y:i,z:m,w:s}=t,c=n+n,u=i+i,f=m+m,l=n*c,d=n*u,I=n*f,V=i*u,g=i*f,M=m*f,h=s*c,T=s*u,y=s*f,{x:w,y:L,z:v}=r,{x:z,y:B,z:_}=e;return o.set((1-(V+M))*w,(d+y)*w,(I-T)*w,0,(d-y)*L,(1-(l+M))*L,(g+h)*L,0,(I+T)*v,(g-h)*v,(1-(l+V))*v,0,z,B,_,1)}function ur(t,e,r=!0,o=new x){let{x:n,y:i,z:m}=e,s=Math.sin(t.x),c=Math.cos(t.x),u=Math.sin(t.y),f=Math.cos(t.y),l=n,d=i,I=m,V=-s,g=0-V*u,M=0-c*u,h=V*f,T=c*f;return r||(l=f*n+u*m,d=g*n+c*i+h*m,I=M*n+s*i+T*m),o.set(f,g,M,0,0,c,s,0,u,h,T,0,l,d,I,1)}var p=class{constructor(e=0,r=0,o=0){this.set(e,r,o)}set(e=0,r=0,o=0){return this.x=e,this.y=r,this.z=o,this}toArray(e=[],r=0){let{x:o,y:n,z:i}=this;return e[r]=o,e[r+1]=n,e[r+2]=i,e}fromArray(e,r=0){return this.set(e[r],e[r+1],e[r+2])}toString(){let{x:e,y:r,z:o}=this;return`{ x=${e}, y=${r}, z=${o} }`}};var C=class{constructor(e=0,r=0,o=0,n=1){this._x=e,this._y=r,this._z=o,this._w=n,this.onChange=X}set(e=0,r=0,o=0,n=1){return this._x=e,this._y=r,this._z=o,this._w=n,this.onChange(this),this}set x(e){let r=this._x;this._x=e,e!==r&&this.onChange(this)}get x(){return this._x}set y(e){let r=this._y;this._y=e,e!==r&&this.onChange(this)}get y(){return this._y}set z(e){let r=this._z;this._z=e,e!==r&&this.onChange(this)}get z(){return this._z}set w(e){let r=this._w;this._w=e,e!==r&&this.onChange(this)}get w(){return this._w}toArray(e=[],r=0){let{x:o,y:n,z:i,w:m}=this;return e[r]=o,e[r+1]=n,e[r+2]=i,e[r+3]=m,e}fromArray(e,r=0){return this.set(e[r],e[r+1],e[r+2],e[r+3])}destroy(){this.onChange=X}toString(){let{x:e,y:r,z:o,w:n}=this;return`{ x=${e}, y=${r}, z=${o}, w=${n} }`}};function Pe(t=new x){return t.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function Ce(t,e=new x){let[r,o,n,i,m,s,c,u,f,l,d,I,V,g,M,h]=t.data,T=d*h-M*I,y=l*h-g*I,w=l*M-g*d,L=f*h-V*I,v=f*M-d*V,z=f*g-V*l,B=+(s*T-c*y+u*w),_=-(m*T-c*L+u*v),U=+(m*y-s*L+u*z),F=-(m*w-s*v+c*z),k=r*B+o*_+n*U+i*F;if(k===0)return e;let G=1/k,N=c*h-M*u,j=s*h-g*u,J=s*M-g*c,Z=m*h-V*u,ne=m*M-V*c,Qo=m*g-V*s,_o=c*I-d*u,No=s*I-l*u,Uo=s*d-l*c,Wo=m*I-f*u,jo=m*d-f*c,Ho=m*l-f*s,ei=-(o*T-n*y+i*w),ti=+(r*T-n*L+i*v),ri=-(r*y-o*L+i*z),oi=+(r*w-o*v+n*z),ni=+(o*N-n*j+i*J),ii=-(r*N-n*Z+i*ne),ai=+(r*j-o*Z+i*Qo),mi=-(r*J-o*ne+n*Qo),si=-(o*_o-n*No+i*Uo),ci=+(r*_o-n*Wo+i*jo),ui=-(r*No-o*Wo+i*Ho),fi=+(r*Uo-o*jo+n*Ho);return e.set(B*G,ei*G,ni*G,si*G,_*G,ti*G,ii*G,ci*G,U*G,ri*G,ai*G,ui*G,F*G,oi*G,mi*G,fi*G)}function Oe(t,e,r=new x){let[o,n,i,m,s,c,u,f,l,d,I,V,g,M,h,T]=t.data,[y,w,L,v,z,B,_,U,F,k,G,N,j,J,Z,ne]=e.data;return r.set(y*o+w*s+L*l+v*g,w*n+w*c+L*d+v*M,L*i+w*u+L*I+v*h,v*m+w*f+L*V+v*T,z*o+B*s+_*l+U*g,z*n+B*c+_*d+U*M,z*i+B*u+_*I+U*h,z*m+B*f+_*V+U*T,F*o+k*s+G*l+N*g,F*n+k*c+G*d+N*M,F*i+k*u+G*I+N*h,F*m+k*f+G*V+N*T,j*o+J*s+Z*l+ne*g,j*n+J*c+Z*d+ne*M,j*i+J*u+Z*I+ne*h,j*m+J*f+Z*V+ne*T)}function fr(t,e,r,o,n=new x){let i=1/Math.tan(t/2),m=-1,s=-2*r;if(o!==null&&o!==Infinity){let c=1/(r-o);m=(o+r)*c,s=2*o*r*c}return n.set(i/e,0,0,0,0,i,0,0,0,0,m,-1,0,0,s,0)}function pr(t,e=new x){let[r,o,n,i,m,s,c,u,f,l,d,I,V,g,M,h]=t.data;return e.set(r,m,f,V,o,s,l,g,n,c,d,M,i,u,I,h)}var A=class{constructor(e=1,r=0,o=0,n=1,i=0,m=0){this.set(e,r,o,n,i,m)}set(e=1,r=0,o=0,n=1,i=0,m=0){return this.a=e,this.b=r,this.c=o,this.d=n,this.tx=i,this.ty=m,this}identity(){return this.set()}toArray(){let{a:e,b:r,c:o,d:n,tx:i,ty:m}=this;return[e,r,o,n,i,m]}fromArray(e){return this.set(e[0],e[1],e[2],e[3],e[4],e[5])}};var te={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};var lt=class{constructor(){this.type="StaticCamera",this.dirtyRender=!0;let e=P.get();this.renderer=e.renderer,this.matrix=Pe(),this.bounds=new Q,this.worldTransform=new A,this.reset()}reset(){let e=this.renderer;if(e){let r=e.width,o=e.height;this.width=r,this.height=o}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}};var dt=class{constructor(e){this.count=0;this.prevCount=0;this.flushTotal=0;this.maxTextures=0;this.currentActiveTexture=0;this.startActiveTexture=0;this.tempTextures=[];this.textureIndex=[];this.framebufferStack=[];this.currentFramebuffer=null;this.defaultFramebuffer=null;this.vertexBufferStack=[];this.currentVertexBuffer=null;this.defaultVertexBuffer=null;this.shaderStack=[];this.currentShader=null;this.defaultShader=null;this.viewportStack=[];this.currentViewport=null;this.defaultViewport=null;this.blendModeStack=[];this.currentBlendMode=null;this.defaultBlendMode=null;this.renderer=e,this.projectionMatrix=new x,this.reset()}reset(){let e=this.renderer.gl,r=[0,1,2,2,3,0];this.quadShader=new se,this.quadBuffer=new Be({isDynamic:!1,indexLayout:r}),this.quadCamera=new lt,Zt(this),ir(this),nr(this,!0,e.ONE,e.ONE_MINUS_SRC_ALPHA),mr(this,new Be({batchSize:Ko(),indexLayout:r})),ar(this,new pt)}resize(e,r){Kt(0,e,r,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),sr(this,0,0,e,r)}};function lr(t,e,r){let o={shader:e,textureID:r};return t.shaderStack.push(o),o}function dr(t,e){return t.vertexBufferStack.push(e),e}function Te(t,e){e||(e=t.currentShader),e.shader.bind(t,e.textureID)&&e.shader.setAttributes(t)}function Qe(t,e){e||(e=t.currentBlendMode),e.enable?(a.enable(a.BLEND),a.blendFunc(e.sfactor,e.dfactor)):a.disable(a.BLEND)}function ce(t,e){e||(e=t.currentVertexBuffer);let r=e.indexed?e.indexBuffer:null;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),a.bindBuffer(a.ARRAY_BUFFER,e.vertexBuffer)}function hr(t){let e=t.vertexBufferStack;e.length>1&&e.pop(),t.currentVertexBuffer=e[e.length-1],ce(t)}function xr(t,e){let r=dr(t,e);ce(t,r),t.currentVertexBuffer=r}function br(t,e){xr(t,e),t.currentShader.shader.setAttributes(t);let r=$(t,e.count);return hr(t),r}function Vr(t){let e=t.shaderStack;e.length>1&&e.pop(),t.currentShader=e[e.length-1],Te(t)}function Ir(t,e,r){let o=lr(t,e,r);Te(t,o),t.currentShader=o}function Mr(t,e){let r=e.binding,o=t.currentActiveTexture;return r.indexCounter<t.startActiveTexture&&(r.indexCounter=t.startActiveTexture,o<t.maxTextures?(r.setIndex(o),a.activeTexture(a.TEXTURE0+o),a.bindTexture(a.TEXTURE_2D,r.texture),t.currentActiveTexture++):($(t),t.startActiveTexture++,r.indexCounter=t.startActiveTexture,r.setIndex(1),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,r.texture),t.currentActiveTexture=2)),r.index}function gr(t){t.current2DCamera=t.quadCamera,t.cameraMatrix=t.quadCamera.matrix,t.count=0,t.flushTotal=0,ae(t,!1,t.defaultFramebuffer),Qe(t,t.defaultBlendMode),ie(t,t.defaultViewport),ce(t,t.defaultVertexBuffer)}var pn,yr={get:()=>pn,set:t=>{pn=t}};var Rr=class{constructor(){this.clearColor=[0,0,0,1];this.clearBeforeRender=!0;this.optimizeRedraw=!1;this.autoResize=!0;this.contextLost=!1;this.width=Me(),this.height=Ve(),this.resolution=Ie(),this.setBackgroundColor(At());let e=document.createElement("canvas");e.addEventListener("webglcontextlost",r=>this.onContextLost(r),!1),e.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=e,this.initContext(),yr.set(this),this.renderPass=new dt(this),this.resize(this.width,this.height,this.resolution)}initContext(){let e=this.canvas.getContext("webgl",Yo());qo.set(e),this.gl=e,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE)}resize(e,r,o=1){let n=e*o,i=r*o;this.width=n,this.height=i,this.resolution=o;let m=this.canvas;m.width=n,m.height=i,this.autoResize&&(m.style.width=e.toString()+"px",m.style.height=r.toString()+"px"),this.renderPass.resize(n,i)}onContextLost(e){e.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(e){return Xo(e,this.clearColor),this}reset(){}render(e){if(this.contextLost)return;let r=this.gl,o=this.renderPass;if(Xt(),this.optimizeRedraw&&e.numDirtyFrames===0&&e.numDirtyCameras===0)return;if(this.clearBeforeRender){let i=this.clearColor;r.clearColor(i[0],i[1],i[2],i[3]),r.clear(r.COLOR_BUFFER_BIT)}let n=e.worldData;gr(o);for(let i=0;i<n.length;i++){let{world:m}=n[i];m.renderGL(o),m.postRenderGL(o)}Ht(o)}destroy(){yr.set(void 0)}};function Sr(){return()=>{nt(Rr)}}function ln(t){let e=[t],r=[];for(;e.length>0;){let o=e.shift();r.push(o);let n=o.numChildren;if(n>0)for(let i=n-1;i>=0;i--)e.unshift(o.children[i])}return r.shift(),r}function dn(t,e){return t.children.indexOf(e)}function hn(t,e){let r=t.children,o;if(e>=0&&e<r.length){let n=r.splice(e,1);n[0]&&(o=n[0],o.parent=null)}return o}function ht(t,e){let r=dn(t,e);return r>-1&&hn(t,r),e}var xt="addedtoworld";var _e="destroy";var wr="postupdate";var bt="removedfromworld";var Cr="update";function E(t,e,...r){if(t.events.size===0||!t.events.has(e))return!1;let o=t.events.get(e);for(let n of o)n.callback.apply(n.context,r),n.once&&o.delete(n);return o.size===0&&t.events.delete(e),!0}function xn(t,...e){return e.forEach(r=>{r.world&&(E(r.world,bt,r,r.world),E(r,bt,r,r.world)),r.world=t,E(t,xt,r,t),E(r,xt,r,t)}),e}function bn(t,...e){e.forEach(o=>{o.parent&&ht(o.parent,o),o.parent=t});let r=t.world;return r&&xn(r,...ln(t)),e}function Vn(t,e){return t.children.push(e),bn(t,e),e}function In(t,...e){return e.forEach(r=>{Vn(t,r)}),e}function re(){return{vertices:[],normals:[],uvs:[],indices:[],numberOfVertices:0}}function ue(t,e=0,r=0,o=0,n=0,i=1,m=2,s=1,c=-1,u=1,f=1,l=1,d=1,I=1){t||(t=re());let{vertices:V,normals:g,uvs:M,indices:h,numberOfVertices:T}=t,y=u/d,w=f/I,L=u/2,v=f/2,z=l/2,B=d+1,_=I+1,U=0,F=[];for(let k=0;k<_;k++){let G=k*w-v;for(let N=0;N<B;N++){let j=N*y-L;F[n]=j*s,F[i]=G*c,F[m]=z,V.push(e+F[0],r+F[1],o+F[2]),F[n]=0,F[i]=0,F[m]=l>0?1:-1,g.push(F[0],F[1],F[2]),M.push(N/d),M.push(1-k/I),U+=1}}for(let k=0;k<I;k++)for(let G=0;G<d;G++){let N=T+G+B*k,j=T+G+B*(k+1),J=T+(G+1)+B*(k+1),Z=T+(G+1)+B*k;h.push(N,j,Z),h.push(j,J,Z)}return t.numberOfVertices+=U,t}function Mn(t=0,e=0,r=0,o=1,n=1,i=1,m=1,s=1,c=1){let u=re();return ue(u,t,e,r,2,1,0,-1,-1,i,n,o,c,s),ue(u,t,e,r,2,1,0,1,-1,i,n,-o,c,s),ue(u,t,e,r,0,2,1,1,1,o,i,n,m,c),ue(u,t,e,r,0,2,1,1,-1,o,i,-n,m,c),ue(u,t,e,r,0,1,2,1,-1,o,n,i,m,s),ue(u,t,e,r,0,1,2,-1,-1,o,n,-i,m,s),u}function Le(t,e){let r=t[e*3+0],o=t[e*3+1],n=t[e*3+2];return[r,o,n]}function Tr(t,e){let r=t[e*2+0],o=t[e*2+1];return[r,o]}function Ei(t){let{vertices:e,normals:r,uvs:o}=t,n=e.length,i=n/3,m=i/3,s=new me({batchSize:m,isDynamic:!1,vertexElementSize:8,elementsPerEntry:3}),c=s.vertexViewF32,u=0,f=0;for(let l=0;l<n;l+=3)c[u++]=e[l+0],c[u++]=e[l+1],c[u++]=e[l+2],c[u++]=r[l+0],c[u++]=r[l+1],c[u++]=r[l+2],c[u++]=o[f+0],c[u++]=o[f+1],f+=2;return s.count=i,s}function vi(t){let{vertices:e,normals:r,uvs:o,indices:n}=t,i=new me({batchSize:n.length/3,isDynamic:!1,vertexElementSize:8,elementsPerEntry:3}),m=i.vertexViewF32,s=0;for(let c=0;c<n.length;c+=3){let u=n[c+0],f=n[c+1],l=n[c+2],d=Le(e,u),I=Le(e,f),V=Le(e,l),g=Le(r,u),M=Le(r,f),h=Le(r,l),T=Tr(o,u),y=Tr(o,f),w=Tr(o,l);m[s++]=d[0],m[s++]=d[1],m[s++]=d[2],m[s++]=g[0],m[s++]=g[1],m[s++]=g[2],m[s++]=T[0],m[s++]=T[1],m[s++]=I[0],m[s++]=I[1],m[s++]=I[2],m[s++]=M[0],m[s++]=M[1],m[s++]=M[2],m[s++]=y[0],m[s++]=y[1],m[s++]=V[0],m[s++]=V[1],m[s++]=V[2],m[s++]=h[0],m[s++]=h[1],m[s++]=h[2],m[s++]=w[0],m[s++]=w[1]}return i.count=n.length,i}function gn(t){return t.indices&&t.indices.length>0?vi(t):Ei(t)}var fe=class{constructor(e){e&&(e.hasOwnProperty("vertices")?this.buffer=gn(e):this.buffer=e)}destroy(){this.buffer.destroy()}};var H={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};var oe=class{constructor(){this.events=new Map}};var De=class{constructor(e,r,o=!1){this.callback=e,this.context=r,this.once=o}};function Ne(t,e,r,o,n){let i=t.events,m=i.get(e);if(!r)i.delete(e);else if(r instanceof De)m.delete(r);else{let s=!o,c=n!==void 0;for(let u of m)u.callback===r&&s&&u.context===o&&c&&u.once===n&&m.delete(u)}return m.size===0&&i.delete(e),t}function W(t,e,r,o=t,n=!1){if(typeof r!="function")throw new TypeError("Listener not a function");let i=new De(r,o,n),m=t.events.get(e);return m?m.add(i):t.events.set(e,new Set([i])),i}function Ue(t,e,r,o=t){return W(t,e,r,o,!0)}function O(t,e,r){return Math.max(e,Math.min(r,t))}function pe(t,e,r,o=new C){let n=r*.5,i=e*.5,m=t*.5,s=Math.sin(n),c=Math.cos(n),u=Math.sin(i),f=Math.cos(i),l=Math.sin(m),d=Math.cos(m);return o.set(d*u*c+l*f*s,l*f*c-d*u*s,d*f*s-l*u*c,d*f*c+l*u*s)}function Dr(){return new p(0,0,-1)}function Er(){return new p(0,-1,0)}function le(){return new p(0,0,1)}function vr(){return new p(-1,0,0)}function de(){return new p(1,0,0)}function he(){return new p(0,1,0)}function Gr(){return new p(0,0,0)}var Fr=he(),Gi=Er(),Fi=vr(),zr=de(),Ar=le(),zi=Dr(),Ai=Gr();var q=class{constructor(e,r=0,o=0,n=0){this._x=r,this._y=o,this._z=n,this.onChange=e}destroy(){this.onChange=X}set(e=0,r=0,o=0){return this._x=e,this._y=r,this._z=o,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(e){let r=this._x;this._x=e,r!==e&&this.onChange(this)}get y(){return this._y}set y(e){let r=this._y;this._y=e,r!==e&&this.onChange(this)}get z(){return this._z}set z(e){let r=this._z;this._z=e,r!==e&&this.onChange(this)}toArray(e=[],r=0){let{x:o,y:n,z:i}=this;return e[r]=o,e[r+1]=n,e[r+2]=i,e}fromArray(e,r=0){return this.set(e[r],e[r+1],e[r+2])}toString(){let{x:e,y:r,z:o}=this;return`{ x=${e}, y=${r}, z=${o} }`}};var K=class extends q{constructor(e,r=0,o=0,n=0){super(e,r,o,n)}set r(e){this.x=e}get r(){return this.x}set g(e){this.y=e}get g(){return this.y}set b(e){this.z=e}get b(){return this.z}toString(){let{x:e,y:r,z:o}=this;return`[ r=${e}, g=${r}, b=${o} ]`}};function xe(t,e=new p){let{x:r,y:o,z:n}=t,i=r*r+o*o+n*n;return i>0&&(i=1/Math.sqrt(i)),e.set(r*i,o*i,n*i)}var g3=new x,y3=new x;function je(t,e,r,o=new p){return o.set(t.x+e.x*r,t.y+e.y*r,t.z+e.z*r)}function He(t,e,r=new p){let[o,n,i,m,s,c,u,f,l,d,I]=e.data,{x:V,y:g,z:M}=t;return r.set(o*V+s*g+l*M,n*V+c*g+d*M,i*V+u*g+I*M)}var m0=new x,s0=new p;function Pr(t,e,r=new C){e*=.5;let{x:o,y:n,z:i,w:m}=t,s=Math.sin(e),c=Math.cos(e);return r.set(o*c+m*s,n*c+i*s,i*c-n*s,m*c-o*s)}function Or(t,e,r=new C){e*=.5;let{x:o,y:n,z:i,w:m}=t,s=Math.sin(e),c=Math.cos(e);return r.set(o*c-i*s,n*c+m*s,i*c+o*s,m*c-n*s)}function Qr(t,e,r=new C){e*=.5;let{x:o,y:n,z:i,w:m}=t,s=Math.sin(e),c=Math.cos(e);return r.set(o*c+n*s,n*c-o*s,i*c+m*s,m*c-i*s)}var _r=class{constructor(e,r=0,o=0,n=0){this.passthru=!1;this.entity=e,this.local=new x,this.world=new x,this.normal=new x,this.position=new q(()=>this.update(),r,o,n),this.scale=new q(()=>this.update(),1,1,1),this.origin=new q(()=>this.update()),this.rotation=new C,this.rotation.onChange=()=>this.update(),this.forward=le(),this.up=he(),this.right=de(),this.update()}rotateX(e){Pr(this.rotation,e,this.rotation)}rotateY(e){Or(this.rotation,e,this.rotation)}rotateZ(e){Qr(this.rotation,e,this.rotation)}update(){let e=this.local,r=this.normal;cr(this.rotation,this.position,this.scale,e),Ce(e,r),pr(r,r)}updateLocal(){this.entity.setDirty(H.TRANSFORM,H.BOUNDS)}updateWorld(){let e=this.entity;e.setDirty(H.TRANSFORM,H.BOUNDS),e.numChildren&&this.updateChildren()}updateChildren(){let e=this.entity.children;for(let r=0;r<e.length;r++){let o=e[r]}}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.rotation.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.origin=null,this.rotation=null}};var qe=class{constructor(e=0,r=0,o=0){this.type="GameObject3D";this.name="";this.willUpdate=!0;this.willUpdateChildren=!0;this.willRender=!0;this.willRenderChildren=!0;this.willCacheChildren=!1;this.dirty=0;this.dirtyFrame=0;this.visible=!0;this.children=[],this.events=new Map,this.transform=new _r(this,e,r,o),this.dirty=H.DEFAULT}isRenderable(){return this.visible&&this.willRender}isDirty(e){return(this.dirty&e)!=0}clearDirty(e){return this.isDirty(e)&&(this.dirty^=e),this}setDirty(e,r){return this.isDirty(e)||(this.dirty^=e,this.dirtyFrame=P.getFrame()),this.isDirty(r)||(this.dirty^=r),this}update(e,r){if(this.willUpdateChildren){let o=this.children;for(let n=0;n<o.length;n++){let i=o[n];i&&i.willUpdate&&i.update(e,r)}}this.postUpdate(e,r)}postUpdate(e,r){}renderGL(e){}postRenderGL(e){}get numChildren(){return this.children.length}destroy(e){E(this,_e,this),this.transform.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}};function Nr(t,e=1.70158){return t*t*((e+1)*t-e)}function Ur(t,e=1.70158){let r=e*1.525;return(t*=2)<1?.5*(t*t*((r+1)*t-r)):.5*((t-=2)*t*((r+1)*t+r)+2)}function gt(t,e=1.70158){return--t*t*((e+1)*t+e)+1}function Wr(t){return t=1-t,t<1/2.75?1-7.5625*t*t:t<2/2.75?1-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}function jr(t){let e=!1;return t<.5?(t=1-t*2,e=!0):t=t*2-1,t<1/2.75?t=7.5625*t*t:t<2/2.75?t=7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?t=7.5625*(t-=2.25/2.75)*t+.9375:t=7.5625*(t-=2.625/2.75)*t+.984375,e?(1-t)*.5:t*.5+.5}function yt(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Hr(t){return 1-Math.sqrt(1-t*t)}function qr(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Rt(t){return Math.sqrt(1- --t*t)}function Xr(t){return t*t*t}function Yr(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function Xe(t){return--t*t*t+1}function Zr(t,e=.1,r=.1){if(t===0)return 0;if(t===1)return 1;{let o=r/4;return e<1?e=1:o=r*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(t-=1))*Math.sin((t-o)*(2*Math.PI)/r))}}function $r(t,e=.1,r=.1){if(t===0)return 0;if(t===1)return 1;{let o=r/4;return e<1?e=1:o=r*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?-.5*(e*Math.pow(2,10*(t-=1))*Math.sin((t-o)*(2*Math.PI)/r)):e*Math.pow(2,-10*(t-=1))*Math.sin((t-o)*(2*Math.PI)/r)*.5+1}}function St(t,e=.1,r=.1){if(t===0)return 0;if(t===1)return 1;{let o=r/4;return e<1?e=1:o=r*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-o)*(2*Math.PI)/r)+1}}function Kr(t){return Math.pow(2,10*(t-1))-.001}function Jr(t){return t==0?0:t==1?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))}function wt(t){return 1-Math.pow(2,-10*t)}function eo(t){return t*t}function to(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function Ye(t){return t*(2-t)}function ro(t){return t*t*t*t}function oo(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function Ze(t){return-(--t*t*t*t-1)}function no(t){return t*t*t*t*t}function io(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function $e(t){return(t=t-1)*t*t*t*t+1}function ao(t){return t===0?0:t===1?1:1-Math.cos(t*Math.PI/2)}function mo(t){return t===0?0:t===1?1:.5*(1-Math.cos(Math.PI*t))}function Ct(t){return t===0?0:t===1?1:Math.sin(t*Math.PI/2)}function so(t){return t}function Sn(t,e=1){return t<=0?0:t>=1?1:((e*t|0)+1)*(1/e)}var aC=new Map([["power0",so],["power1",Ye],["power2",Xe],["power3",Ze],["power4",$e],["linear",so],["quad",Ye],["cubic",Xe],["quart",Ze],["quint",$e],["sine",Ct],["expo",wt],["circ",Rt],["elastic",St],["back",gt],["bounce",yt],["stepped",Sn],["quad.in",eo],["cubic.in",Xr],["quart.in",ro],["quint.in",no],["sine.in",ao],["expo.in",Kr],["circ.in",Hr],["elastic.in",Zr],["back.in",Nr],["bounce.in",Wr],["quad.out",Ye],["cubic.out",Xe],["quart.out",Ze],["quint.out",$e],["sine.out",Ct],["expo.out",wt],["circ.out",Rt],["elastic.out",St],["back.out",gt],["bounce.out",yt],["quad.inout",to],["cubic.inout",Yr],["quart.inout",oo],["quint.inout",io],["sine.inout",mo],["expo.inout",Jr],["circ.inout",qr],["elastic.inout",$r],["back.inout",Ur],["bounce.inout",jr]]);function co(t,e,r=new A){let{a:o,b:n,c:i,d:m,tx:s,ty:c}=t,{a:u,b:f,c:l,d,tx:I,ty:V}=e;return r.set(u*o+f*i,u*n+f*m,l*o+d*i,l*n+d*m,I*o+V*i+s,I*n+V*m+c)}var b=class{constructor(e=0,r=0){this.set(e,r)}set(e=0,r=0){return this.x=e,this.y=r,this}toArray(e=[],r=0){let{x:o,y:n}=this;return e[r]=o,e[r+1]=n,e}fromArray(e,r=0){return this.set(e[r],e[r+1])}toString(){let{x:e,y:r}=this;return`{ x=${e}, y=${r} }`}};function uo(t,e,r,o=new b){let{a:n,b:i,c:m,d:s,tx:c,ty:u}=t,f=1/(n*s+m*-i);return o.set(s*f*e+-m*f*r+(u*m-c*s)*f,n*f*r+-i*f*e+(-u*n+c*i)*f)}function Tt(t){return t*te.DEG_TO_RAD}var po=class{constructor(e={}){this.isDirty=!1;let{ambient:r=[1,1,1],diffuse:o=[1,1,1],specular:n=[1,1,1],shine:i=.25}=e,m=()=>this.update();this.ambient=new K(m).fromArray(r),this.diffuse=new K(m).fromArray(o),this.specular=new K(m).fromArray(n),this._shine=i}get shine(){return this._shine}set shine(e){this._shine=O(e,0,1),this.isDirty=!0}update(){this.isDirty=!0}setUniforms(e){e.setUniform("uMaterialAmbient",this.ambient.toArray()),e.setUniform("uMaterialDiffuse",this.diffuse.toArray()),e.setUniform("uMaterialSpecular",this.specular.toArray()),e.setUniform("uMaterialShine",this._shine*256)}destroy(){this.ambient.destroy(),this.diffuse.destroy(),this.specular.destroy()}};function Lt(t,e,...r){let o=t.getFrame(e);return r.forEach(n=>{!n||o===n.frame||(n.frame=o,n.hasTexture=!0)}),r}var En,Ee={get:()=>En,set:t=>{En=t}};function vn(t,e,...r){if(!t)r.forEach(o=>{o.texture=null,o.frame=null,o.hasTexture=!1});else{let o;t instanceof Y?o=t:o=Ee.get().get(t),o?(r.forEach(n=>{n.texture=o}),Lt(o,e,...r)):console.warn(`Invalid Texture key: ${t}`)}return r}var be=class extends qe{constructor(e=0,r=0,o=0,n,i=new po){super(e,r,o);this.hasTexture=!1;this.cullFaces=!0;this.geometry=n,this.material=i,this.setTexture("__WHITE")}setTexture(e,r){return vn(e,r,this),this}setFrame(e){return Lt(this.texture,e,this),this}setMaterial(e){return this.material=e,this}renderGL(e){let r=e.currentShader.shader;if(r.setUniform("uModelMatrix",this.transform.local.data),r.setUniform("uNormalMatrix",this.transform.normal.data),this.hasTexture){let o=Mr(e,this.texture);r.setUniform("uTexture",o)}this.material.setUniforms(r),br(e,this.geometry.buffer)}destroy(e){super.destroy(e),this.geometry=null,this.material=null,this.texture=null,this.frame=null,this.hasTexture=!1}};var lo=class extends be{constructor(e=0,r=0,o=0,n=1,i=1,m=1,s=1,c=1,u=1){let f=Mn(0,0,0,n,i,m,s,c,u),l=new fe(f);super(e,r,o,l)}};function Gn(t,e,r,o,n,i,m,s,c){let{vertices:u,normals:f,uvs:l,indices:d}=e,I=new b,V=new p,g=t===!0?n:i,M=t===!0?1:-1,h=r;for(let y=1;y<=m;y++)u.push(0,o*M,0),f.push(0,M,0),l.push(.5,.5),r++;let T=r;for(let y=0;y<=m;y++){let L=y/m*c+s,v=Math.cos(L),z=Math.sin(L);V.x=g*z,V.y=o*M,V.z=g*v,u.push(V.x,V.y,V.z),f.push(0,M,0),I.x=v*.5+.5,I.y=z*.5*M+.5,l.push(I.x,I.y),r++}for(let y=0;y<m;y++){let w=h+y,L=T+y;t?d.push(L,L+1,w):d.push(L+1,L,w)}return r}function Fn(t=1,e=1,r=1,o=8,n=1,i=!1,m=0,s=Math.PI*2){let c=re(),{vertices:u,normals:f,uvs:l,indices:d}=c,I=0,V=[],g=r/2,M=new p,h=new p,T=(e-t)/r;for(let y=0;y<=n;y++){let w=[],L=y/n,v=L*(e-t)+t;for(let z=0;z<=o;z++){let B=z/o,_=B*s+m,U=Math.sin(_),F=Math.cos(_);h.x=v*U,h.y=-L*r+g,h.z=v*F,u.push(h.x,h.y,h.z),M.set(U,T,F),xe(M,M),f.push(M.x,M.y,M.z),l.push(B,1-L),w.push(I++)}V.push(w)}for(let y=0;y<o;y++)for(let w=0;w<n;w++){let L=V[w][y],v=V[w+1][y],z=V[w+1][y+1],B=V[w][y+1];d.push(L,v,B),d.push(v,z,B)}return i||(t>0&&(I=Gn(!0,c,I,g,t,e,o,m,s)),e>0&&Gn(!1,c,I,g,t,e,o,m,s)),c.numberOfVertices=u.length,c}function zn(t=1,e=1,r=8,o=1,n=!1,i=0,m=Math.PI*2){return Fn(0,t,e,r,o,n,i,m)}var ho=class extends be{constructor(e=0,r=0,o=0,n=1,i=1,m=8,s=1,c=!1,u=0,f=Math.PI*2){let l=zn(n,i,m,s,c,u,f),d=new fe(l);super(e,r,o,d)}};function xo(t,e){return Ge(e).appendChild(t),t}function bo(t){let e=document.readyState;if(e==="complete"||e==="interactive"){t();return}let r=()=>{document.removeEventListener("deviceready",r,!0),document.removeEventListener("DOMContentLoaded",r,!0),window.removeEventListener("load",r,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",r,!0):(document.addEventListener("DOMContentLoaded",r,!0),window.addEventListener("load",r,!0)):window.setTimeout(r,20)}function Vo(){let{title:t,version:e,url:r,color:o,background:n}=S.get(R.BANNER);if(t!==""){let i=e!==""?t+" "+e:t;console.log(`%c${i}%c ${r}`,`padding: 4px 16px; color: ${o}; background: ${n}`,"")}}function Io(){return S.get(R.PARENT)}function Mo(){return S.get(R.RENDERER)}function An(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function go(){return S.get(R.SCENES)}function Bn(t,e=0){t.gameFrame=e,t.numTotalFrames=0,t.numDirtyFrames=0,t.numDirtyCameras=0,t.worldData.length=0}var kn,Dt={get:()=>kn,set:t=>{kn=t}};var yo=class{constructor(){this.scenes=new Map;this.sceneIndex=0;this.flush=!1;this.renderResult=An();this.game=P.get(),Dt.set(this),Ue(this.game,"boot",()=>this.boot())}boot(){go().forEach(e=>new e)}update(e,r){for(let o of this.scenes.values())E(o,"update",e,r)}render(e){let r=this.renderResult;Bn(r,e);for(let o of this.scenes.values())E(o,"render",r);return this.flush&&(r.numDirtyFrames++,this.flush=!1),r}};function Pn(){tt(0),Ft(4096),rt("Phaser","4.0.0","https://phaser4.io"),ye(0),Bt(.5,.5),ve(800,600,1)}function Et(t,e){let r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d")}var Ro=class{constructor(){this.textures=new Map,this.createDefaultTextures(),Ee.set(this)}createDefaultTextures(){this.add("__BLANK",new Y(Et(32,32).canvas));let e=Et(32,32);e.strokeStyle="#0f0",e.moveTo(0,0),e.lineTo(32,32),e.stroke(),e.strokeRect(.5,.5,31,31),this.add("__MISSING",new Y(e.canvas));let r=Et(32,32);r.fillStyle="#fff",r.fillRect(0,0,32,32),this.add("__WHITE",new Y(r.canvas))}get(e){let r=this.textures;return r.has(e)?r.get(e):r.get("__MISSING")}has(e){return this.textures.has(e)}add(e,r,o){let n,i=this.textures;return i.has(e)||(r instanceof Y?n=r:n=new Y(r,0,0,o),n.key=e,i.set(e,n)),n}};var So=class extends oe{constructor(...e){super();this.VERSION="4.0.0-beta1";this.isBooted=!1;this.isPaused=!1;this.willUpdate=!0;this.willRender=!0;this.lastTick=0;this.elapsed=0;this.frame=0;P.set(this),Pn(),bo(()=>this.boot(e))}boot(e){e.forEach(n=>n());let r=Mo();this.renderer=new r,this.textureManager=new Ro,this.sceneManager=new yo;let o=Io();o&&xo(this.renderer.canvas,o),this.isBooted=!0,Vo(),E(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(e){let r=e-this.lastTick;this.lastTick=e,this.elapsed+=r,this.isPaused||(this.willUpdate&&(this.sceneManager.update(r,e),E(this,"update",r,e)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,P.setFrame(this.frame),P.setElapsed(this.elapsed),requestAnimationFrame(o=>this.step(o))}destroy(){}};var wo=class{constructor(e,r,o){this.responseType="text";this.crossOrigin=void 0;this.skipCache=!1;this.hasLoaded=!1;this.key=e,this.url=r,this.config=o}};function On(t,e,r,o){return e||(e=t+r),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(e)?e:o?o.baseURL+o.path+e:e}function Qn(t){return t.data=new Image,t.crossOrigin&&(t.data.crossOrigin=t.crossOrigin),new Promise((e,r)=>{t.data.onload=()=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,e(t))},t.data.onerror=o=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,t.error=o,r(t))},t.data.src=t.url,t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,e(t))})}function Ke(t,e,r){let o=new wo(t,e);return o.load=()=>(o.url=On(o.key,o.url,".png",o.loader),o.loader&&(o.crossOrigin=o.loader.crossOrigin),new Promise((n,i)=>{let m=Ee.get();m.has(o.key)?n(o):Qn(o).then(s=>{m.add(s.key,s.data,r),n(s)}).catch(s=>{i(s)})})),o}var Co=class extends oe{constructor(){super();this.baseURL="";this.path="";this.crossOrigin="anonymous";this.maxParallelDownloads=-1;this.isLoading=!1;this.reset()}reset(){this.isLoading=!1,this.queue=new Set,this.inflight=new Set,this.completed=new Set,this.progress=0}add(...e){return e.forEach(r=>{r.loader=this,this.queue.add(r)}),this}start(){return this.isLoading?null:new Promise((e,r)=>{this.completed.clear(),this.progress=0,this.queue.size>0?(this.isLoading=!0,this.onComplete=e,this.onError=r,E(this,"start"),this.nextFile()):(this.progress=1,E(this,"complete"),e(this))})}nextFile(){let e=this.queue.size;if(this.maxParallelDownloads!==-1&&(e=Math.min(e,this.maxParallelDownloads)-this.inflight.size),e){let r=this.queue.values();for(;e>0;){let o=r.next().value;this.inflight.add(o),this.queue.delete(o),o.load().then(n=>this.fileComplete(n)).catch(n=>this.fileError(n)),e--}}else this.inflight.size===0&&this.stop()}stop(){!this.isLoading||(this.isLoading=!1,E(this,"complete",this.completed),this.onComplete(),this.completed.clear())}updateProgress(e){this.inflight.delete(e),this.completed.add(e);let r=this.completed.size,o=this.queue.size+this.inflight.size;r>0&&(this.progress=r/(r+o)),E(this,"progress",this.progress,r,o),this.nextFile()}fileComplete(e){E(this,"filecomplete",e),this.updateProgress(e)}fileError(e){E(this,"fileerror",e),this.updateProgress(e)}totalFilesToLoad(){return this.queue.size+this.inflight.size}setBaseURL(e=""){return e!==""&&e.substr(-1)!=="/"&&(e=e.concat("/")),this.baseURL=e,this}setPath(e=""){return e!==""&&e.substr(-1)!=="/"&&(e=e.concat("/")),this.path=e,this}setCORS(e){return this.crossOrigin=e,this}setMaxParallelDownloads(e){return this.maxParallelDownloads=e,this}};var To=class extends oe{constructor(e){super();this.primaryDown=!1;this.auxDown=!1;this.secondaryDown=!1;this.blockContextMenu=!0;this.resolution=1;this.mousedownHandler=r=>this.onMouseDown(r),this.mouseupHandler=r=>this.onMouseUp(r),this.mousemoveHandler=r=>this.onMouseMove(r),this.mousewheelHandler=r=>this.onMouseWheel(r),this.contextmenuHandler=r=>this.onContextMenuEvent(r),this.blurHandler=()=>this.onBlur(),this.localPoint=new b,this.hitPoint=new b,this.transPoint=new b,e||(e=P.get().renderer.canvas),e.addEventListener("mousedown",this.mousedownHandler),e.addEventListener("mouseup",this.mouseupHandler),e.addEventListener("wheel",this.mousewheelHandler,{passive:!1}),e.addEventListener("contextmenu",this.contextmenuHandler),window.addEventListener("mouseup",this.mouseupHandler),window.addEventListener("mousemove",this.mousemoveHandler),window.addEventListener("blur",this.blurHandler),this.target=e}onBlur(){}onMouseDown(e){this.positionToPoint(e),this.primaryDown=e.button===0,this.auxDown=e.button===1,this.secondaryDown=e.button===2,E(this,"pointerdown",this.localPoint.x,this.localPoint.y,e.button,e)}onMouseUp(e){this.positionToPoint(e),this.primaryDown=e.button!==0,this.auxDown=e.button!==1,this.secondaryDown=e.button!==2,E(this,"pointerup",this.localPoint.x,this.localPoint.y,e.button,e)}onMouseMove(e){this.positionToPoint(e),E(this,"pointermove",this.localPoint.x,this.localPoint.y,e)}onMouseWheel(e){E(this,"wheel",e.deltaX,e.deltaY,e.deltaZ,e)}onContextMenuEvent(e){this.blockContextMenu&&e.preventDefault(),E(this,"contextmenu",e)}positionToPoint(e){return this.localPoint.set(e.offsetX,e.offsetY)}getInteractiveChildren(e,r){let o=e.children;for(let n=0;n<o.length;n++){let i=o[n];!i.visible||!i.input.enabled||(r.push(i),i.input.enabledChildren&&i.numChildren&&this.getInteractiveChildren(i,r))}}checkHitArea(e,r,o){if(e.input.hitArea){if(e.input.hitArea.contains(r,o))return!0}else return e.transform.extent.contains(r,o);return!1}hitTest(...e){let r=this.localPoint.x,o=this.localPoint.y,n=this.transPoint;for(let i=0;i<e.length;i++){let m=e[i];if(!m.world)continue;let s=co(m.world.camera.worldTransform,m.transform.world);if(uo(s,r,o,n),this.checkHitArea(m,n.x,n.y))return this.hitPoint.set(n.x,n.y),!0}return!1}hitTestChildren(e,r=!0){let o=[];if(!e.visible)return o;let n=[],i=e.input;i&&i.enabled&&n.push(e),i.enabledChildren&&e.numChildren&&this.getInteractiveChildren(e,n);for(let m=n.length-1;m>=0;m--){let s=n[m];if(this.hitTest(s)&&(o.push(s),r))break}return o}shutdown(){let e=this.target;e.removeEventListener("mousedown",this.mousedownHandler),e.removeEventListener("mouseup",this.mouseupHandler),e.removeEventListener("wheel",this.mousewheelHandler),e.removeEventListener("contextmenu",this.contextmenuHandler),window.removeEventListener("mouseup",this.mouseupHandler),window.removeEventListener("mousemove",this.mousemoveHandler),window.removeEventListener("blur",this.blurHandler)}};function _n(t,e,r){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:r}function Nn(t,e={}){let r=Dt.get(),o=r.scenes.size,n=r.sceneIndex,i=o===0;typeof e=="string"?t.key=e:(e||!e&&i)&&(t.key=_n(e,"key","scene"+n.toString())),r.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(r.scenes.set(t.key,t),r.flush=!0,r.sceneIndex++)}var Lo=class{constructor(e){this.game=P.get(),this.events=new Map,Nn(this,e)}};function Un(t=1,e=3,r=3,o=0,n=Math.PI*2,i=0,m=Math.PI){e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6);let s=Math.min(i+m,Math.PI),c=re(),{vertices:u,normals:f,uvs:l,indices:d}=c,I=0,V=[],g=new p,M=new p;for(let h=0;h<=r;h++){let T=[],y=h/r,w=0;h===0&&i===0?w=.5/e:h===r&&s==Math.PI&&(w=-.5/e);for(let L=0;L<=e;L++){let v=L/e;g.x=-t*Math.cos(o+v*n)*Math.sin(i+y*m),g.y=t*Math.cos(i+y*m),g.z=t*Math.sin(o+v*n)*Math.sin(i+y*m),u.push(g.x,g.y,g.z),xe(g,M),f.push(M.x,M.y,M.z),l.push(v+w,1-y),T.push(I++)}V.push(T)}for(let h=0;h<r;h++)for(let T=0;T<e;T++){let y=V[h][T+1],w=V[h][T],L=V[h+1][T],v=V[h+1][T+1];(h!==0||i>0)&&d.push(y,w,v),(h!==r-1||s<Math.PI)&&d.push(w,L,v)}return c.numberOfVertices=u.length,c}var Do=class extends be{constructor(e=0,r=0,o=0,n=1,i=3,m=3,s=0,c=Math.PI*2,u=0,f=Math.PI){let l=Un(n,i,m,s,c,u,f),d=new fe(l);super(e,r,o,d)}};var Eo=class{constructor(e={}){this.isDirty=!1;let{x:r=0,y:o=0,z:n=.1,ambient:i=[1,1,1],diffuse:m=[1,1,1],specular:s=[1,1,1]}=e,c=()=>this.update();this.position=new q(c,r,o,n),this.ambient=new K(c).fromArray(i),this.diffuse=new K(c).fromArray(m),this.specular=new K(c).fromArray(s)}setUniforms(e){e.setUniform("uLightPosition",this.position.toArray()),e.setUniform("uLightAmbient",this.ambient.toArray()),e.setUniform("uLightDiffuse",this.diffuse.toArray()),e.setUniform("uLightSpecular",this.specular.toArray())}update(){this.isDirty=!0}destroy(){this.position.destroy(),this.ambient.destroy(),this.diffuse.destroy(),this.specular.destroy()}};var Wn=`#define SHADER_NAME AMBIENT_LIGHT_FRAG

precision highp float;

uniform vec3 uLightPosition;
uniform vec3 uLightAmbient;
uniform vec3 uLightDiffuse;
uniform vec3 uLightSpecular;

uniform vec3 uMaterialAmbient;
uniform vec3 uMaterialDiffuse;
uniform vec3 uMaterialSpecular;
uniform float uMaterialShine;

uniform vec3 uCameraPosition;

uniform sampler2D uTexture;

varying vec2 vTextureCoord;
varying vec3 vNormal;
varying vec3 vPosition;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    vec3 ambient = uLightAmbient * uMaterialAmbient;

    vec3 norm = normalize(vNormal);
    vec3 lightDir = normalize(uLightPosition - vPosition);
    float diff = max(dot(norm, lightDir), 0.0);
    vec3 diffuse = uLightDiffuse * (diff * uMaterialDiffuse);

    vec3 viewDir = normalize(uCameraPosition - vPosition);
    vec3 reflectDir = reflect(-lightDir, norm);
    float spec = pow(max(dot(viewDir, reflectDir), 0.0), uMaterialShine);
    vec3 specular = uLightSpecular * (spec * uMaterialSpecular);

    vec3 result = (ambient + diffuse + specular) * color.rgb;

    gl_FragColor = vec4(result, color.a);
}`;var jn=`
#define SHADER_NAME AMBIENT_LIGHT_VERT

precision highp float;

attribute vec3 aVertexPosition;
attribute vec3 aVertexNormal;
attribute vec2 aTextureCoord;

uniform mat4 uViewProjectionMatrix;
uniform mat4 uModelMatrix;
uniform mat4 uNormalMatrix;

varying vec2 vTextureCoord;
varying vec3 vNormal;
varying vec3 vPosition;

void main(void)
{
    vTextureCoord = aTextureCoord;

    vPosition = vec3(uModelMatrix * vec4(aVertexPosition, 1.0));

    vNormal = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));

    gl_Position = uViewProjectionMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);
}
`;var vo=class extends we{constructor(){super();let e=new Float32Array(16).fill(0),r=[0,0,0],o={fragmentShader:Wn,vertexShader:jn,attributes:{aVertexPosition:{size:3,type:ee,normalized:!1,offset:0},aVertexNormal:{size:3,type:ee,normalized:!1,offset:12},aTextureCoord:{size:2,type:ee,normalized:!1,offset:24}},uniforms:{uViewProjectionMatrix:e,uNormalMatrix:e,uModelMatrix:e,uCameraPosition:r,uTexture:0,uLightPosition:r,uLightAmbient:r,uLightDiffuse:r,uLightSpecular:r,uMaterialAmbient:r,uMaterialDiffuse:r,uMaterialSpecular:r,uMaterialShine:0}};this.fromConfig(o)}};var Go="worldrender";var Fo="worldshutdown";function zo(t,e){e.numRendered++,e.numRenderable++,t.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++,t.children.forEach(r=>{r.children.length>0&&zo(r,e)})}function Hn(t){if(t.node.isDirty(H.CHILD_CACHE))return!0;let e=[t];for(;e.length>0;){let r=e.pop();if(r.node.isDirty(H.TRANSFORM))return!0;let o=r.children.length;if(o>0)for(let n=0;n<o;n++)e.push(r.children[n])}return e.length=0,!1}function qn(t,e){t.forEach(r=>{e||Hn(r)?r.node.setDirty(H.CHILD_CACHE):r.children.length=0})}function Ao(t,e,r=[]){for(let o=0;o<e.numChildren;o++){let n=e.children[o];if(n.isRenderable()){let i=[],m={node:n,children:i};r.push(m),n.willRenderChildren&&n.numChildren>0&&(n.willCacheChildren&&t.push(m),Ao(t,n,i))}}return r}function Xn(t){let e=[],o=Ao(e,t,[]),n=t.renderData;e.length>0&&qn(e,t.camera.dirtyRender),o.forEach(i=>{i.children.length>0?zo(i,n):(n.numRendered++,n.numRenderable++,i.node.dirtyFrame>=n.gameFrame&&n.dirtyFrame++)}),t.renderList=o,t.forceRefresh&&(n.dirtyFrame++,t.forceRefresh=!1)}function Yn(t,e){t.numDirtyFrames+=e.dirtyFrame,t.numTotalFrames+=e.numRendered,e.camera.dirtyRender&&t.numDirtyCameras++,t.worldData.push(e)}function Zn(t,...e){return e.forEach(r=>{ht(t,r)}),e}function vt(t,e){t.gameFrame=e,t.dirtyFrame=0,t.numRendered=0,t.numRenderable=0}var Bo=class extends qe{constructor(e){super();this.forceRefresh=!1;this.is3D=!0;this.type="BaseWorld",this.scene=e,this.world=this,this.events=new Map,this.renderList=[],this._updateListener=W(e,"update",(r,o)=>this.update(r,o)),this._renderListener=W(e,"render",r=>this.render(r)),this._shutdownListener=W(e,"shutdown",()=>this.shutdown()),Ue(e,"destroy",()=>this.destroy())}update(e,r){!this.willUpdate||(E(this,Cr,e,r,this),super.update(e,r))}postUpdate(e,r){E(this,wr,e,r,this)}render(e){let r=this.renderData;vt(r,e.gameFrame),!(!this.willRender||!this.visible)&&(Xn(this),E(this,Go,r,this),Yn(e,r))}renderNode(e,r){e.node.renderGL(r),e.children.forEach(o=>{o.children.length>0?this.renderNode(o,r):o.node.renderGL(r)}),e.node.postRenderGL(r)}shutdown(){let e=this.scene;Ne(e,"update",this._updateListener),Ne(e,"render",this._renderListener),Ne(e,"shutdown",this._shutdownListener),Zn(this),E(this,Fo,this),vt(this.renderData,0)}destroy(e){super.destroy(e),E(this,_e,this),vt(this.renderData,0),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}};function $n(t,e){return{world:t,camera:e,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}var Po=class{constructor(e=45,r=.1,o=1e3){this.isOrbit=!1;this.minDistance=0;this.maxDistance=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.dirtyRender=!0;this.panRate=5;this.zoomRate=200;this.rotateRate=-3;this._yaw=0;this._pitch=0;this._roll=0;this.type="Camera3D",this._fov=e,this._near=r,this._far=o,this.matrix=new x,this.viewMatrix=new x,this.projectionMatrix=new x,this.viewProjectionMatrix=new x,this.position=new q(()=>this.update()),this.rotation=new C;let i=P.get().renderer;this.viewport=new Q(0,0,i.width,i.height),this.renderer=i,this.forward=le(),this.up=he(),this.right=de(),this.start=new p,this.setAspectRatio()}update(){let e=this.matrix,r=this.viewMatrix;return ur(this.rotation,this.position,!this.isOrbit,e),He(Ar,e,this.forward),He(Fr,e,this.up),He(zr,e,this.right),Ce(e,r),Oe(this.projectionMatrix,r,this.viewProjectionMatrix),this}panX(e){let r=this.position;return this.isOrbit||je(r,this.right,e,r),this}panY(e){let r=this.position,o=this.up;return this.isOrbit?r.y+=o.y*e:je(r,o,e,r),this}panZ(e){let r=this.position;return this.isOrbit?r.z+=e:je(r,this.forward,e,r),this}begin(e,r){this.start.set(e,r)}pan(e,r){let o=e-this.start.x,n=r-this.start.y,i=this.viewport;this.panX(-o*(this.panRate/i.width)),this.panY(n*(this.panRate/i.height)),this.start.set(e,r)}rotate(e,r){let o=e-this.start.x,n=r-this.start.y,i=this.viewport;this.rotation.x+=n*(this.rotateRate/i.height),this.rotation.y+=o*(this.rotateRate/i.width),this.start.set(e,r),this.update()}zoom(e){this.panZ(O(e,-1,1)*(this.zoomRate/this.viewport.height))}setAspectRatio(e){if(!e){let r=this.renderer;e=r.width/r.height}return this.aspect=e,this.updateProjectionMatrix()}updateProjectionMatrix(){return fr(Tt(this._fov),this.aspect,this._near,this._far,this.projectionMatrix),this}get fov(){return this._fov}set fov(e){this._fov=O(e,0,180),this.updateProjectionMatrix()}get near(){return this._near}set near(e){e>0&&(this._near=e,this.updateProjectionMatrix())}get far(){return this._far}set far(e){e>0&&(this._far=e,this.updateProjectionMatrix())}get yaw(){return this._yaw}set yaw(e){this._yaw=e,pe(e,this._pitch,this._roll,this.rotation)}get pitch(){return this._pitch}set pitch(e){this._pitch=e,pe(this._yaw,e,this._roll,this.rotation)}get roll(){return this._roll}set roll(e){this._roll=e,pe(this._yaw,this._pitch,e,this.rotation)}};var Oo=class extends Bo{constructor(e,r=0,o=0,n=0,i){super(e);this.enableCameraCull=!0;this.type="World3D",this.camera=new Po,this.camera.position.set(r,o,n),this.light=new Eo(i),this.shader=new vo,this.renderData=$n(this,this.camera)}renderGL(e){$(e);let r=this.shader,o=this.camera,n=e.renderer.gl;Ir(e,r,0),r.setUniform("uViewProjectionMatrix",o.viewProjectionMatrix.data),r.setUniform("uCameraPosition",o.position.toArray()),this.light.setUniforms(r),n.enable(n.DEPTH_TEST),this.renderList.forEach(i=>{i.children.length>0?this.renderNode(i,e):i.node.renderGL(e)})}postRenderGL(e){let r=e.renderer.gl;r.disable(r.DEPTH_TEST),r.disable(r.CULL_FACE),Vr(e)}};var Jn=class extends Lo{constructor(){super();this.camMode=0;let e=new Co;e.setPath("assets/textures/"),e.add(Ke("wood","wooden-crate.png",{flipY:!0})),e.add(Ke("field","field.png",{flipY:!0})),e.add(Ke("water","water.png",{flipY:!0})),e.add(Ke("bricks","bricks.png",{flipY:!0})),e.start().then(()=>this.create())}create(){this.world=new Oo(this,0,0,8,{x:.5,y:3,z:4});let e=new Do(-2.5,0,0,1,24,24).setTexture("field"),r=new lo(0,0,0,1.5,1.5,1.5).setTexture("wood"),o=new ho(2.5,0,0,.8,1.8,24,6).setTexture("bricks");In(this.world,e,r,o),this.ball=e,this.box=r,this.cone=o;let n=this.world.camera;n.isOrbit=!0,window.world=this.world,window.camera=n;let i=new To,m=!1;W(i,"pointerdown",(c,u,f)=>{f===1?(n.isOrbit=!n.isOrbit,console.log("orbit",n.isOrbit)):(n.begin(c,u),m=!0)}),W(i,"pointermove",(c,u)=>{!m||(i.primaryDown?n.rotate(c,u):i.secondaryDown&&n.pan(c,u))}),W(i,"wheel",(c,u,f)=>{n.zoom(u)}),W(i,"pointerup",()=>{m=!1});let s=this.world.light;W(this,"update",(c,u)=>{u/=1e3,s.position.x=Math.sin(u*2),s.position.y=Math.sin(u*.7),s.position.z=Math.sin(u*1.3)})}update(){this.ball.transform.rotateX(.01),this.box.transform.rotateX(.01),this.ball.transform.rotateY(.01),this.box.transform.rotateY(.01)}};new So(Sr(),ot(800,600),it("gameParent"),Gt(1907997),at(Jn));})();
/**
 * @author       Niklas von Hertzen (https://github.com/niklasvh/base64-arraybuffer)
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
