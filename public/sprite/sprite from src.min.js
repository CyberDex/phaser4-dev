(()=>{var zn=Object.defineProperty;var Nn=(t,e)=>{for(var r in e)zn(t,r,{get:e[r],enumerable:!0})};function ct(t,e=1.70158){return t*t*((e+1)*t-e)}function ut(t,e=1.70158){let r=e*1.525;return(t*=2)<1?.5*(t*t*((r+1)*t-r)):.5*((t-=2)*t*((r+1)*t+r)+2)}function Ve(t,e=1.70158){return--t*t*((e+1)*t+e)+1}var we={};Nn(we,{In:()=>Ee,InOut:()=>ve,Out:()=>te});function Ee(t){return t=1-t,t<1/2.75?1-7.5625*t*t:t<2/2.75?1-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}function ve(t){let e=!1;return t<.5?(t=1-t*2,e=!0):t=t*2-1,t<1/2.75?t=7.5625*t*t:t<2/2.75?t=7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?t=7.5625*(t-=2.25/2.75)*t+.9375:t=7.5625*(t-=2.625/2.75)*t+.984375,e?(1-t)*.5:t*.5+.5}function te(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function ft(t){return 1-Math.sqrt(1-t*t)}function pt(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Fe(t){return Math.sqrt(1- --t*t)}function lt(t){return t*t*t}function dt(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function re(t){return--t*t*t+1}function ht(t,e=.1,r=.1){if(t===0)return 0;if(t===1)return 1;{let n=r/4;return e<1?e=1:n=r*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/r))}}function xt(t,e=.1,r=.1){if(t===0)return 0;if(t===1)return 1;{let n=r/4;return e<1?e=1:n=r*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?-.5*(e*Math.pow(2,10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/r)):e*Math.pow(2,-10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/r)*.5+1}}function Le(t,e=.1,r=.1){if(t===0)return 0;if(t===1)return 1;{let n=r/4;return e<1?e=1:n=r*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-n)*(2*Math.PI)/r)+1}}function bt(t){return Math.pow(2,10*(t-1))-.001}function gt(t){return t==0?0:t==1?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))}function Oe(t){return 1-Math.pow(2,-10*t)}function It(t){return t*t}function Rt(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function ne(t){return t*(2-t)}function St(t){return t*t*t*t}function Ct(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function oe(t){return-(--t*t*t*t-1)}function Tt(t){return t*t*t*t*t}function yt(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function ie(t){return(t=t-1)*t*t*t*t+1}function Mt(t){return t===0?0:t===1?1:1-Math.cos(t*Math.PI/2)}function Gt(t){return t===0?0:t===1?1:.5*(1-Math.cos(Math.PI*t))}function Be(t){return t===0?0:t===1?1:Math.sin(t*Math.PI/2)}function ae(t){return t}function Ur(t,e=1){return t<=0?0:t>=1?1:((e*t|0)+1)*(1/e)}var ca=new Map([["power0",ae],["power1",ne],["power2",re],["power3",oe],["power4",ie],["linear",ae],["quad",ne],["cubic",re],["quart",oe],["quint",ie],["sine",Be],["expo",Oe],["circ",Fe],["elastic",Le],["back",Ve],["bounce",te],["stepped",Ur],["quad.in",It],["cubic.in",lt],["quart.in",St],["quint.in",Tt],["sine.in",Mt],["expo.in",bt],["circ.in",ft],["elastic.in",ht],["back.in",ct],["bounce.in",Ee],["quad.out",ne],["cubic.out",re],["quart.out",oe],["quint.out",ie],["sine.out",Be],["expo.out",Oe],["circ.out",Fe],["elastic.out",Le],["back.out",Ve],["bounce.out",te],["quad.inout",Rt],["cubic.inout",dt],["quart.inout",Ct],["quint.inout",yt],["sine.inout",Gt],["expo.inout",gt],["circ.inout",pt],["elastic.inout",xt],["back.inout",ut],["bounce.inout",ve]]);var l={BACKGROUND_COLOR:"BackgroundColor",BATCH_SIZE:"BatchSize",DEFAULT_ORIGIN:"DefaultOrigin",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",SIZE:"Size",SCENES:"Scenes",RENDERER:"Renderer",AUTO:"Auto",WEBGL:"WebGL",CANVAS:"Canvas",WEBGL_CONTEXT:"WebGLContext",CANVAS_CONTEXT:"CanvasContext",BANNER:"Banner"};var d=new Map;function De(t){d.set(l.BACKGROUND_COLOR,t)}function Vt(t){return()=>{De(t)}}function Ae(t="",e="",r="",n="#fff",i="linear-gradient(#3e0081 40%, #00bcc3)"){d.set(l.BANNER,{title:t,version:e,url:r,color:n,background:i})}function Et(t){d.set(l.BATCH_SIZE,t)}function w(){return d.get(l.SIZE).height}function F(){return d.get(l.SIZE).resolution}function L(){return d.get(l.SIZE).width}function Pe(t=800,e=600,r=1){r===0&&(r=window.devicePixelRatio),d.set(l.SIZE,{width:t,height:e,resolution:r})}var vt=[],W={add:(t,e)=>{vt.push({texture:t,glConfig:e})},get:()=>vt,clear:()=>{vt.length=0}};function wt(){return d.get(l.BACKGROUND_COLOR)}function ke(t){d.set(l.RENDERER,t)}function _e(t=.5,e=t){d.set(l.DEFAULT_ORIGIN,{x:t,y:e})}function Y(t){d.set(l.MAX_TEXTURES,t)}function se(t){let e;return t&&(typeof t=="string"?e=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(e=t)),e||(e=document.body),e}function Ft(t){t&&d.set(l.PARENT,se(t))}function je(t){return()=>{Ft(t)}}function Lt(t){d.set(l.SCENES,[].concat(t))}function ze(t){return()=>{Lt(t)}}function Ne(t,e,r){return t.width<=0||t.height<=0?!1:t.x<=e&&t.x+t.width>=e&&t.y<=r&&t.y+t.height>=r}var S=class{constructor(e=0,r=0,n=0,i=0){this.set(e,r,n,i)}set(e=0,r=0,n=0,i=0){return this.x=e,this.y=r,this.width=n,this.height=i,this}contains(e,r){return Ne(this,e,r)}set right(e){e<=this.x?this.width=0:this.width=e-this.x}get right(){return this.x+this.width}set bottom(e){e<=this.y?this.height=0:this.height=e-this.y}get bottom(){return this.y+this.height}};function Ot(t,e=0,r=0,n=0,i=0){let a=new S(e,r,n,i);return t.viewportStack.push(a),a}var o,Wr={get:()=>o,set:t=>{o=t}};function O(t,e){if(!e&&(e=t.currentViewport,!e))return;let r=o.getParameter(o.VIEWPORT);(r[0]!==e.x||r[1]!==e.y||r[2]!==e.width||r[3]!==e.height)&&o.viewport(e.x,e.y,e.width,e.height)}function Bt(t,e=0,r=0,n=0,i=0){let a=Ot(t,e,r,n,i);O(t,a),t.currentViewport=a}function B(t,e=!0,r){r||(r=t.currentFramebuffer);let{framebuffer:n,viewport:i}=r;o.bindFramebuffer(o.FRAMEBUFFER,n),e&&(o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),i&&Bt(t,i.x,i.y,i.width,i.height)}function Dt(t){let e=t.viewportStack;e.length>1&&e.pop(),t.currentViewport=e[e.length-1],O(t)}function me(t){let e=t.framebufferStack;e.length>1&&(t.currentFramebuffer.viewport&&Dt(t),e.pop()),t.currentFramebuffer=e[e.length-1],B(t,!1)}function At(t,e,r){let n={framebuffer:e,viewport:r};return t.framebufferStack.push(n),n}function Ue(t,e,r=!0,n){let i=At(t,e,n);B(t,r,i),t.currentFramebuffer=i}function Pt(t){let e=t.count;if(e===0)return;let r=t.currentVertexBuffer,n=t.currentShader,i=n.shader.renderToFramebuffer;if(i&&Ue(t,n.shader.framebuffer,!0),e===r.batchSize){let a=r.isDynamic?o.DYNAMIC_DRAW:o.STATIC_DRAW;o.bufferData(o.ARRAY_BUFFER,r.data,a)}else{let a=r.indexed?e*r.entryElementSize:e*r.vertexElementSize,s=r.vertexViewF32.subarray(0,a);o.bufferSubData(o.ARRAY_BUFFER,0,s)}r.indexed?o.drawElements(o.TRIANGLES,e*r.entryIndexSize,o.UNSIGNED_SHORT,0):o.drawArrays(o.TRIANGLES,0,e),i&&me(t)}function M(t,e){e&&(t.count=e);let r=t.count;return r===0?!1:(Pt(t),t.prevCount=r,t.count=0,t.flushTotal++,!0)}function kt(t){M(t)}function Yr(t,e=[]){let r=t>>16&255,n=t>>8&255,i=t&255,a=t>16777215?t>>>24:255;return e[0]=r/255,e[1]=n/255,e[2]=i/255,e[3]=a/255,e}function Xr(){return d.get(l.WEBGL_CONTEXT)}function We(t){let{parent:e,flipY:r,unpackPremultiplyAlpha:n,minFilter:i,magFilter:a,wrapS:s,wrapT:m,generateMipmap:u,isPOT:c}=t,f=e.image,I=e.width,g=e.height,y=o.createTexture();return o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,y),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,r),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),f?(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,f),I=f.width,g=f.height):o.texImage2D(o.TEXTURE_2D,0,o.RGBA,I,g,0,o.RGBA,o.UNSIGNED_BYTE,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,m),u&&c&&o.generateMipmap(o.TEXTURE_2D),t.texture=y,y}function ce(t){o&&o.isFramebuffer(t)&&o.deleteFramebuffer(t)}function ue(t){o.isTexture(t)&&o.deleteTexture(t)}function Hr(t,e){return t<1||e<1?!1:(t&t-1)==0&&(e&e-1)==0}function Qr(t,e=!0){o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t);let r=e?o.LINEAR:o.NEAREST;o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,r)}function qr(t){let e=t.parent.image,r=e.width,n=e.height;return r>0&&n>0&&(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t.texture),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,e)),t.texture}var X=class{constructor(e,r={}){this.index=0;this.indexCounter=-1;this.dirtyIndex=!0;this.unpackPremultiplyAlpha=!0;this.flipY=!1;this.isPOT=!1;this.generateMipmap=!1;this.parent=e,this.isPOT=Hr(e.width,e.height);let{texture:n=null,framebuffer:i=null,depthbuffer:a=null,unpackPremultiplyAlpha:s=!0,minFilter:m=this.isPOT?o.LINEAR_MIPMAP_LINEAR:o.LINEAR,magFilter:u=o.LINEAR,wrapS:c=o.CLAMP_TO_EDGE,wrapT:f=o.CLAMP_TO_EDGE,generateMipmap:I=this.isPOT,flipY:g=!1}=r;this.minFilter=m,this.magFilter=u,this.wrapS=c,this.wrapT=f,this.generateMipmap=I,this.flipY=g,this.unpackPremultiplyAlpha=s,i&&(this.framebuffer=i),a&&(this.depthbuffer=a),n?this.texture=n:We(this)}setFilter(e){this.texture&&Qr(this.texture,e)}create(){let e=this.texture;return e&&ue(e),We(this)}update(){return this.texture?qr(this):We(this)}setIndex(e){this.dirtyIndex=e!==this.index,this.index=e}destroy(){ue(this.texture),ce(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}};function _t(){W.get().forEach(e=>{let{texture:r,glConfig:n}=e;r.binding||(r.binding=new X(r,n))}),W.clear()}function fe(){return d.get(l.MAX_TEXTURES)}var no=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function oo(t){let e="";for(let r=0;r<t;++r)r>0&&(e+=`
else `),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function jt(t){let e=o.createShader(o.FRAGMENT_SHADER);for(;;){let r=no.replace(/%forloop%/gi,oo(t));if(o.shaderSource(e,r),o.compileShader(e),!o.getShaderParameter(e,o.COMPILE_STATUS))t=t/2|0;else break}return t}function zt(t){let e=jt(o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS)),r=fe();r===0||r>0&&r>e?Y(e):r>0&&r<e&&(e=Math.max(8,r));let n=t.tempTextures;n.length&&n.forEach(a=>{o.deleteTexture(a)});let i=[];for(let a=0;a<e;a++){let s=o.createTexture();o.activeTexture(o.TEXTURE0+a),o.bindTexture(o.TEXTURE_2D,s),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),n[a]=s,i.push(a)}t.maxTextures=e,t.textureIndex=i,t.currentActiveTexture=1}function $r(){return d.get(l.BATCH_SIZE)}function pe(t){o.isBuffer(t)&&o.deleteBuffer(t)}var Nt=class{constructor(e={}){this.indexed=!1;this.isDynamic=!1;this.count=0;this.offset=0;let{batchSize:r=1,dataSize:n=4,isDynamic:i=!0,elementsPerEntry:a=4,vertexElementSize:s=6}=e;this.batchSize=r,this.dataSize=n,this.vertexElementSize=s,this.isDynamic=i,this.elementsPerEntry=a,this.vertexByteSize=s*n,this.entryByteSize=this.vertexByteSize*a,this.bufferByteSize=r*this.entryByteSize,this.create()}resize(e){this.batchSize=e,this.bufferByteSize=e*this.entryByteSize,this.vertexBuffer&&pe(this.vertexBuffer),this.create()}create(){let e=new ArrayBuffer(this.bufferByteSize);this.data=e,this.vertexViewF32=new Float32Array(e),this.vertexViewU32=new Uint32Array(e),this.vertexBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer);let r=this.isDynamic?o.DYNAMIC_DRAW:o.STATIC_DRAW;o.bufferData(o.ARRAY_BUFFER,e,r),o.bindBuffer(o.ARRAY_BUFFER,null)}add(e){this.count+=e,this.offset+=this.vertexElementSize*e}reset(){this.count=0,this.offset=0}canContain(e){return this.count+e<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer)}destroy(){pe(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}};var Ye=class extends Nt{constructor(e={}){super(e);let{indexSize:r=4,entryIndexSize:n=6,indexLayout:i=null}=e;this.indexed=!0,this.indexSize=r,this.entryIndexSize=n,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;let a=[];if(i){this.indexLayout=i;for(let s=0;s<this.batchSize*r;s+=r)for(let m=0;m<i.length;m++)a.push(s+i[m])}this.create(),this.createIndexBuffer(a)}createIndexBuffer(e){this.index=new Uint16Array(e),this.indexBuffer=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,this.index,o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null),e=[]}bind(){o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),pe(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}};var Kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mo=new Uint8Array(256);for(let t=0;t<Kr.length;t++)mo[Kr.charCodeAt(t)]=t;function D(){}var h=class{constructor(e){let r=new Float32Array(16);this.data=r,this.onChange=D,e?Array.isArray(e)?this.fromArray(e):this.fromArray(e.data):(r[0]=1,r[5]=1,r[10]=1,r[15]=1)}set(e,r,n,i,a,s,m,u,c,f,I,g,y,G,J,ee){let R=this.data;return R[0]=e,R[1]=r,R[2]=n,R[3]=i,R[4]=a,R[5]=s,R[6]=m,R[7]=u,R[8]=c,R[9]=f,R[10]=I,R[11]=g,R[12]=y,R[13]=G,R[14]=J,R[15]=ee,this.onChange(this),this}toArray(e=[],r=0){let n=this.data;for(let i=0;i<16;i++)e[r+i]=n[i];return e}fromArray(e,r=0){let n=this.data;for(let i=0;i<16;i++)n[i]=e[r+i];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=D,this.data=null}};function Wt(t,e,r,n,i,a,s=new h){let m=1/(t-e),u=1/(r-n),c=1/(i-a);return s.set(-2*m,0,0,0,0,-2*u,0,0,0,0,2*c,0,(t+e)*m,(n+r)*u,(a+i)*c,1)}function Yt(t,e){let r=new Map,n={size:1,type:o.FLOAT,normalized:!1,stride:0,offset:0},i=o.getProgramParameter(t,o.ACTIVE_ATTRIBUTES);for(let a=0;a<i;a++){let s=o.getActiveAttrib(t,a);if(!s)break;let m=s.name,u=o.getAttribLocation(t,m);o.enableVertexAttribArray(u);let c=e.hasOwnProperty(m)?e[m]:{},{size:f=n.size,type:I=n.type,normalized:g=n.normalized,stride:y=n.stride,offset:G=n.offset}=c;r.set(m,{index:u,size:f,type:I,normalized:g,stride:y,offset:G})}return r}function le(...t){t.forEach(e=>{o.deleteShader(e)})}function Xt(...t){let e=o.createProgram();if(t.forEach(n=>{o.attachShader(e,n)}),o.linkProgram(e),!o.getProgramParameter(e,o.LINK_STATUS)){let n=o.getProgramInfoLog(e);return console.error(`Error linking program: ${n}`),o.deleteProgram(e),le(...t),null}return e}function Xe(t,e){let r=o.createShader(e);if(o.shaderSource(r,t),o.compileShader(r),!o.getShaderParameter(r,o.COMPILE_STATUS)){let i=o.getShaderInfoLog(r),a=t.split(`
`).map((s,m)=>`${m}: ${s}`);return console.error(`Error compiling shader: ${i}`,a.join(`
`)),o.deleteShader(r),null}return r}function Ht(t,e,r=!1){switch(t.type){case o.INT:case o.BOOL:return r?n=>{o.uniform1iv(e,n)}:n=>{o.uniform1i(e,n)};case o.INT_VEC2:case o.BOOL_VEC2:return n=>{o.uniform2iv(e,n)};case o.INT_VEC3:case o.BOOL_VEC3:return n=>{o.uniform3iv(e,n)};case o.INT_VEC4:case o.BOOL_VEC4:return n=>{o.uniform4iv(e,n)};case o.FLOAT:return r?n=>{o.uniform1fv(e,n)}:n=>{o.uniform1f(e,n)};case o.FLOAT_VEC2:return n=>{o.uniform2fv(e,n)};case o.FLOAT_VEC3:return n=>{o.uniform3fv(e,n)};case o.FLOAT_VEC4:return n=>{o.uniform4fv(e,n)};case o.FLOAT_MAT2:return n=>{o.uniformMatrix2fv(e,!1,n)};case o.FLOAT_MAT3:return n=>{o.uniformMatrix3fv(e,!1,n)};case o.FLOAT_MAT4:return n=>{o.uniformMatrix4fv(e,!1,n)};case o.SAMPLER_2D:case o.SAMPLER_CUBE:return t.size>1?n=>{o.uniform1iv(e,n)}:n=>{o.uniform1i(e,n)}}}function Qt(t){let e=new Map,r=o.getProgramParameter(t,o.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){let i=o.getActiveUniform(t,n),a=i.name;if(a.startsWith("gl_")||a.startsWith("webgl_"))continue;let s=o.getUniformLocation(t,i.name);if(s){let m=!1;a.substr(-3)==="[0]"&&(a=a.substr(0,a.length-3),m=i.size>1),e.set(a,Ht(i,s,m))}}return e}var Jr=5121;var He=5126;var H={aVertexPosition:{size:2,type:He,normalized:!1,offset:0},aTextureCoord:{size:2,type:He,normalized:!1,offset:8},aTextureId:{size:1,type:He,normalized:!1,offset:16},aTintColor:{size:4,type:Jr,normalized:!0,offset:20}};var qt={uProjectionMatrix:new Float32Array,uCameraMatrix:new Float32Array,uTexture:0};function en(t,e,r){o.bindFramebuffer(o.FRAMEBUFFER,t);let n=o.createRenderbuffer();return o.bindRenderbuffer(o.RENDERBUFFER,n),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,e,r),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,n),o.bindFramebuffer(o.FRAMEBUFFER,null),n}function $t(t,e){e||(e=o.COLOR_ATTACHMENT0);let r=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,r),o.framebufferTexture2D(o.FRAMEBUFFER,e,o.TEXTURE_2D,t,0),o.bindFramebuffer(o.FRAMEBUFFER,null),r}var tn=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var rn=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;var Qe=class{constructor(e,r,n,i,a,s){this.trimmed=!1;this.texture=e,this.key=r,this.x=n,this.y=i,this.width=a,this.height=s,this.sourceSizeWidth=a,this.sourceSizeHeight=s,this.updateUVs()}setPivot(e,r){this.pivot={x:e,y:r}}setSize(e,r){this.width=e,this.height=r,this.sourceSizeWidth=e,this.sourceSizeHeight=r,this.updateUVs()}setSourceSize(e,r){this.sourceSizeWidth=e,this.sourceSizeHeight=r}setTrim(e,r,n,i,a,s){this.trimmed=!0,this.sourceSizeWidth=e,this.sourceSizeHeight=r,this.spriteSourceSizeX=n,this.spriteSourceSizeY=i,this.spriteSourceSizeWidth=a,this.spriteSourceSizeHeight=s}getExtent(e,r){let n=this.sourceSizeWidth,i=this.sourceSizeHeight,a,s,m,u;return this.trimmed?(a=this.spriteSourceSizeX-e*n,s=a+this.spriteSourceSizeWidth,m=this.spriteSourceSizeY-r*i,u=m+this.spriteSourceSizeHeight):(a=-e*n,s=a+n,m=-r*i,u=m+i),{left:a,right:s,top:m,bottom:u}}setExtent(e){let r=e.transform,n=r.origin.x,i=r.origin.y,a=this.sourceSizeWidth,s=this.sourceSizeHeight,m,u,c,f;this.trimmed?(m=this.spriteSourceSizeX-n*a,u=this.spriteSourceSizeY-i*s,c=this.spriteSourceSizeWidth,f=this.spriteSourceSizeHeight):(m=-n*a,u=-i*s,c=a,f=s),r.setExtent(m,u,c,f)}updateUVs(){let{x:e,y:r,width:n,height:i}=this,a=this.texture.width,s=this.texture.height;this.u0=e/a,this.v0=r/s,this.u1=(e+n)/a,this.v1=(r+i)/s}};var T=class{constructor(e,r,n,i){this.key="";e&&(r=e.width,n=e.height),this.image=e,this.width=r,this.height=n,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,r,n),W.add(this,i)}addFrame(e,r,n,i,a){if(this.frames.has(e))return null;let s=new Qe(this,e,r,n,i,a);return this.frames.set(e,s),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=s),s}getFrame(e){if(!e)return this.firstFrame;e instanceof Qe&&(e=e.key);let r=this.frames.get(e);return r||(console.warn(`Frame missing: ${e}`),r=this.firstFrame),r}setSize(e,r){this.width=e,this.height=r,this.frames.get("__BASE").setSize(e,r)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}};var qe=class{constructor(e){this.renderToFramebuffer=!1;this.renderToDepthbuffer=!1;e&&this.fromConfig(e)}fromConfig(e){let{attributes:r=H,fragmentShader:n=tn,height:i=w(),renderToFramebuffer:a=!1,renderToDepthbuffer:s=!1,resolution:m=F(),vertexShader:u=rn,width:c=L(),uniforms:f=qt}=e;if(this.create(n,u,f,r),a){this.renderToFramebuffer=!0;let I=new T(null,c*m,i*m),g=new X(I);I.binding=g,g.framebuffer=$t(g.texture),s&&(this.renderToDepthbuffer=!0,g.depthbuffer=en(g.framebuffer,I.width,I.height)),this.texture=I,this.framebuffer=g.framebuffer}}create(e,r,n,i){let a=Xe(e,o.FRAGMENT_SHADER),s=Xe(r,o.VERTEX_SHADER);if(!a||!s)return;let m=Xt(a,s);if(!m)return;let u=o.getParameter(o.CURRENT_PROGRAM);o.useProgram(m),this.program=m,this.uniformSetters=Qt(m),this.uniforms=new Map;for(let[c,f]of Object.entries(n))this.uniforms.set(c,f);this.attributes=Yt(m,i),o.useProgram(u)}updateUniforms(e){}bind(e){return this.updateUniforms(e),this.setUniforms(e)}setUniform(e,r){let n=this.uniforms;n.has(e)&&(n.set(e,r),this.uniformSetters.get(e)(r))}setUniforms(e){if(!this.program)return!1;o.useProgram(this.program);let r=this.uniforms;for(let[n,i]of this.uniformSetters.entries())i(r.get(n));return!0}setAttributes(e){if(this.program){let r=e.currentVertexBuffer.vertexByteSize;this.attributes.forEach(n=>{o.vertexAttribPointer(n.index,n.size,n.type,n.normalized,r,n.offset)})}}destroy(){le(this.program),ue(this.texture),ce(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}};var A=class extends qe{constructor(e={}){let r=e;r.attributes=r.attributes?r.attributes:H,super(r)}bind(e){let r=this.uniforms;return r.set("uProjectionMatrix",e.projectionMatrix.data),r.set("uCameraMatrix",e.cameraMatrix.data),super.bind(e)}};var nn=`#define SHADER_NAME MULTI_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];

void main (void)
{
    vec4 color;

    %forloop%

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var $e=class extends A{constructor(e={}){e.fragmentShader||(e.fragmentShader=nn),super(e)}create(e,r,n,i){let a=fe(),s="";for(let m=1;m<a;m++)m>1&&(s+=`
	else `),m<a-1&&(s+=`if (vTextureId < ${m}.5)`),s+=`
	{`,s+=`
		color = texture2D(uTexture[${m}], vTextureCoord);`,s+=`
	}`;e=e.replace(/%count%/gi,`${a}`),e=e.replace(/%forloop%/gi,s),super.create(e,r,n,i)}bind(e){return this.uniforms.set("uTexture",e.textureIndex),super.bind(e)}};function Zt(t,e,r,n){let i={enable:e,sfactor:r,dfactor:n};t.blendModeStack[0]=i,t.currentBlendMode=i,t.defaultBlendMode=i}function Kt(t,e=null,r){let n={framebuffer:e,viewport:r};t.framebufferStack[0]=n,t.currentFramebuffer=n,t.defaultFramebuffer=n}function Jt(t,e,r){let n={shader:e,textureID:r};t.shaderStack[0]=n,t.currentShader=n,t.defaultShader=n}function er(t,e){t.vertexBufferStack[0]=e,t.currentVertexBuffer=e,t.defaultVertexBuffer=e}function tr(t,e=0,r=0,n=0,i=0){let a=new S(e,r,n,i);t.viewportStack[0]=a,t.currentViewport=a,t.defaultViewport=a}var on,an=0,sn=0,C={get:()=>on,set:t=>{on=t},getFrame:()=>an,setFrame:t=>{an=t},getElapsed:()=>sn,setElapsed:t=>{sn=t}};function de(t=new h){return t.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}var P=class{constructor(e=1,r=0,n=0,i=1,a=0,s=0){this.set(e,r,n,i,a,s)}set(e=1,r=0,n=0,i=1,a=0,s=0){return this.a=e,this.b=r,this.c=n,this.d=i,this.tx=a,this.ty=s,this}identity(){return this.set()}toArray(){let{a:e,b:r,c:n,d:i,tx:a,ty:s}=this;return[e,r,n,i,a,s]}fromArray(e){return this.set(e[0],e[1],e[2],e[3],e[4],e[5])}};var v=class{constructor(e,r=0,n=0){this._x=r,this._y=n,this.onChange=e}destroy(){this.onChange=D}set(e=0,r=0){return this._x=e,this._y=r,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(e){let r=this._x;this._x=e,r!==e&&this.onChange(this)}get y(){return this._y}set y(e){let r=this._y;this._y=e,r!==e&&this.onChange(this)}toArray(e=[],r=0){let{x:n,y:i}=this;return e[r]=n,e[r+1]=i,e}fromArray(e,r=0){return this.set(e[r],e[r+1])}toString(){let{x:e,y:r}=this;return`{ x=${e}, y=${r} }`}};var he={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};var Q=class{constructor(){this.type="StaticCamera",this.dirtyRender=!0;let e=C.get();this.renderer=e.renderer,this.matrix=de(),this.bounds=new S,this.worldTransform=new P,this.reset()}reset(){let e=this.renderer;if(e){let r=e.width,n=e.height;this.width=r,this.height=n}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}};var Ze=class{constructor(e){this.count=0;this.prevCount=0;this.flushTotal=0;this.maxTextures=0;this.currentActiveTexture=0;this.startActiveTexture=0;this.tempTextures=[];this.textureIndex=[];this.framebufferStack=[];this.currentFramebuffer=null;this.defaultFramebuffer=null;this.vertexBufferStack=[];this.currentVertexBuffer=null;this.defaultVertexBuffer=null;this.shaderStack=[];this.currentShader=null;this.defaultShader=null;this.viewportStack=[];this.currentViewport=null;this.defaultViewport=null;this.blendModeStack=[];this.currentBlendMode=null;this.defaultBlendMode=null;this.renderer=e,this.projectionMatrix=new h,this.reset()}reset(){let e=this.renderer.gl,r=[0,1,2,2,3,0];this.quadShader=new A,this.quadBuffer=new Ye({isDynamic:!1,indexLayout:r}),this.quadCamera=new Q,zt(this),Kt(this),Zt(this,!0,e.ONE,e.ONE_MINUS_SRC_ALPHA),er(this,new Ye({batchSize:$r(),indexLayout:r})),Jt(this,new $e)}resize(e,r){Wt(0,e,r,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),tr(this,0,0,e,r)}};function xe(t,e){e||(e=t.currentShader),e.shader.bind(t,e.textureID)&&e.shader.setAttributes(t)}function rr(t,e){t.current2DCamera=e,t.cameraMatrix=e.matrix,xe(t)}function be(t,e){e||(e=t.currentBlendMode),e.enable?(o.enable(o.BLEND),o.blendFunc(e.sfactor,e.dfactor)):o.disable(o.BLEND)}function ge(t,e){e||(e=t.currentVertexBuffer);let r=e.indexed?e.indexBuffer:null;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r),o.bindBuffer(o.ARRAY_BUFFER,e.vertexBuffer)}function Ke(t,e=0){let r=t.currentVertexBuffer;t.count+e>=r.batchSize&&M(t);let n=r.indexed?t.count*r.entryElementSize:t.count*r.vertexElementSize;return t.count+=e,{buffer:r,F32:r.vertexViewF32,U32:r.vertexViewU32,offset:n}}function nr(t,e){let r=e.binding,n=t.currentActiveTexture;return r.indexCounter<t.startActiveTexture&&(r.indexCounter=t.startActiveTexture,n<t.maxTextures?(r.setIndex(n),o.activeTexture(o.TEXTURE0+n),o.bindTexture(o.TEXTURE_2D,r.texture),t.currentActiveTexture++):(M(t),t.startActiveTexture++,r.indexCounter=t.startActiveTexture,r.setIndex(1),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,r.texture),t.currentActiveTexture=2)),r.index}function or(t){t.current2DCamera=t.quadCamera,t.cameraMatrix=t.quadCamera.matrix,t.count=0,t.flushTotal=0,B(t,!1,t.defaultFramebuffer),be(t,t.defaultBlendMode),O(t,t.defaultViewport),ge(t,t.defaultVertexBuffer)}var un,ir={get:()=>un,set:t=>{un=t}};var ar=class{constructor(){this.clearColor=[0,0,0,1];this.clearBeforeRender=!0;this.optimizeRedraw=!1;this.autoResize=!0;this.contextLost=!1;this.width=L(),this.height=w(),this.resolution=F(),this.setBackgroundColor(wt());let e=document.createElement("canvas");e.addEventListener("webglcontextlost",r=>this.onContextLost(r),!1),e.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=e,this.initContext(),ir.set(this),this.renderPass=new Ze(this),this.resize(this.width,this.height,this.resolution)}initContext(){let e=this.canvas.getContext("webgl",Xr());Wr.set(e),this.gl=e,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE)}resize(e,r,n=1){let i=e*n,a=r*n;this.width=i,this.height=a,this.resolution=n;let s=this.canvas;s.width=i,s.height=a,this.autoResize&&(s.style.width=e.toString()+"px",s.style.height=r.toString()+"px"),this.renderPass.resize(i,a)}onContextLost(e){e.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(e){return Yr(e,this.clearColor),this}reset(){}render(e){if(this.contextLost)return;let r=this.gl,n=this.renderPass;if(_t(),this.optimizeRedraw&&e.numDirtyFrames===0&&e.numDirtyCameras===0)return;if(this.clearBeforeRender){let a=this.clearColor;r.clearColor(a[0],a[1],a[2],a[3]),r.clear(r.COLOR_BUFFER_BIT)}let i=e.worldData;or(n);for(let a=0;a<i.length;a++){let{world:s}=i[a];s.renderGL(n),s.postRenderGL(n)}kt(n)}destroy(){ir.set(void 0)}};function sr(){return()=>{ke(ar)}}function k(t){let e=[t],r=[];for(;e.length>0;){let n=e.shift();r.push(n);let i=n.numChildren;if(i>0)for(let a=i-1;a>=0;a--)e.unshift(n.children[a])}return r.shift(),r}function V(t,e){return t.children.indexOf(e)}function Je(t,e){let r=t.children,n;if(e>=0&&e<r.length){let i=r.splice(e,1);i[0]&&(n=i[0],n.parent=null)}return n}function Ie(t,e){let r=V(t,e);return r>-1&&Je(t,r),e}var et="addedtoworld";var Re="destroy";var mr="postupdate";var tt="removedfromworld";var q="update";function b(t,e,...r){if(t.events.size===0||!t.events.has(e))return!1;let n=t.events.get(e);for(let i of n)i.callback.apply(i.context,r),i.once&&n.delete(i);return n.size===0&&t.events.delete(e),!0}function cr(t,...e){return e.forEach(r=>{r.world&&(b(r.world,tt,r,r.world),b(r,tt,r,r.world)),r.world=t,b(t,et,r,t),b(r,et,r,t)}),e}function _(t,...e){e.forEach(n=>{n.parent&&Ie(n.parent,n),n.parent=t});let r=t.world;return r&&cr(r,...k(t)),e}function ur(t,e){return t.children.push(e),_(t,e),e.transform.updateWorld(),e}function fr(t,...e){return e.forEach(r=>{ur(t,r)}),e}var x={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function Se(t,e=0,r){let n=t.children;r===void 0&&(r=n.length);let i=r-e;if(i>0&&i<=r){let a=n.splice(e,i);return a.forEach(s=>{s.parent=null}),a}else return[]}function pr(t,e=0,r){Se(t,e,r).forEach(i=>{i.destroy()})}function dr(t,...e){return e.forEach(r=>{Ie(t,r)}),e}function hr(t,e,r=0,n){let i=Se(t,r,n);return _(e,...i),i.forEach(a=>{a.transform.updateWorld()}),i}var $=class{constructor(){this.events=new Map}};var Z=class{constructor(e,r,n=!1){this.callback=e,this.context=r,this.once=n}};function j(t,e,r,n,i){let a=t.events,s=a.get(e);if(!r)a.delete(e);else if(r instanceof Z)s.delete(r);else{let m=!n,u=i!==void 0;for(let c of s)c.callback===r&&m&&c.context===n&&u&&c.once===i&&s.delete(c)}return s.size===0&&a.delete(e),t}function E(t,e,r,n=t,i=!1){if(typeof r!="function")throw new TypeError("Listener not a function");let a=new Z(r,n,i),s=t.events.get(e);return s?s.add(a):t.events.set(e,new Set([a])),a}function Ce(t,e,r,n=t){return E(t,e,r,n,!0)}var xr=class{constructor(e,r){this.name=e,typeof r=="string"?(this.modifier=r.substr(0,1),this.end=parseFloat(r.substring(1))):this.end=r}getEnd(e){let r=this.modifier,n=this.end;return r==="+"?e+n:r==="-"?e-n:n}to(e){let r=e[this.name],n=this.getEnd(r);this.start=r,this.end=n}from(e){let r=e[this.name],n=this.getEnd(r);this.start=n,this.end=r,e[this.name]=n}update(e,r){e[this.name]=this.start+(this.end-this.start)*r}};var br=class{constructor(e,r,n=!0){this.state={running:!1,repeat:!1,hold:!1,delay:!1,yoyo:!1,yoyoing:!1,autoStart:!0,reversed:!1};this.init={duration:0,repeat:0,repeatDelay:0,hold:0,delay:0};this.counters={repeat:0,delay:0,progress:0,elapsed:0};this.ease=ae;this.properties=[];r||(r=C.get()),this.target=e,this.state.autoStart=n,this.emitter=r}to(e,r=null){return this.add(e,r,!1)}from(e,r=null){return this.add(e,r,!0)}add(e,r,n){let i=this.state,a=this.init;if(i.running)return this;let s=this.properties;for(let[m,u]of Object.entries(r))s.push(new xr(m,u));return a.duration=e,i.reversed=n,i.autoStart&&this.start(),this}start(){let e=this.state;if(e.running)return this;let r=this.target;return this.properties.forEach(i=>{e.reversed?i.from(r):i.to(r)}),e.running=!0,this.listener=E(this.emitter,q,i=>this.update(i)),this}restart(){let e=this.state,r=this.init,n=this.counters;if(!e)throw"Cannot restart destroyed tween";return n.delay=r.delay,n.elapsed=0,n.progress=0,n.repeat=r.repeat,e.yoyoing=!1,e.running=!0,this}update(e){let r=this.state,n=this.init,i=this.counters;if(!r.running)return!1;if(i.delay>0)if(i.delay-=e,i.delay<=0)i.elapsed=Math.abs(i.delay)-e,i.delay=0;else return!1;i.elapsed+=e;let a=Math.min(i.elapsed/n.duration,1);i.progress=a;let s=r.yoyoing?this.ease(1-a):this.ease(a),m=this.target;if(this.properties.forEach(f=>{f.update(m,s)}),a<1)return!1;let c=i.elapsed-n.duration;return r.yoyo&&!r.yoyoing?(i.elapsed=c,i.delay=n.hold-c,r.yoyoing=!0,!1):i.repeat>0?(i.repeat--,i.elapsed=c,i.delay=n.repeatDelay-c,r.yoyoing=!1,!1):(this.destroy(),!0)}delay(e){let r=e;return this.init.delay=r,this.counters.delay=r,this}hold(e){return this.init.hold=e,this}yoyo(e=!0){return this.state.yoyo=e,this}repeat(e=1,r=0){let n=this.init;return this.state.repeat=e>0,this.counters.repeat=e,n.repeat=e,n.repeatDelay=r,this}easing(e){return this.ease=e,this}destroy(){j(this.emitter,q,this.listener),this.properties.length=0,this.target=null,this.ease=null,this.emitter=null,this.state=null,this.init=null,this.counters=null}};function pn(t,e=null,r=!0){return new br(t,e,r)}function gr(t,e){return se(e).appendChild(t),t}function Ir(t){let e=document.readyState;if(e==="complete"||e==="interactive"){t();return}let r=()=>{document.removeEventListener("deviceready",r,!0),document.removeEventListener("DOMContentLoaded",r,!0),window.removeEventListener("load",r,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",r,!0):(document.addEventListener("DOMContentLoaded",r,!0),window.addEventListener("load",r,!0)):window.setTimeout(r,20)}function Rr(){let{title:t,version:e,url:r,color:n,background:i}=d.get(l.BANNER);if(t!==""){let a=e!==""?t+" "+e:t;console.log(`%c${a}%c ${r}`,`padding: 4px 16px; color: ${n}; background: ${i}`,"")}}function Sr(){return d.get(l.PARENT)}function Cr(){return d.get(l.RENDERER)}function ln(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function Tr(){return d.get(l.SCENES)}function dn(t,e=0){t.gameFrame=e,t.numTotalFrames=0,t.numDirtyFrames=0,t.numDirtyCameras=0,t.worldData.length=0}var hn,rt={get:()=>hn,set:t=>{hn=t}};var yr=class{constructor(){this.scenes=new Map;this.sceneIndex=0;this.flush=!1;this.renderResult=ln();this.game=C.get(),rt.set(this),Ce(this.game,"boot",()=>this.boot())}boot(){Tr().forEach(e=>new e)}update(e,r){for(let n of this.scenes.values())b(n,"update",e,r)}render(e){let r=this.renderResult;dn(r,e);for(let n of this.scenes.values())b(n,"render",r);return this.flush&&(r.numDirtyFrames++,this.flush=!1),r}};function xn(){De(0),Et(4096),Ae("Phaser","4.0.0","https://phaser4.io"),Y(0),_e(.5,.5),Pe(800,600,1)}function Te(t,e){let r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d")}var bn,z={get:()=>bn,set:t=>{bn=t}};var Mr=class{constructor(){this.textures=new Map,this.createDefaultTextures(),z.set(this)}createDefaultTextures(){this.add("__BLANK",new T(Te(32,32).canvas));let e=Te(32,32);e.strokeStyle="#0f0",e.moveTo(0,0),e.lineTo(32,32),e.stroke(),e.strokeRect(.5,.5,31,31),this.add("__MISSING",new T(e.canvas));let r=Te(32,32);r.fillStyle="#fff",r.fillRect(0,0,32,32),this.add("__WHITE",new T(r.canvas))}get(e){let r=this.textures;return r.has(e)?r.get(e):r.get("__MISSING")}has(e){return this.textures.has(e)}add(e,r,n){let i,a=this.textures;return a.has(e)||(r instanceof T?i=r:i=new T(r,0,0,n),i.key=e,a.set(e,i)),i}};var Gr=class extends ${constructor(...e){super();this.VERSION="4.0.0-beta1";this.isBooted=!1;this.isPaused=!1;this.willUpdate=!0;this.willRender=!0;this.lastTick=0;this.elapsed=0;this.frame=0;C.set(this),xn(),Ir(()=>this.boot(e))}boot(e){e.forEach(i=>i());let r=Cr();this.renderer=new r,this.textureManager=new Mr,this.sceneManager=new yr;let n=Sr();n&&gr(this.renderer.canvas,n),this.isBooted=!0,Rr(),b(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(e){let r=e-this.lastTick;this.lastTick=e,this.elapsed+=r,this.isPaused||(this.willUpdate&&(this.sceneManager.update(r,e),b(this,"update",r,e)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,C.setFrame(this.frame),C.setElapsed(this.elapsed),requestAnimationFrame(n=>this.step(n))}destroy(){}};var Vr=class{constructor(e,r,n){this.responseType="text";this.crossOrigin=void 0;this.skipCache=!1;this.hasLoaded=!1;this.key=e,this.url=r,this.config=n}};function gn(t,e,r,n){return e||(e=t+r),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(e)?e:n?n.baseURL+n.path+e:e}function In(t){return t.data=new Image,t.crossOrigin&&(t.data.crossOrigin=t.crossOrigin),new Promise((e,r)=>{t.data.onload=()=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,e(t))},t.data.onerror=n=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,t.error=n,r(t))},t.data.src=t.url,t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,e(t))})}function Rn(t,e,r){let n=new Vr(t,e);return n.load=()=>(n.url=gn(n.key,n.url,".png",n.loader),n.loader&&(n.crossOrigin=n.loader.crossOrigin),new Promise((i,a)=>{let s=z.get();s.has(n.key)?i(n):In(n).then(m=>{s.add(m.key,m.data,r),i(m)}).catch(m=>{a(m)})})),n}var Er=class extends ${constructor(){super();this.baseURL="";this.path="";this.crossOrigin="anonymous";this.maxParallelDownloads=-1;this.isLoading=!1;this.reset()}reset(){this.isLoading=!1,this.queue=new Set,this.inflight=new Set,this.completed=new Set,this.progress=0}add(...e){return e.forEach(r=>{r.loader=this,this.queue.add(r)}),this}start(){return this.isLoading?null:new Promise((e,r)=>{this.completed.clear(),this.progress=0,this.queue.size>0?(this.isLoading=!0,this.onComplete=e,this.onError=r,b(this,"start"),this.nextFile()):(this.progress=1,b(this,"complete"),e(this))})}nextFile(){let e=this.queue.size;if(this.maxParallelDownloads!==-1&&(e=Math.min(e,this.maxParallelDownloads)-this.inflight.size),e){let r=this.queue.values();for(;e>0;){let n=r.next().value;this.inflight.add(n),this.queue.delete(n),n.load().then(i=>this.fileComplete(i)).catch(i=>this.fileError(i)),e--}}else this.inflight.size===0&&this.stop()}stop(){!this.isLoading||(this.isLoading=!1,b(this,"complete",this.completed),this.onComplete(),this.completed.clear())}updateProgress(e){this.inflight.delete(e),this.completed.add(e);let r=this.completed.size,n=this.queue.size+this.inflight.size;r>0&&(this.progress=r/(r+n)),b(this,"progress",this.progress,r,n),this.nextFile()}fileComplete(e){b(this,"filecomplete",e),this.updateProgress(e)}fileError(e){b(this,"fileerror",e),this.updateProgress(e)}totalFilesToLoad(){return this.queue.size+this.inflight.size}setBaseURL(e=""){return e!==""&&e.substr(-1)!=="/"&&(e=e.concat("/")),this.baseURL=e,this}setPath(e=""){return e!==""&&e.substr(-1)!=="/"&&(e=e.concat("/")),this.path=e,this}setCORS(e){return this.crossOrigin=e,this}setMaxParallelDownloads(e){return this.maxParallelDownloads=e,this}};function Sn(t,e,r){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:r}function Cn(t,e={}){let r=rt.get(),n=r.scenes.size,i=r.sceneIndex,a=n===0;typeof e=="string"?t.key=e:(e||!e&&a)&&(t.key=Sn(e,"key","scene"+i.toString())),r.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(r.scenes.set(t.key,t),r.flush=!0,r.sceneIndex++)}var vr=class{constructor(e){this.game=C.get(),this.events=new Map,Cn(this,e)}};function ye(t){let{a:e,b:r,c:n,d:i,tx:a,ty:s}=t.world,{x:m,y:u,right:c,bottom:f}=t.extent,I=m*e+u*n+a,g=m*r+u*i+s,y=m*e+f*n+a,G=m*r+f*i+s,J=c*e+f*n+a,ee=c*r+f*i+s,R=c*e+u*n+a,jn=c*r+u*i+s;return{x0:I,y0:g,x1:y,y1:G,x2:J,y2:ee,x3:R,y3:jn}}var nt=class{constructor(e){this.fixed=!1;this.includeChildren=!0;this.visibleOnly=!0;this.entity=e,this.area=new S}set(e,r,n,i){this.area.set(e,r,n,i)}get(){return this.entity.isDirty(x.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){let{x0:e,y0:r,x1:n,y1:i,x2:a,y2:s,x3:m,y3:u}=ye(this.entity.transform),c=Math.min(e,n,a,m),f=Math.min(r,i,s,u),I=Math.max(e,n,a,m),g=Math.max(r,i,s,u);return this.area.set(c,f,I-c,g-f)}update(){let e=this.updateLocal();if(this.entity.clearDirty(x.BOUNDS),!this.includeChildren||!this.entity.numChildren)return e;let r=this.visibleOnly,n=this.entity.children,i=e.x,a=e.y,s=e.right,m=e.bottom;for(let u=0;u<n.length;u++){let c=n[u];if(!c||r&&!c.visible)continue;let f=c.bounds.get();f.x<i&&(i=f.x),f.y<a&&(a=f.y),f.right>s&&(s=f.right),f.bottom>m&&(m=f.bottom)}return e.set(i,a,s-i,m-a)}destroy(){this.entity=null,this.area=null}};var ot=class{constructor(e){this.enabled=!1;this.enabledChildren=!0;this.entity=e}destroy(){this.entity=null,this.hitArea=null}};function wr(){return d.get(l.DEFAULT_ORIGIN).x}function Fr(){return d.get(l.DEFAULT_ORIGIN).y}var p=class{constructor(e=0,r=0){this.set(e,r)}set(e=0,r=0){return this.x=e,this.y=r,this}toArray(e=[],r=0){let{x:n,y:i}=this;return e[r]=n,e[r+1]=i,e}fromArray(e,r=0){return this.set(e[r],e[r+1])}toString(){let{x:e,y:r}=this;return`{ x=${e}, y=${r} }`}};function Or(t){let e=t.local,r=t.position.x,n=t.position.y,i=t.rotation,a=t.scale.x,s=t.scale.y,m=t.skew.x,u=t.skew.y;e.set(Math.cos(i+u)*a,Math.sin(i+u)*a,-Math.sin(i-m)*s,Math.cos(i-m)*s,r,n)}function Br(t,e){let{a:r,b:n,c:i,d:a,tx:s,ty:m}=t;return e.set(r,n,i,a,s,m)}function Dr(t){let e=t.parent,r=t.transform,n=r.local,i=r.world;if(!e)Br(n,i);else if(r.passthru)Br(e.transform.world,i);else{let{a,b:s,c:m,d:u,tx:c,ty:f}=n,{a:I,b:g,c:y,d:G,tx:J,ty:ee}=e.transform.world;i.set(a*I+s*y,a*g+s*G,m*I+u*y,m*g+u*G,c*I+f*y+J,c*g+f*G+ee)}}var it=class{constructor(e,r=0,n=0){this.passthru=!1;this._rotation=0;this.entity=e,this.local=new P,this.world=new P;let i=()=>this.update(),a=()=>this.updateExtent();this.position=new v(i,r,n),this.scale=new v(i,1,1),this.skew=new v(i),this.origin=new v(a,wr(),Fr()),this.extent=new S}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(x.TRANSFORM,x.BOUNDS),Or(this)}updateWorld(){let e=this.entity;e.setDirty(x.TRANSFORM,x.BOUNDS),Dr(e),e.numChildren&&this.updateChildren()}updateChildren(){let e=this.entity.children;for(let r=0;r<e.length;r++)e[r].transform.updateWorld()}globalToLocal(e,r,n=new p){let{a:i,b:a,c:s,d:m,tx:u,ty:c}=this.world,f=1/(i*m+s*-a);return n.x=m*f*e+-s*f*r+(c*s-u*m)*f,n.y=i*f*r+-a*f*e+(-c*i+u*a)*f,n}localToGlobal(e,r,n=new p){let{a:i,b:a,c:s,d:m,tx:u,ty:c}=this.world;return n.x=i*e+s*r+u,n.y=a*e+m*r+c,n}setExtent(e,r,n,i){this.extent.set(e,r,n,i),this.entity.setDirty(x.TRANSFORM,x.BOUNDS)}updateExtent(e,r){let n=this.extent,i=this.entity;e!==void 0&&(n.width=e),r!==void 0&&(n.height=r),n.x=-this.origin.x*n.width,n.y=-this.origin.y*n.height,i.setDirty(x.TRANSFORM,x.BOUNDS)}set rotation(e){e!==this._rotation&&(this._rotation=e,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}};function Ar(t,e){return(((e*255|0)&255)<<24|t)>>>0}var N=class{constructor(e=0,r=0,n=0){this.x=0;this.y=0;this.z=0;this.u=0;this.v=0;this.texture=0;this.tint=16777215;this.alpha=1;this.color=4294967295;this.x=e,this.y=r,this.z=n}setPosition(e,r,n=0){return this.x=e,this.y=r,this.z=n,this}setUV(e,r){return this.u=e,this.v=r,this}setColor(e,r=1){return this.tint=e,this.alpha=r,this.packColor(),this}setAlpha(e){return this.alpha=e,this}setTint(e){return this.tint=e,this}packColor(){this.color=Ar(this.tint,this.alpha)}};function Vn(t,e){let{F32:r,U32:n,offset:i}=Ke(e,1),a=nr(e,t.texture),s=i;t.vertices.forEach(m=>{r[s+0]=m.x,r[s+1]=m.y,r[s+2]=m.u,r[s+3]=m.v,r[s+4]=a,n[s+5]=m.color,s+=6})}var U=class{constructor(e=0,r=0){this.type="GameObject";this.name="";this.willUpdate=!0;this.willUpdateChildren=!0;this.willRender=!0;this.willRenderChildren=!0;this.willCacheChildren=!1;this.dirty=0;this.dirtyFrame=0;this.visible=!0;this.children=[],this.events=new Map,this.transform=new it(this,e,r),this.bounds=new nt(this),this.input=new ot(this),this.dirty=x.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(e){return(this.dirty&e)!=0}clearDirty(e){return this.isDirty(e)&&(this.dirty^=e),this}setDirty(e,r){return this.isDirty(e)||(this.dirty^=e,this.dirtyFrame=C.getFrame()),this.isDirty(r)||(this.dirty^=r),this}update(e,r){if(this.willUpdateChildren){let n=this.children;for(let i=0;i<n.length;i++){let a=n[i];a&&a.willUpdate&&a.update(e,r)}}this.postUpdate(e,r)}postUpdate(e,r){}renderGL(e){}renderCanvas(e){}postRenderGL(e){}postRenderCanvas(e){}get numChildren(){return this.children.length}destroy(e){e?hr(this,e):pr(this),b(this,Re,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}};var at=class extends U{constructor(e=0,r=0){super(e,r);this._alpha=1;this.type="Container"}setSize(e,r=e){return this.transform.updateExtent(e,r),this}setPosition(e,r){return this.transform.position.set(e,r),this}setOrigin(e,r=e){return this.transform.origin.set(e,r),this}setSkew(e,r=e){return this.transform.skew.set(e,r),this}setScale(e,r=e){return this.transform.scale.set(e,r),this}setRotation(e){return this.transform.rotation=e,this}set width(e){this.transform.updateExtent(e)}get width(){return this.transform.extent.width}set height(e){this.transform.updateExtent(void 0,e)}get height(){return this.transform.extent.height}set x(e){this.transform.position.x=e}get x(){return this.transform.position.x}set y(e){this.transform.position.y=e}get y(){return this.transform.position.y}set originX(e){this.transform.origin.x=e}get originX(){return this.transform.origin.x}set originY(e){this.transform.origin.y=e}get originY(){return this.transform.origin.y}set skewX(e){this.transform.skew.x=e}get skewX(){return this.transform.skew.x}set skewY(e){this.transform.skew.y=e}get skewY(){return this.transform.skew.y}set scaleX(e){this.transform.scale.x=e}get scaleX(){return this.transform.scale.x}set scaleY(e){this.transform.scale.y=e}get scaleY(){return this.transform.scale.y}set rotation(e){this.transform.rotation=e}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(e){e!==this._alpha&&(this._alpha=e,this.setDirty(x.TRANSFORM))}};function En(t,e){let r=t.frame;if(!r)return;let n=e.ctx,i=t.transform,{a,b:s,c:m,d:u,tx:c,ty:f}=i.world,{x:I,y:g}=i.extent;n.save(),n.setTransform(a,s,m,u,c,f),n.globalAlpha=t.alpha,n.drawImage(r.texture.image,r.x,r.y,r.width,r.height,I,g,r.width,r.height),n.restore()}function vn(t){return t.vertices.forEach(e=>{e.packColor()}),t}function st(t,e,...r){let n=t.getFrame(e),{u0:i,u1:a,v0:s,v1:m,pivot:u}=n;return r.forEach(c=>{if(!c||n===c.frame)return;c.frame=n,u&&c.setOrigin(u.x,u.y),c.frame.setExtent(c),c.hasTexture=!0;let f=c.vertices;f[0].setUV(i,s),f[1].setUV(i,m),f[2].setUV(a,m),f[3].setUV(a,s)}),r}function wn(t,e,...r){if(!t)r.forEach(n=>{n.texture=null,n.frame=null,n.hasTexture=!1});else{let n;t instanceof T?n=t:n=z.get().get(t),n?(r.forEach(i=>{i.texture=n}),st(n,e,...r)):console.warn(`Invalid Texture key: ${t}`)}return r}function Fn(t){let e=t.vertices,{x0:r,y0:n,x1:i,y1:a,x2:s,y2:m,x3:u,y3:c}=ye(t.transform);return e[0].setPosition(r,n),e[1].setPosition(i,a),e[2].setPosition(s,m),e[3].setPosition(u,c),t}var K=class extends at{constructor(e,r,n,i){super(e,r);this.hasTexture=!1;this._tint=16777215;this.type="Sprite",this.vertices=[new N,new N,new N,new N],this.setTexture(n,i)}setTexture(e,r){return wn(e,r,this),this}setFrame(e){return st(this.texture,e,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(x.COLORS)&&(vn(this),this.clearDirty(x.COLORS)),this.isDirty(x.TRANSFORM)&&(Fn(this),this.clearDirty(x.TRANSFORM))}renderGL(e){this.preRender(),Vn(this,e)}renderCanvas(e){this.preRender(),En(this,e)}get alpha(){return this._alpha}set alpha(e){e!==this._alpha&&(this._alpha=e,this.vertices.forEach(r=>{r.setAlpha(e)}),this.setDirty(x.COLORS))}get tint(){return this._tint}set tint(e){e!==this._tint&&(this._tint=e,this.vertices.forEach(r=>{r.setTint(e)}),this.setDirty(x.COLORS))}destroy(e){super.destroy(e),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertices=[]}};var Pr="worldrender";var kr="worldshutdown";function _r(t,e){e.numRendered++,e.numRenderable++,t.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++,t.children.forEach(r=>{r.children.length>0&&_r(r,e)})}function On(t){if(t.node.isDirty(x.CHILD_CACHE))return!0;let e=[t];for(;e.length>0;){let r=e.pop();if(r.node.isDirty(x.TRANSFORM))return!0;let n=r.children.length;if(n>0)for(let i=0;i<n;i++)e.push(r.children[i])}return e.length=0,!1}function Bn(t,e){t.forEach(r=>{e||On(r)?r.node.setDirty(x.CHILD_CACHE):r.children.length=0})}function jr(t,e,r=[]){for(let n=0;n<e.numChildren;n++){let i=e.children[n];if(i.isRenderable()){let a=[],s={node:i,children:a};r.push(s),i.willRenderChildren&&i.numChildren>0&&(i.willCacheChildren&&t.push(s),jr(t,i,a))}}return r}function Dn(t){let e=[],n=jr(e,t,[]),i=t.renderData;e.length>0&&Bn(e,t.camera.dirtyRender),n.forEach(a=>{a.children.length>0?_r(a,i):(i.numRendered++,i.numRenderable++,a.node.dirtyFrame>=i.gameFrame&&i.dirtyFrame++)}),t.renderList=n,t.forceRefresh&&(i.dirtyFrame++,t.forceRefresh=!1)}function An(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty}function Pn(t,e){t.numDirtyFrames+=e.dirtyFrame,t.numTotalFrames+=e.numRendered,e.camera.dirtyRender&&t.numDirtyCameras++,t.worldData.push(e)}function mt(t,e){t.gameFrame=e,t.dirtyFrame=0,t.numRendered=0,t.numRenderable=0}var zr=class extends U{constructor(e){super();this.forceRefresh=!1;this.is3D=!1;this.type="BaseWorld",this.scene=e,this.world=this,this.events=new Map,this.renderList=[],this._updateListener=E(e,"update",(r,n)=>this.update(r,n)),this._renderListener=E(e,"render",r=>this.render(r)),this._shutdownListener=E(e,"shutdown",()=>this.shutdown()),Ce(e,"destroy",()=>this.destroy())}update(e,r){!this.willUpdate||(b(this,q,e,r,this),super.update(e,r))}postUpdate(e,r){b(this,mr,e,r,this)}render(e){let r=this.renderData;mt(r,e.gameFrame),!(!this.willRender||!this.visible)&&(Dn(this),b(this,Pr,r,this),Pn(e,r),this.camera.dirtyRender=!1)}renderGL(e){let r=e.current2DCamera,n=this.camera;(!r||!An(n.worldTransform,r.worldTransform))&&M(e),rr(e,n),this.renderList.forEach(i=>{i.children.length>0?this.renderNode(i,e):i.node.renderGL(e)})}renderNode(e,r){e.node.renderGL(r),e.children.forEach(n=>{n.children.length>0?this.renderNode(n,r):n.node.renderGL(r)}),e.node.postRenderGL(r)}postRenderGL(e){}shutdown(){let e=this.scene;j(e,"update",this._updateListener),j(e,"render",this._renderListener),j(e,"shutdown",this._shutdownListener),dr(this),b(this,kr,this),mt(this.renderData,0),this.camera&&this.camera.reset()}destroy(e){super.destroy(e),b(this,Re,this),mt(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}};function kn(t,e){return{world:t,camera:e,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}var Nr=class extends zr{constructor(e){super(e);this.type="StaticWorld",this.camera=new Q,this.renderData=kn(this,this.camera)}};var _n=class extends vr{constructor(){super();let e=new Nr(this),r=new Er;r.add(Rn("logo","assets/logo.png")),r.start().then(()=>{let n=new K(400,100,"logo").setRotation(.3);pn(n).to(3e3,{y:400,rotation:0}).easing(we.Out),fr(e,n)})}};new Gr(sr(),je("gameParent"),Vt(2960685),ze(_n));})();
/**
 * @author       Niklas von Hertzen (https://github.com/niklasvh/base64-arraybuffer)
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
