(()=>{function V(r){let t=[r],e=[];for(;t.length>0;){let o=t.shift();e.push(o);let i=o.numChildren;if(i>0)for(let s=i-1;s>=0;s--)t.unshift(o.children[s])}return e.shift(),e}function F(r,t){return r.children.indexOf(t)}function yt(r,t){let e=r.children,o;if(t>=0&&t<e.length){let i=e.splice(t,1);i[0]&&(o=i[0],o.parent=null)}return o}function tt(r,t){let e=F(r,t);return e>-1&&yt(r,e),t}var Mt="addedtoworld";var et="destroy";var Zt="postupdate";var Et="removedfromworld";var Kt="update";function g(r,t,...e){if(r.events.size===0||!r.events.has(t))return!1;let o=r.events.get(t);for(let i of o)i.callback.apply(i.context,e),i.once&&o.delete(i);return o.size===0&&r.events.delete(t),!0}function Jt(r,...t){return t.forEach(e=>{e.world&&(g(e.world,Et,e,e.world),g(e,Et,e,e.world)),e.world=r,g(r,Mt,e,r),g(e,Mt,e,r)}),t}function v(r,...t){t.forEach(o=>{o.parent&&tt(o.parent,o),o.parent=r});let e=r.world;return e&&Jt(e,...V(r)),t}function te(r,t){return r.children.push(t),v(r,t),t.transform.updateWorld(),t}function ee(r,...t){return t.forEach(e=>{te(r,e)}),t}var d={CLEAR:0,TRANSFORM:1,UPDATE:2,CHILD_CACHE:4,POST_RENDER:8,COLORS:16,BOUNDS:32,TEXTURE:64,FRAME:128,ALPHA:256,CHILD:512,DEFAULT:1+2+16+32,USER1:536870912,USER2:1073741824,USER3:2147483648,USER4:4294967296};function rt(r,t=0,e){let o=r.children;e===void 0&&(e=o.length);let i=e-t;if(i>0&&i<=e){let s=o.splice(t,i);return s.forEach(a=>{a.parent=null}),s}else return[]}function re(r,t=0,e){rt(r,t,e).forEach(i=>{i.destroy()})}function ne(r,...t){return t.forEach(e=>{tt(r,e)}),t}function ie(r,t,e=0,o){let i=rt(r,e,o);return v(t,...i),i.forEach(s=>{s.transform.updateWorld()}),i}var l={BACKGROUND_COLOR:"BackgroundColor",BATCH_SIZE:"BatchSize",DEFAULT_ORIGIN:"DefaultOrigin",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",SIZE:"Size",SCENES:"Scenes",RENDERER:"Renderer",AUTO:"Auto",WEBGL:"WebGL",CANVAS:"Canvas",WEBGL_CONTEXT:"WebGLContext",CANVAS_CONTEXT:"CanvasContext",BANNER:"Banner"};var p=new Map;function bt(r){p.set(l.BACKGROUND_COLOR,r)}function se(r){return()=>{bt(r)}}function wt(r="",t="",e="",o="#fff",i="linear-gradient(#3e0081 40%, #00bcc3)"){p.set(l.BANNER,{title:r,version:t,url:e,color:o,background:i})}function ae(r){p.set(l.BATCH_SIZE,r)}function B(){return p.get(l.SIZE).height}function L(){return p.get(l.SIZE).resolution}function I(){return p.get(l.SIZE).width}function ot(r=800,t=600,e=1){e===0&&(e=window.devicePixelRatio),p.set(l.SIZE,{width:r,height:t,resolution:e})}function Ft(r=800,t=600,e=1){return()=>{ot(r,t,e)}}var me=[],X={add:(r,t)=>{me.push({texture:r,glConfig:t})},get:()=>me,clear:()=>{me.length=0}};function fe(){return p.get(l.BACKGROUND_COLOR)}function At(r){p.set(l.RENDERER,r)}function Gt(r=.5,t=r){p.set(l.DEFAULT_ORIGIN,{x:r,y:t})}function H(r){p.set(l.MAX_TEXTURES,r)}function nt(r){let t;return r&&(typeof r=="string"?t=document.getElementById(r):typeof r=="object"&&r.nodeType===1&&(t=r)),t||(t=document.body),t}function ce(r){r&&p.set(l.PARENT,nt(r))}function Dt(r){return()=>{ce(r)}}function he(r){p.set(l.SCENES,[].concat(r))}function Vt(r){return()=>{he(r)}}function vt(r,t,e){return r.width<=0||r.height<=0?!1:r.x<=t&&r.x+r.width>=t&&r.y<=e&&r.y+r.height>=e}var y=class{constructor(t=0,e=0,o=0,i=0){this.set(t,e,o,i)}set(t=0,e=0,o=0,i=0){return this.x=t,this.y=e,this.width=o,this.height=i,this}contains(t,e){return vt(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}};function ue(r,t=0,e=0,o=0,i=0){let s=new y(t,e,o,i);return r.viewportStack.push(s),s}var n,lr={get:()=>n,set:r=>{n=r}};function _(r,t){if(!t&&(t=r.currentViewport,!t))return;let e=n.getParameter(n.VIEWPORT);(e[0]!==t.x||e[1]!==t.y||e[2]!==t.width||e[3]!==t.height)&&n.viewport(t.x,t.y,t.width,t.height)}function le(r,t=0,e=0,o=0,i=0){let s=ue(r,t,e,o,i);_(r,s),r.currentViewport=s}function O(r,t=!0,e){e||(e=r.currentFramebuffer);let{framebuffer:o,viewport:i}=e;n.bindFramebuffer(n.FRAMEBUFFER,o),t&&(n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)),i&&le(r,i.x,i.y,i.width,i.height)}function pe(r){let t=r.viewportStack;t.length>1&&t.pop(),r.currentViewport=t[t.length-1],_(r)}function it(r){let t=r.framebufferStack;t.length>1&&(r.currentFramebuffer.viewport&&pe(r),t.pop()),r.currentFramebuffer=t[t.length-1],O(r,!1)}function de(r,t,e){let o={framebuffer:t,viewport:e};return r.framebufferStack.push(o),o}function Bt(r,t,e=!0,o){let i=de(r,t,o);O(r,e,i),r.currentFramebuffer=i}function xe(r){let t=r.count;if(t===0)return;let e=r.currentVertexBuffer,o=r.currentShader,i=o.shader.renderToFramebuffer;if(i&&Bt(r,o.shader.framebuffer,!0),t===e.batchSize){let s=e.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW;n.bufferData(n.ARRAY_BUFFER,e.data,s)}else{let s=e.indexed?t*e.entryElementSize:t*e.vertexElementSize,a=e.vertexViewF32.subarray(0,s);n.bufferSubData(n.ARRAY_BUFFER,0,a)}e.indexed?n.drawElements(n.TRIANGLES,t*e.entryIndexSize,n.UNSIGNED_SHORT,0):n.drawArrays(n.TRIANGLES,0,t),i&&it(r)}function b(r,t){t&&(r.count=t);let e=r.count;return e===0?!1:(xe(r),r.prevCount=e,r.count=0,r.flushTotal++,!0)}function ge(r){b(r)}function pr(r,t=[]){let e=r>>16&255,o=r>>8&255,i=r&255,s=r>16777215?r>>>24:255;return t[0]=e/255,t[1]=o/255,t[2]=i/255,t[3]=s/255,t}function dr(){return p.get(l.WEBGL_CONTEXT)}function Lt(r){let{parent:t,flipY:e,unpackPremultiplyAlpha:o,minFilter:i,magFilter:s,wrapS:a,wrapT:m,generateMipmap:f,isPOT:c}=r,h=t.image,R=t.width,S=t.height,E=n.createTexture();return n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,E),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),h?(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,h),R=h.width,S=h.height):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,R,S,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,m),f&&c&&n.generateMipmap(n.TEXTURE_2D),r.texture=E,E}function st(r){n&&n.isFramebuffer(r)&&n.deleteFramebuffer(r)}function at(r){n.isTexture(r)&&n.deleteTexture(r)}function xr(r,t){return r<1||t<1?!1:(r&r-1)==0&&(t&t-1)==0}function gr(r,t=!0){n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r);let e=t?n.LINEAR:n.NEAREST;n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e)}function Sr(r){let t=r.parent.image,e=t.width,o=t.height;return e>0&&o>0&&(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r.texture),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,r.flipY),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),r.texture}var Q=class{constructor(t,e={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1,this.parent=t,this.isPOT=xr(t.width,t.height);let{texture:o=null,framebuffer:i=null,depthbuffer:s=null,unpackPremultiplyAlpha:a=!0,minFilter:m=this.isPOT?n.LINEAR_MIPMAP_LINEAR:n.LINEAR,magFilter:f=n.LINEAR,wrapS:c=n.CLAMP_TO_EDGE,wrapT:h=n.CLAMP_TO_EDGE,generateMipmap:R=this.isPOT,flipY:S=!1}=e;this.minFilter=m,this.magFilter=f,this.wrapS=c,this.wrapT=h,this.generateMipmap=R,this.flipY=S,this.unpackPremultiplyAlpha=a,i&&(this.framebuffer=i),s&&(this.depthbuffer=s),o?this.texture=o:Lt(this)}setFilter(t){this.texture&&gr(this.texture,t)}create(){let t=this.texture;return t&&at(t),Lt(this)}update(){return this.texture?Sr(this):Lt(this)}setIndex(t){this.dirtyIndex=t!==this.index,this.index=t}destroy(){at(this.texture),st(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}};function Se(){X.get().forEach(t=>{let{texture:e,glConfig:o}=t;e.binding||(e.binding=new Q(e,o))}),X.clear()}function mt(){return p.get(l.MAX_TEXTURES)}var fo=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function co(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function Re(r){let t=n.createShader(n.FRAGMENT_SHADER);for(;;){let e=fo.replace(/%forloop%/gi,co(r));if(n.shaderSource(t,e),n.compileShader(t),!n.getShaderParameter(t,n.COMPILE_STATUS))r=r/2|0;else break}return r}function Ce(r){let t=Re(n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),e=mt();e===0||e>0&&e>t?H(t):e>0&&e<t&&(t=Math.max(8,e));let o=r.tempTextures;o.length&&o.forEach(s=>{n.deleteTexture(s)});let i=[];for(let s=0;s<t;s++){let a=n.createTexture();n.activeTexture(n.TEXTURE0+s),n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),o[s]=a,i.push(s)}r.maxTextures=t,r.textureIndex=i,r.currentActiveTexture=1}function Rr(){return p.get(l.BATCH_SIZE)}function ft(r){n.isBuffer(r)&&n.deleteBuffer(r)}var Te=class{constructor(t={}){this.indexed=!1,this.isDynamic=!1,this.count=0,this.offset=0;let{batchSize:e=1,dataSize:o=4,isDynamic:i=!0,elementsPerEntry:s=4,vertexElementSize:a=6}=t;this.batchSize=e,this.dataSize=o,this.vertexElementSize=a,this.isDynamic=i,this.elementsPerEntry=s,this.vertexByteSize=a*o,this.entryByteSize=this.vertexByteSize*s,this.bufferByteSize=e*this.entryByteSize,this.create()}resize(t){this.batchSize=t,this.bufferByteSize=t*this.entryByteSize,this.vertexBuffer&&ft(this.vertexBuffer),this.create()}create(){let t=new ArrayBuffer(this.bufferByteSize);this.data=t,this.vertexViewF32=new Float32Array(t),this.vertexViewU32=new Uint32Array(t),this.vertexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);let e=this.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW;n.bufferData(n.ARRAY_BUFFER,t,e),n.bindBuffer(n.ARRAY_BUFFER,null)}add(t){this.count+=t,this.offset+=this.vertexElementSize*t}reset(){this.count=0,this.offset=0}canContain(t){return this.count+t<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer)}destroy(){ft(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}};var It=class extends Te{constructor(t={}){super(t);let{indexSize:e=4,entryIndexSize:o=6,indexLayout:i=null}=t;this.indexed=!0,this.indexSize=e,this.entryIndexSize=o,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;let s=[];if(i){this.indexLayout=i;for(let a=0;a<this.batchSize*e;a+=e)for(let m=0;m<i.length;m++)s.push(a+i[m])}this.create(),this.createIndexBuffer(s)}createIndexBuffer(t){this.index=new Uint16Array(t),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.index,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t=[]}bind(){n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),ft(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}};var Tr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",po=new Uint8Array(256);for(let r=0;r<Tr.length;r++)po[Tr.charCodeAt(r)]=r;function N(){}var x=class{constructor(t){let e=new Float32Array(16);this.data=e,this.onChange=N,t?Array.isArray(t)?this.fromArray(t):this.fromArray(t.data):(e[0]=1,e[5]=1,e[10]=1,e[15]=1)}set(t,e,o,i,s,a,m,f,c,h,R,S,E,w,K,J){let T=this.data;return T[0]=t,T[1]=e,T[2]=o,T[3]=i,T[4]=s,T[5]=a,T[6]=m,T[7]=f,T[8]=c,T[9]=h,T[10]=R,T[11]=S,T[12]=E,T[13]=w,T[14]=K,T[15]=J,this.onChange(this),this}toArray(t=[],e=0){let o=this.data;for(let i=0;i<16;i++)t[e+i]=o[i];return t}fromArray(t,e=0){let o=this.data;for(let i=0;i<16;i++)o[i]=t[e+i];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=N,this.data=null}};function Me(r,t,e,o,i,s,a=new x){let m=1/(r-t),f=1/(e-o),c=1/(i-s);return a.set(-2*m,0,0,0,0,-2*f,0,0,0,0,2*c,0,(r+t)*m,(o+e)*f,(s+i)*c,1)}function Ee(r,t){let e=new Map,o={size:1,type:n.FLOAT,normalized:!1,stride:0,offset:0},i=n.getProgramParameter(r,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){let a=n.getActiveAttrib(r,s);if(!a)break;let m=a.name,f=n.getAttribLocation(r,m);n.enableVertexAttribArray(f);let c=t.hasOwnProperty(m)?t[m]:{},{size:h=o.size,type:R=o.type,normalized:S=o.normalized,stride:E=o.stride,offset:w=o.offset}=c;e.set(m,{index:f,size:h,type:R,normalized:S,stride:E,offset:w})}return e}function ct(...r){r.forEach(t=>{n.deleteShader(t)})}function be(...r){let t=n.createProgram();if(r.forEach(o=>{n.attachShader(t,o)}),n.linkProgram(t),!n.getProgramParameter(t,n.LINK_STATUS)){let o=n.getProgramInfoLog(t);return console.error(`Error linking program: ${o}`),n.deleteProgram(t),ct(...r),null}return t}function _t(r,t){let e=n.createShader(t);if(n.shaderSource(e,r),n.compileShader(e),!n.getShaderParameter(e,n.COMPILE_STATUS)){let i=n.getShaderInfoLog(e),s=r.split(`
`).map((a,m)=>`${m}: ${a}`);return console.error(`Error compiling shader: ${i}`,s.join(`
`)),n.deleteShader(e),null}return e}function we(r,t,e=!1){switch(r.type){case n.INT:case n.BOOL:return e?o=>{n.uniform1iv(t,o)}:o=>{n.uniform1i(t,o)};case n.INT_VEC2:case n.BOOL_VEC2:return o=>{n.uniform2iv(t,o)};case n.INT_VEC3:case n.BOOL_VEC3:return o=>{n.uniform3iv(t,o)};case n.INT_VEC4:case n.BOOL_VEC4:return o=>{n.uniform4iv(t,o)};case n.FLOAT:return e?o=>{n.uniform1fv(t,o)}:o=>{n.uniform1f(t,o)};case n.FLOAT_VEC2:return o=>{n.uniform2fv(t,o)};case n.FLOAT_VEC3:return o=>{n.uniform3fv(t,o)};case n.FLOAT_VEC4:return o=>{n.uniform4fv(t,o)};case n.FLOAT_MAT2:return o=>{n.uniformMatrix2fv(t,!1,o)};case n.FLOAT_MAT3:return o=>{n.uniformMatrix3fv(t,!1,o)};case n.FLOAT_MAT4:return o=>{n.uniformMatrix4fv(t,!1,o)};case n.SAMPLER_2D:case n.SAMPLER_CUBE:return r.size>1?o=>{n.uniform1iv(t,o)}:o=>{n.uniform1i(t,o)}}}function Fe(r){let t=new Map,e=n.getProgramParameter(r,n.ACTIVE_UNIFORMS);for(let o=0;o<e;o++){let i=n.getActiveUniform(r,o),s=i.name;if(s.startsWith("gl_")||s.startsWith("webgl_"))continue;let a=n.getUniformLocation(r,i.name);if(a){let m=!1;s.substr(-3)==="[0]"&&(s=s.substr(0,s.length-3),m=i.size>1),t.set(s,we(i,a,m))}}return t}var yr=5121;var Ot=5126;var j={aVertexPosition:{size:2,type:Ot,normalized:!1,offset:0},aTextureCoord:{size:2,type:Ot,normalized:!1,offset:8},aTextureId:{size:1,type:Ot,normalized:!1,offset:16},aTintColor:{size:4,type:yr,normalized:!0,offset:20}};var Ae={uProjectionMatrix:new Float32Array,uCameraMatrix:new Float32Array,uTexture:0};function Mr(r,t,e){n.bindFramebuffer(n.FRAMEBUFFER,r);let o=n.createRenderbuffer();return n.bindRenderbuffer(n.RENDERBUFFER,o),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t,e),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,o),n.bindFramebuffer(n.FRAMEBUFFER,null),o}function Ge(r,t){t||(t=n.COLOR_ATTACHMENT0);let e=n.createFramebuffer();return n.bindFramebuffer(n.FRAMEBUFFER,e),n.framebufferTexture2D(n.FRAMEBUFFER,t,n.TEXTURE_2D,r,0),n.bindFramebuffer(n.FRAMEBUFFER,null),e}var Er=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var br=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;var Nt=class{constructor(t,e,o,i,s,a){this.trimmed=!1,this.texture=t,this.key=e,this.x=o,this.y=i,this.width=s,this.height=a,this.sourceSizeWidth=s,this.sourceSizeHeight=a,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,o,i,s,a){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=o,this.spriteSourceSizeY=i,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=a}getExtent(t,e){let o=this.sourceSizeWidth,i=this.sourceSizeHeight,s,a,m,f;return this.trimmed?(s=this.spriteSourceSizeX-t*o,a=s+this.spriteSourceSizeWidth,m=this.spriteSourceSizeY-e*i,f=m+this.spriteSourceSizeHeight):(s=-t*o,a=s+o,m=-e*i,f=m+i),{left:s,right:a,top:m,bottom:f}}setExtent(t){let e=t.transform,o=e.origin.x,i=e.origin.y,s=this.sourceSizeWidth,a=this.sourceSizeHeight,m,f,c,h;this.trimmed?(m=this.spriteSourceSizeX-o*s,f=this.spriteSourceSizeY-i*a,c=this.spriteSourceSizeWidth,h=this.spriteSourceSizeHeight):(m=-o*s,f=-i*a,c=s,h=a),e.setExtent(m,f,c,h)}updateUVs(){let{x:t,y:e,width:o,height:i}=this,s=this.texture.width,a=this.texture.height;this.u0=t/s,this.v0=e/a,this.u1=(t+o)/s,this.v1=(e+i)/a}};var C=class{constructor(t,e,o,i){this.key="",t&&(e=t.width,o=t.height),this.image=t,this.width=e,this.height=o,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,e,o),X.add(this,i)}addFrame(t,e,o,i,s){if(this.frames.has(t))return null;let a=new Nt(this,t,e,o,i,s);return this.frames.set(t,a),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=a),a}getFrame(t){if(!t)return this.firstFrame;t instanceof Nt&&(t=t.key);let e=this.frames.get(t);return e||(console.warn(`Frame missing: ${t}`),e=this.firstFrame),e}setSize(t,e){this.width=t,this.height=e,this.frames.get("__BASE").setSize(t,e)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}};var zt=class{constructor(t){this.renderToFramebuffer=!1,this.renderToDepthbuffer=!1,t&&this.fromConfig(t)}fromConfig(t){let{attributes:e=j,fragmentShader:o=Er,height:i=B(),renderToFramebuffer:s=!1,renderToDepthbuffer:a=!1,resolution:m=L(),vertexShader:f=br,width:c=I(),uniforms:h=Ae}=t;if(this.create(o,f,h,e),s){this.renderToFramebuffer=!0;let R=new C(null,c*m,i*m),S=new Q(R);R.binding=S,S.framebuffer=Ge(S.texture),a&&(this.renderToDepthbuffer=!0,S.depthbuffer=Mr(S.framebuffer,R.width,R.height)),this.texture=R,this.framebuffer=S.framebuffer}}create(t,e,o,i){let s=_t(t,n.FRAGMENT_SHADER),a=_t(e,n.VERTEX_SHADER);if(!s||!a)return;let m=be(s,a);if(!m)return;let f=n.getParameter(n.CURRENT_PROGRAM);n.useProgram(m),this.program=m,this.uniformSetters=Fe(m),this.uniforms=new Map;for(let[c,h]of Object.entries(o))this.uniforms.set(c,h);this.attributes=Ee(m,i),n.useProgram(f)}updateUniforms(t){}bind(t){return this.updateUniforms(t),this.setUniforms(t)}setUniform(t,e){let o=this.uniforms;o.has(t)&&(o.set(t,e),this.uniformSetters.get(t)(e))}setUniforms(t){if(!this.program)return!1;n.useProgram(this.program);let e=this.uniforms;for(let[o,i]of this.uniformSetters.entries())i(e.get(o));return!0}setAttributes(t){if(this.program){let e=t.currentVertexBuffer.vertexByteSize;this.attributes.forEach(o=>{n.vertexAttribPointer(o.index,o.size,o.type,o.normalized,e,o.offset)})}}destroy(){ct(this.program),at(this.texture),st(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}};var z=class extends zt{constructor(t={}){let e=t;e.attributes=e.attributes?e.attributes:j,super(e)}bind(t){let e=this.uniforms;return e.set("uProjectionMatrix",t.projectionMatrix.data),e.set("uCameraMatrix",t.cameraMatrix.data),super.bind(t)}};var wr=`#define SHADER_NAME MULTI_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];

void main (void)
{
    vec4 color;

    %forloop%

    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);
}`;var Ut=class extends z{constructor(t={}){t.fragmentShader||(t.fragmentShader=wr),super(t)}create(t,e,o,i){let s=mt(),a="";for(let m=1;m<s;m++)m>1&&(a+=`
	else `),m<s-1&&(a+=`if (vTextureId < ${m}.5)`),a+=`
	{`,a+=`
		color = texture2D(uTexture[${m}], vTextureCoord);`,a+=`
	}`;t=t.replace(/%count%/gi,`${s}`),t=t.replace(/%forloop%/gi,a),super.create(t,e,o,i)}bind(t){return this.uniforms.set("uTexture",t.textureIndex),super.bind(t)}};function De(r,t,e,o){let i={enable:t,sfactor:e,dfactor:o};r.blendModeStack[0]=i,r.currentBlendMode=i,r.defaultBlendMode=i}function Ve(r,t=null,e){let o={framebuffer:t,viewport:e};r.framebufferStack[0]=o,r.currentFramebuffer=o,r.defaultFramebuffer=o}function ve(r,t,e){let o={shader:t,textureID:e};r.shaderStack[0]=o,r.currentShader=o,r.defaultShader=o}function Be(r,t){r.vertexBufferStack[0]=t,r.currentVertexBuffer=t,r.defaultVertexBuffer=t}function Le(r,t=0,e=0,o=0,i=0){let s=new y(t,e,o,i);r.viewportStack[0]=s,r.currentViewport=s,r.defaultViewport=s}var Fr,Ar=0,Gr=0,M={get:()=>Fr,set:r=>{Fr=r},getFrame:()=>Ar,setFrame:r=>{Ar=r},getElapsed:()=>Gr,setElapsed:r=>{Gr=r}};function ht(r=new x){return r.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}var U=class{constructor(t=1,e=0,o=0,i=1,s=0,a=0){this.set(t,e,o,i,s,a)}set(t=1,e=0,o=0,i=1,s=0,a=0){return this.a=t,this.b=e,this.c=o,this.d=i,this.tx=s,this.ty=a,this}identity(){return this.set()}toArray(){let{a:t,b:e,c:o,d:i,tx:s,ty:a}=this;return[t,e,o,i,s,a]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}};var D=class{constructor(t,e=0,o=0){this._x=e,this._y=o,this.onChange=t}destroy(){this.onChange=N}set(t=0,e=0){return this._x=t,this._y=e,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(t){let e=this._x;this._x=t,e!==t&&this.onChange(this)}get y(){return this._y}set y(t){let e=this._y;this._y=t,e!==t&&this.onChange(this)}toArray(t=[],e=0){let{x:o,y:i}=this;return t[e]=o,t[e+1]=i,t}fromArray(t,e=0){return this.set(t[e],t[e+1])}toString(){let{x:t,y:e}=this;return`{ x=${t}, y=${e} }`}};var ut={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};var q=class{constructor(){this.type="StaticCamera",this.dirtyRender=!0;let t=M.get();this.renderer=t.renderer,this.matrix=ht(),this.bounds=new y,this.worldTransform=new U,this.reset()}reset(){let t=this.renderer;if(t){let e=t.width,o=t.height;this.width=e,this.height=o}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}};var Pt=class{constructor(t){this.count=0,this.prevCount=0,this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.textureIndex=[],this.framebufferStack=[],this.currentFramebuffer=null,this.defaultFramebuffer=null,this.vertexBufferStack=[],this.currentVertexBuffer=null,this.defaultVertexBuffer=null,this.shaderStack=[],this.currentShader=null,this.defaultShader=null,this.viewportStack=[],this.currentViewport=null,this.defaultViewport=null,this.blendModeStack=[],this.currentBlendMode=null,this.defaultBlendMode=null,this.renderer=t,this.projectionMatrix=new x,this.reset()}reset(){let t=this.renderer.gl,e=[0,1,2,2,3,0];this.quadShader=new z,this.quadBuffer=new It({isDynamic:!1,indexLayout:e}),this.quadCamera=new q,Ce(this),Ve(this),De(this,!0,t.ONE,t.ONE_MINUS_SRC_ALPHA),Be(this,new It({batchSize:Rr(),indexLayout:e})),ve(this,new Ut)}resize(t,e){Me(0,t,e,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),Le(this,0,0,t,e)}};function lt(r,t){t||(t=r.currentShader),t.shader.bind(r,t.textureID)&&t.shader.setAttributes(r)}function Ie(r,t){r.current2DCamera=t,r.cameraMatrix=t.matrix,lt(r)}function pt(r,t){t||(t=r.currentBlendMode),t.enable?(n.enable(n.BLEND),n.blendFunc(t.sfactor,t.dfactor)):n.disable(n.BLEND)}function dt(r,t){t||(t=r.currentVertexBuffer);let e=t.indexed?t.indexBuffer:null;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),n.bindBuffer(n.ARRAY_BUFFER,t.vertexBuffer)}function kt(r,t=0){let e=r.currentVertexBuffer;r.count+t>=e.batchSize&&b(r);let o=e.indexed?r.count*e.entryElementSize:r.count*e.vertexElementSize;return r.count+=t,{buffer:e,F32:e.vertexViewF32,U32:e.vertexViewU32,offset:o}}function _e(r,t){let e=t.binding,o=r.currentActiveTexture;return e.indexCounter<r.startActiveTexture&&(e.indexCounter=r.startActiveTexture,o<r.maxTextures?(e.setIndex(o),n.activeTexture(n.TEXTURE0+o),n.bindTexture(n.TEXTURE_2D,e.texture),r.currentActiveTexture++):(b(r),r.startActiveTexture++,e.indexCounter=r.startActiveTexture,e.setIndex(1),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,e.texture),r.currentActiveTexture=2)),e.index}function Oe(r){r.current2DCamera=r.quadCamera,r.cameraMatrix=r.quadCamera.matrix,r.count=0,r.flushTotal=0,O(r,!1,r.defaultFramebuffer),pt(r,r.defaultBlendMode),_(r,r.defaultViewport),dt(r,r.defaultVertexBuffer)}var vr,Ne={get:()=>vr,set:r=>{vr=r}};var ze=class{constructor(){this.clearColor=[0,0,0,1],this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.width=I(),this.height=B(),this.resolution=L(),this.setBackgroundColor(fe());let t=document.createElement("canvas");t.addEventListener("webglcontextlost",e=>this.onContextLost(e),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.initContext(),Ne.set(this),this.renderPass=new Pt(this),this.resize(this.width,this.height,this.resolution)}initContext(){let t=this.canvas.getContext("webgl",dr());lr.set(t),this.gl=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE)}resize(t,e,o=1){let i=t*o,s=e*o;this.width=i,this.height=s,this.resolution=o;let a=this.canvas;a.width=i,a.height=s,this.autoResize&&(a.style.width=t.toString()+"px",a.style.height=e.toString()+"px"),this.renderPass.resize(i,s)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){return pr(t,this.clearColor),this}reset(){}render(t){if(this.contextLost)return;let e=this.gl,o=this.renderPass;if(Se(),this.optimizeRedraw&&t.numDirtyFrames===0&&t.numDirtyCameras===0)return;if(this.clearBeforeRender){let s=this.clearColor;e.clearColor(s[0],s[1],s[2],s[3]),e.clear(e.COLOR_BUFFER_BIT)}let i=t.worldData;Oe(o);for(let s=0;s<i.length;s++){let{world:a}=i[s];a.renderGL(o),a.postRenderGL(o)}ge(o)}destroy(){Ne.set(void 0)}};function Ue(){return()=>{At(ze)}}function A(r,t){let e=document.createElement("canvas");return e.width=r,e.height=t,e.getContext("2d")}function Wt(r=32,t=32){let e=A(r,t);return new C(e.canvas)}function Pe(r,t){return nt(t).appendChild(r),r}function ke(r){let t=document.readyState;if(t==="complete"||t==="interactive"){r();return}let e=()=>{document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),r()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",e,!0):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)}var $=class{constructor(){this.events=new Map}};var Z=class{constructor(t,e,o=!1){this.callback=t,this.context=e,this.once=o}};function xt(r,t,e,o,i){let s=r.events,a=s.get(t);if(!e)s.delete(t);else if(e instanceof Z)a.delete(e);else{let m=!o,f=i!==void 0;for(let c of a)c.callback===e&&m&&c.context===o&&f&&c.once===i&&a.delete(c)}return a.size===0&&s.delete(t),r}function G(r,t,e,o=r,i=!1){if(typeof e!="function")throw new TypeError("Listener not a function");let s=new Z(e,o,i),a=r.events.get(t);return a?a.add(s):r.events.set(t,new Set([s])),s}function gt(r,t,e,o=r){return G(r,t,e,o,!0)}function We(){let{title:r,version:t,url:e,color:o,background:i}=p.get(l.BANNER);if(r!==""){let s=t!==""?r+" "+t:r;console.log(`%c${s}%c ${e}`,`padding: 4px 16px; color: ${o}; background: ${i}`,"")}}function Ye(){return p.get(l.PARENT)}function Xe(){return p.get(l.RENDERER)}function Br(){return{gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]}}function He(){return p.get(l.SCENES)}function Lr(r,t=0){r.gameFrame=t,r.numTotalFrames=0,r.numDirtyFrames=0,r.numDirtyCameras=0,r.worldData.length=0}var Ir,Yt={get:()=>Ir,set:r=>{Ir=r}};var Qe=class{constructor(){this.scenes=new Map,this.sceneIndex=0,this.flush=!1,this.renderResult=Br(),this.game=M.get(),Yt.set(this),gt(this.game,"boot",()=>this.boot())}boot(){He().forEach(t=>new t)}update(t,e){for(let o of this.scenes.values())g(o,"update",t,e)}render(t){let e=this.renderResult;Lr(e,t);for(let o of this.scenes.values())g(o,"render",e);return this.flush&&(e.numDirtyFrames++,this.flush=!1),e}};function _r(){bt(0),ae(4096),wt("Phaser","4.0.0","https://phaser4.io"),H(0),Gt(.5,.5),ot(800,600,1)}var Or,P={get:()=>Or,set:r=>{Or=r}};var je=class{constructor(){this.textures=new Map,this.createDefaultTextures(),P.set(this)}createDefaultTextures(){this.add("__BLANK",new C(A(32,32).canvas));let t=A(32,32);t.strokeStyle="#0f0",t.moveTo(0,0),t.lineTo(32,32),t.stroke(),t.strokeRect(.5,.5,31,31),this.add("__MISSING",new C(t.canvas));let e=A(32,32);e.fillStyle="#fff",e.fillRect(0,0,32,32),this.add("__WHITE",new C(e.canvas))}get(t){let e=this.textures;return e.has(t)?e.get(t):e.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e,o){let i,s=this.textures;return s.has(t)||(e instanceof C?i=e:i=new C(e,0,0,o),i.key=t,s.set(t,i)),i}};var qe=class extends ${constructor(...t){super();this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,M.set(this),_r(),ke(()=>this.boot(t))}boot(t){t.forEach(i=>i());let e=Xe();this.renderer=new e,this.textureManager=new je,this.sceneManager=new Qe;let o=Ye();o&&Pe(this.renderer.canvas,o),this.isBooted=!0,We(),g(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(t){let e=t-this.lastTick;this.lastTick=t,this.elapsed+=e,this.isPaused||(this.willUpdate&&(this.sceneManager.update(e,t),g(this,"update",e,t)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,M.setFrame(this.frame),M.setElapsed(this.elapsed),requestAnimationFrame(o=>this.step(o))}destroy(){}};var $e=class{constructor(t,e,o){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=t,this.url=e,this.config=o}};function Nr(r,t,e,o){return t||(t=r+e),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(t)?t:o?o.baseURL+o.path+t:t}function zr(r){return r.data=new Image,r.crossOrigin&&(r.data.crossOrigin=r.crossOrigin),new Promise((t,e)=>{r.data.onload=()=>{r.data.onload&&(r.data.onload=null,r.data.onerror=null,t(r))},r.data.onerror=o=>{r.data.onload&&(r.data.onload=null,r.data.onerror=null,r.error=o,e(r))},r.data.src=r.url,r.data.complete&&r.data.width&&r.data.height&&(r.data.onload=null,r.data.onerror=null,t(r))})}function St(r,t,e){let o=new $e(r,t);return o.load=()=>(o.url=Nr(o.key,o.url,".png",o.loader),o.loader&&(o.crossOrigin=o.loader.crossOrigin),new Promise((i,s)=>{let a=P.get();a.has(o.key)?i(o):zr(o).then(m=>{a.add(m.key,m.data,e),i(m)}).catch(m=>{s(m)})})),o}var Ze=class extends ${constructor(){super();this.baseURL="",this.path="",this.crossOrigin="anonymous",this.maxParallelDownloads=-1,this.isLoading=!1,this.reset()}reset(){this.isLoading=!1,this.queue=new Set,this.inflight=new Set,this.completed=new Set,this.progress=0}add(...t){return t.forEach(e=>{e.loader=this,this.queue.add(e)}),this}start(){return this.isLoading?null:new Promise((t,e)=>{this.completed.clear(),this.progress=0,this.queue.size>0?(this.isLoading=!0,this.onComplete=t,this.onError=e,g(this,"start"),this.nextFile()):(this.progress=1,g(this,"complete"),t(this))})}nextFile(){let t=this.queue.size;if(this.maxParallelDownloads!==-1&&(t=Math.min(t,this.maxParallelDownloads)-this.inflight.size),t){let e=this.queue.values();for(;t>0;){let o=e.next().value;this.inflight.add(o),this.queue.delete(o),o.load().then(i=>this.fileComplete(i)).catch(i=>this.fileError(i)),t--}}else this.inflight.size===0&&this.stop()}stop(){!this.isLoading||(this.isLoading=!1,g(this,"complete",this.completed),this.onComplete(),this.completed.clear())}updateProgress(t){this.inflight.delete(t),this.completed.add(t);let e=this.completed.size,o=this.queue.size+this.inflight.size;e>0&&(this.progress=e/(e+o)),g(this,"progress",this.progress,e,o),this.nextFile()}fileComplete(t){g(this,"filecomplete",t),this.updateProgress(t)}fileError(t){g(this,"fileerror",t),this.updateProgress(t)}totalFilesToLoad(){return this.queue.size+this.inflight.size}setBaseURL(t=""){return t!==""&&t.substr(-1)!=="/"&&(t=t.concat("/")),this.baseURL=t,this}setPath(t=""){return t!==""&&t.substr(-1)!=="/"&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}setMaxParallelDownloads(t){return this.maxParallelDownloads=t,this}};function Ur(r,t,e){return Object.prototype.hasOwnProperty.call(r,t)?r[t]:e}function Pr(r,t={}){let e=Yt.get(),o=e.scenes.size,i=e.sceneIndex,s=o===0;typeof t=="string"?r.key=t:(t||!t&&s)&&(r.key=Ur(t,"key","scene"+i.toString())),e.scenes.has(r.key)?console.warn("Scene key already in use: "+r.key):(e.scenes.set(r.key,r),e.flush=!0,e.sceneIndex++)}var Ke=class{constructor(t){this.game=M.get(),this.events=new Map,Pr(this,t)}};function Rt(r){let{a:t,b:e,c:o,d:i,tx:s,ty:a}=r.world,{x:m,y:f,right:c,bottom:h}=r.extent,R=m*t+f*o+s,S=m*e+f*i+a,E=m*t+h*o+s,w=m*e+h*i+a,K=c*t+h*o+s,J=c*e+h*i+a,T=c*t+f*o+s,io=c*e+f*i+a;return{x0:R,y0:S,x1:E,y1:w,x2:K,y2:J,x3:T,y3:io}}var Xt=class{constructor(t){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=t,this.area=new y}set(t,e,o,i){this.area.set(t,e,o,i)}get(){return this.entity.isDirty(d.BOUNDS)&&!this.fixed&&this.update(),this.area}updateLocal(){let{x0:t,y0:e,x1:o,y1:i,x2:s,y2:a,x3:m,y3:f}=Rt(this.entity.transform),c=Math.min(t,o,s,m),h=Math.min(e,i,a,f),R=Math.max(t,o,s,m),S=Math.max(e,i,a,f);return this.area.set(c,h,R-c,S-h)}update(){let t=this.updateLocal();if(this.entity.clearDirty(d.BOUNDS),!this.includeChildren||!this.entity.numChildren)return t;let e=this.visibleOnly,o=this.entity.children,i=t.x,s=t.y,a=t.right,m=t.bottom;for(let f=0;f<o.length;f++){let c=o[f];if(!c||e&&!c.visible)continue;let h=c.bounds.get();h.x<i&&(i=h.x),h.y<s&&(s=h.y),h.right>a&&(a=h.right),h.bottom>m&&(m=h.bottom)}return t.set(i,s,a-i,m-s)}destroy(){this.entity=null,this.area=null}};var Ht=class{constructor(t){this.enabled=!1,this.enabledChildren=!0,this.entity=t}destroy(){this.entity=null,this.hitArea=null}};function Je(){return p.get(l.DEFAULT_ORIGIN).x}function tr(){return p.get(l.DEFAULT_ORIGIN).y}var u=class{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}toArray(t=[],e=0){let{x:o,y:i}=this;return t[e]=o,t[e+1]=i,t}fromArray(t,e=0){return this.set(t[e],t[e+1])}toString(){let{x:t,y:e}=this;return`{ x=${t}, y=${e} }`}};function rr(r){let t=r.local,e=r.position.x,o=r.position.y,i=r.rotation,s=r.scale.x,a=r.scale.y,m=r.skew.x,f=r.skew.y;t.set(Math.cos(i+f)*s,Math.sin(i+f)*s,-Math.sin(i-m)*a,Math.cos(i-m)*a,e,o)}function or(r,t){let{a:e,b:o,c:i,d:s,tx:a,ty:m}=r;return t.set(e,o,i,s,a,m)}function nr(r){let t=r.parent,e=r.transform,o=e.local,i=e.world;if(!t)or(o,i);else if(e.passthru)or(t.transform.world,i);else{let{a:s,b:a,c:m,d:f,tx:c,ty:h}=o,{a:R,b:S,c:E,d:w,tx:K,ty:J}=t.transform.world;i.set(s*R+a*E,s*S+a*w,m*R+f*E,m*S+f*w,c*R+h*E+K,c*S+h*w+J)}}var Qt=class{constructor(t,e=0,o=0){this.passthru=!1,this._rotation=0,this.entity=t,this.local=new U,this.world=new U;let i=()=>this.update(),s=()=>this.updateExtent();this.position=new D(i,e,o),this.scale=new D(i,1,1),this.skew=new D(i),this.origin=new D(s,Je(),tr()),this.extent=new y}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(d.TRANSFORM,d.BOUNDS),rr(this)}updateWorld(){let t=this.entity;t.setDirty(d.TRANSFORM,d.BOUNDS),nr(t),t.numChildren&&this.updateChildren()}updateChildren(){let t=this.entity.children;for(let e=0;e<t.length;e++)t[e].transform.updateWorld()}globalToLocal(t,e,o=new u){let{a:i,b:s,c:a,d:m,tx:f,ty:c}=this.world,h=1/(i*m+a*-s);return o.x=m*h*t+-a*h*e+(c*a-f*m)*h,o.y=i*h*e+-s*h*t+(-c*i+f*s)*h,o}localToGlobal(t,e,o=new u){let{a:i,b:s,c:a,d:m,tx:f,ty:c}=this.world;return o.x=i*t+a*e+f,o.y=s*t+m*e+c,o}setExtent(t,e,o,i){this.extent.set(t,e,o,i),this.entity.setDirty(d.TRANSFORM,d.BOUNDS)}updateExtent(t,e){let o=this.extent,i=this.entity;t!==void 0&&(o.width=t),e!==void 0&&(o.height=e),o.x=-this.origin.x*o.width,o.y=-this.origin.y*o.height,i.setDirty(d.TRANSFORM,d.BOUNDS)}set rotation(t){t!==this._rotation&&(this._rotation=t,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}};function ir(r,t){return(((t*255|0)&255)<<24|r)>>>0}var k=class{constructor(t=0,e=0,o=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.texture=0,this.tint=16777215,this.alpha=1,this.color=4294967295,this.x=t,this.y=e,this.z=o}setPosition(t,e,o=0){return this.x=t,this.y=e,this.z=o,this}setUV(t,e){return this.u=t,this.v=e,this}setColor(t,e=1){return this.tint=t,this.alpha=e,this.packColor(),this}setAlpha(t){return this.alpha=t,this}setTint(t){return this.tint=t,this}packColor(){this.color=ir(this.tint,this.alpha)}};function Hr(r,t){let{F32:e,U32:o,offset:i}=kt(t,1),s=_e(t,r.texture),a=i;r.vertices.forEach(m=>{e[a+0]=m.x,e[a+1]=m.y,e[a+2]=m.u,e[a+3]=m.v,e[a+4]=s,o[a+5]=m.color,a+=6})}var W=class{constructor(t=0,e=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map,this.transform=new Qt(this,t,e),this.bounds=new Xt(this),this.input=new Ht(this),this.dirty=d.DEFAULT,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(t){return(this.dirty&t)!=0}clearDirty(t){return this.isDirty(t)&&(this.dirty^=t),this}setDirty(t,e){return this.isDirty(t)||(this.dirty^=t,this.dirtyFrame=M.getFrame()),this.isDirty(e)||(this.dirty^=e),this}update(t,e){if(this.willUpdateChildren){let o=this.children;for(let i=0;i<o.length;i++){let s=o[i];s&&s.willUpdate&&s.update(t,e)}}this.postUpdate(t,e)}postUpdate(t,e){}renderGL(t){}renderCanvas(t){}postRenderGL(t){}postRenderCanvas(t){}get numChildren(){return this.children.length}destroy(t){t?ie(this,t):re(this),g(this,et,this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}};var jt=class extends W{constructor(t=0,e=0){super(t,e);this._alpha=1,this.type="Container"}setSize(t,e=t){return this.transform.updateExtent(t,e),this}setPosition(t,e){return this.transform.position.set(t,e),this}setOrigin(t,e=t){return this.transform.origin.set(t,e),this}setSkew(t,e=t){return this.transform.skew.set(t,e),this}setScale(t,e=t){return this.transform.scale.set(t,e),this}setRotation(t){return this.transform.rotation=t,this}set width(t){this.transform.updateExtent(t)}get width(){return this.transform.extent.width}set height(t){this.transform.updateExtent(void 0,t)}get height(){return this.transform.extent.height}set x(t){this.transform.position.x=t}get x(){return this.transform.position.x}set y(t){this.transform.position.y=t}get y(){return this.transform.position.y}set originX(t){this.transform.origin.x=t}get originX(){return this.transform.origin.x}set originY(t){this.transform.origin.y=t}get originY(){return this.transform.origin.y}set skewX(t){this.transform.skew.x=t}get skewX(){return this.transform.skew.x}set skewY(t){this.transform.skew.y=t}get skewY(){return this.transform.skew.y}set scaleX(t){this.transform.scale.x=t}get scaleX(){return this.transform.scale.x}set scaleY(t){this.transform.scale.y=t}get scaleY(){return this.transform.scale.y}set rotation(t){this.transform.rotation=t}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty(d.TRANSFORM))}};function Qr(r,t){let e=r.frame;if(!e)return;let o=t.ctx,i=r.transform,{a:s,b:a,c:m,d:f,tx:c,ty:h}=i.world,{x:R,y:S}=i.extent;o.save(),o.setTransform(s,a,m,f,c,h),o.globalAlpha=r.alpha,o.drawImage(e.texture.image,e.x,e.y,e.width,e.height,R,S,e.width,e.height),o.restore()}function jr(r){return r.vertices.forEach(t=>{t.packColor()}),r}function qt(r,t,...e){let o=r.getFrame(t),{u0:i,u1:s,v0:a,v1:m,pivot:f}=o;return e.forEach(c=>{if(!c||o===c.frame)return;c.frame=o,f&&c.setOrigin(f.x,f.y),c.frame.setExtent(c),c.hasTexture=!0;let h=c.vertices;h[0].setUV(i,a),h[1].setUV(i,m),h[2].setUV(s,m),h[3].setUV(s,a)}),e}function qr(r,t,...e){if(!r)e.forEach(o=>{o.texture=null,o.frame=null,o.hasTexture=!1});else{let o;r instanceof C?o=r:o=P.get().get(r),o?(e.forEach(i=>{i.texture=o}),qt(o,t,...e)):console.warn(`Invalid Texture key: ${r}`)}return e}function $r(r){let t=r.vertices,{x0:e,y0:o,x1:i,y1:s,x2:a,y2:m,x3:f,y3:c}=Rt(r.transform);return t[0].setPosition(e,o),t[1].setPosition(i,s),t[2].setPosition(a,m),t[3].setPosition(f,c),r}var Y=class extends jt{constructor(t,e,o,i){super(t,e);this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertices=[new k,new k,new k,new k],this.setTexture(o,i)}setTexture(t,e){return qr(t,e,this),this}setFrame(t){return qt(this.texture,t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(d.COLORS)&&(jr(this),this.clearDirty(d.COLORS)),this.isDirty(d.TRANSFORM)&&($r(this),this.clearDirty(d.TRANSFORM))}renderGL(t){this.preRender(),Hr(this,t)}renderCanvas(t){this.preRender(),Qr(this,t)}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.vertices.forEach(e=>{e.setAlpha(t)}),this.setDirty(d.COLORS))}get tint(){return this._tint}set tint(t){t!==this._tint&&(this._tint=t,this.vertices.forEach(e=>{e.setTint(t)}),this.setDirty(d.COLORS))}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertices=[]}};var sr="worldrender";var ar="worldshutdown";function mr(r,t){t.numRendered++,t.numRenderable++,r.node.dirtyFrame>=t.gameFrame&&t.dirtyFrame++,r.children.forEach(e=>{e.children.length>0&&mr(e,t)})}function Kr(r){if(r.node.isDirty(d.CHILD_CACHE))return!0;let t=[r];for(;t.length>0;){let e=t.pop();if(e.node.isDirty(d.TRANSFORM))return!0;let o=e.children.length;if(o>0)for(let i=0;i<o;i++)t.push(e.children[i])}return t.length=0,!1}function Jr(r,t){r.forEach(e=>{t||Kr(e)?e.node.setDirty(d.CHILD_CACHE):e.children.length=0})}function fr(r,t,e=[]){for(let o=0;o<t.numChildren;o++){let i=t.children[o];if(i.isRenderable()){let s=[],a={node:i,children:s};e.push(a),i.willRenderChildren&&i.numChildren>0&&(i.willCacheChildren&&r.push(a),fr(r,i,s))}}return e}function to(r){let t=[],o=fr(t,r,[]),i=r.renderData;t.length>0&&Jr(t,r.camera.dirtyRender),o.forEach(s=>{s.children.length>0?mr(s,i):(i.numRendered++,i.numRenderable++,s.node.dirtyFrame>=i.gameFrame&&i.dirtyFrame++)}),r.renderList=o,r.forceRefresh&&(i.dirtyFrame++,r.forceRefresh=!1)}function eo(r,t){return r.a===t.a&&r.b===t.b&&r.c===t.c&&r.d===t.d&&r.tx===t.tx&&r.ty===t.ty}function ro(r,t){r.numDirtyFrames+=t.dirtyFrame,r.numTotalFrames+=t.numRendered,t.camera.dirtyRender&&r.numDirtyCameras++,r.worldData.push(t)}function $t(r,t){r.gameFrame=t,r.dirtyFrame=0,r.numRendered=0,r.numRenderable=0}var cr=class extends W{constructor(t){super();this.forceRefresh=!1,this.is3D=!1,this.type="BaseWorld",this.scene=t,this.world=this,this.events=new Map,this.renderList=[],this._updateListener=G(t,"update",(e,o)=>this.update(e,o)),this._renderListener=G(t,"render",e=>this.render(e)),this._shutdownListener=G(t,"shutdown",()=>this.shutdown()),gt(t,"destroy",()=>this.destroy())}update(t,e){!this.willUpdate||(g(this,Kt,t,e,this),super.update(t,e))}postUpdate(t,e){g(this,Zt,t,e,this)}render(t){let e=this.renderData;$t(e,t.gameFrame),!(!this.willRender||!this.visible)&&(to(this),g(this,sr,e,this),ro(t,e),this.camera.dirtyRender=!1)}renderGL(t){let e=t.current2DCamera,o=this.camera;(!e||!eo(o.worldTransform,e.worldTransform))&&b(t),Ie(t,o),this.renderList.forEach(i=>{i.children.length>0?this.renderNode(i,t):i.node.renderGL(t)})}renderNode(t,e){t.node.renderGL(e),t.children.forEach(o=>{o.children.length>0?this.renderNode(o,e):o.node.renderGL(e)}),t.node.postRenderGL(e)}postRenderGL(t){}shutdown(){let t=this.scene;xt(t,"update",this._updateListener),xt(t,"render",this._renderListener),xt(t,"shutdown",this._shutdownListener),ne(this),g(this,ar,this),$t(this.renderData,0),this.camera&&this.camera.reset()}destroy(t){super.destroy(t),g(this,et,this),$t(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}};function oo(r,t){return{world:r,camera:t,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}var hr=class extends cr{constructor(t){super(t);this.type="StaticWorld",this.camera=new q,this.renderData=oo(this,this.camera)}};var no=class extends Ke{constructor(){super();this.world=new hr(this);let t=new Ze;t.setPath("assets/"),t.add(St("256","f-texture.png")),t.add(St("64","box-item-boxed.png")),t.add(St("32","shinyball.png")),t.add(St("16","skull.png")),t.start().then(()=>this.create())}create(){let t=new Y(400,300,"256"),e=Wt(800,600),o=new Y(0,0,e);o.setOrigin(0,0);let i=e.image.getContext("2d");i.strokeStyle="#0f0",i.fillStyle="#0f0",ee(this.world,t,o);let s=0;G(this,"update",()=>{t.rotation+=.005,t.scaleX=Math.cos(s),t.scaleY=Math.sin(s);let a=t.bounds.get();i.clearRect(0,0,800,600),i.strokeRect(a.x,a.y,a.width,a.height),s+=.01})}};new qe(Ue(),Ft(800,600),Dt("gameParent"),se(2960685),Vt(no));})();
/**
 * @author       Niklas von Hertzen (https://github.com/niklasvh/base64-arraybuffer)
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
